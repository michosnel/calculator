"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3236],{8288:(e,t,s)=>{s.d(t,{u9:()=>f});var r=s(95155),n=s(12115),a=s(66766),l=s(66538),c=s(58832),i=s(30285),o=s(31834),d=s(30431),m=s(43089),x=s(64541),u=s(18068);let h=new Set(["execute-command","create-file","delete-file","full-file-rewrite","str-replace","browser-click-element","browser-close-tab","browser-drag-drop","browser-get-dropdown-options","browser-go-back","browser-input-text","browser-navigate-to","browser-scroll-down","browser-scroll-to-text","browser-scroll-up","browser-select-dropdown-option","browser-send-keys","browser-switch-tab","browser-wait","deploy","ask","complete","crawl-webpage","web-search"]);function p(e,t,s,n){if(!e||0===e.length)return null;if(s){let t=!1,r=null;try{let e=localStorage.getItem("auth");if(e){let s=JSON.parse(e);t=!!(r=null==s?void 0:s.access_token)}}catch(e){}t&&r&&setTimeout(()=>{m.pH.preload(s,e,r)},0)}return(0,r.jsx)(d.Q,{attachments:e,onFileClick:t,showPreviews:!0,sandboxId:s,project:n})}let f=e=>{let{messages:t,streamingTextContent:s="",streamingToolCall:d,agentStatus:f,handleToolClick:g,handleOpenFileViewer:b,readOnly:j=!1,visibleMessages:w,streamingText:v="",isStreamingText:N=!1,currentToolCall:k,streamHookStatus:z="idle",sandboxId:y,project:E,debugMode:S=!1}=e,A=(0,n.useRef)(null),C=(0,n.useRef)(null),R=(0,n.useRef)(null),[L,I]=(0,n.useState)(!1),[F,_]=(0,n.useState)(!1),{session:T}=(0,x.A)(),W=j&&w?w:t,U=(0,n.useCallback)(function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"smooth";null==(e=A.current)||e.scrollIntoView({behavior:t})},[]);return n.useEffect(()=>{if(!y)return;let e=[];W.forEach(t=>{if("user"===t.type)try{let s=("string"==typeof t.content?t.content:"").match(/\[Uploaded File: (.*?)\]/g);s&&s.forEach(t=>{let s=t.match(/\[Uploaded File: (.*?)\]/);s&&s[1]&&e.push(s[1])})}catch(e){console.error("Error parsing message attachments:",e)}}),e.length>0&&(null==T?void 0:T.access_token)&&m.pH.preload(y,e,T.access_token)},[W,y,null==T?void 0:T.access_token]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{ref:C,className:"flex-1 overflow-y-auto px-6 py-4 pb-72 bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",onScroll:()=>{if(!C.current)return;let{scrollTop:e,scrollHeight:t,clientHeight:s}=C.current,r=t-e-s>100;I(r),_(r)},children:(0,r.jsxs)("div",{className:"mx-auto max-w-3xl",children:[0!==W.length||s||d||v||k||"idle"!==f?(0,r.jsxs)("div",{className:"space-y-8",children:[(()=>{let e=[],t=null;return W.forEach((s,r)=>{let n=s.type,a=s.message_id||"msg-".concat(r);"user"===n?(t&&e.push(t),e.push({type:"user",messages:[s],key:a}),t=null):"assistant"===n||"tool"===n||"browser_state"===n?t&&"assistant_group"===t.type?t.messages.push(s):(t&&e.push(t),t={type:"assistant_group",messages:[s],key:a}):"status"!==n&&t&&(e.push(t),t=null)}),t&&e.push(t),e.map((t,n)=>{if("user"===t.type){let e=t.messages[0],s=(()=>{try{return(0,u.jD)(e.content,{content:e.content}).content||e.content}catch(t){return e.content}})();if(S)return(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)("div",{className:"inline-flex max-w-[85%] rounded-xl bg-primary/10 px-4 py-3",children:(0,r.jsx)("pre",{className:"text-xs font-mono whitespace-pre-wrap overflow-x-auto",children:e.content})})},t.key);let n=s.match(/\[Uploaded File: (.*?)\]/g),a=n?n.map(e=>{let t=e.match(/\[Uploaded File: (.*?)\]/);return t?t[1]:null}).filter(Boolean):[],l=s.replace(/\[Uploaded File: .*?\]/g,"").trim();return(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)("div",{className:"inline-flex max-w-[85%] rounded-xl bg-primary/10 px-4 py-3",children:(0,r.jsxs)("div",{className:"space-y-3",children:[l&&(0,r.jsx)(o.o,{className:"text-sm prose prose-sm dark:prose-invert chat-markdown max-w-none [&>:first-child]:mt-0 prose-headings:mt-3",children:l}),p(a,b,y,E)]})})},t.key)}return"assistant_group"===t.type?(0,r.jsx)("div",{ref:n===e.length-1?R:null,children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-5 h-5 mt-2 rounded-md flex items-center justify-center overflow-hidden ml-auto mr-2",children:(0,r.jsx)(a.default,{src:"/kortix-symbol.svg",alt:"Kortix",width:14,height:14,className:"object-contain invert dark:invert-0 opacity-70"})}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)("div",{className:"inline-flex max-w-[90%] rounded-lg bg-muted/5 px-4 py-3 text-sm",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(()=>{if(S)return t.messages.map((e,t)=>{let s=e.message_id||"raw-msg-".concat(t);return(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:["Type: ",e.type," | ID: ",e.message_id||"no-id"]}),(0,r.jsx)("pre",{className:"text-xs font-mono whitespace-pre-wrap overflow-x-auto p-2 border border-border rounded-md bg-muted/30",children:e.content}),e.metadata&&"{}"!==e.metadata&&(0,r.jsxs)("div",{className:"mt-2",children:[(0,r.jsx)("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:"Metadata:"}),(0,r.jsx)("pre",{className:"text-xs font-mono whitespace-pre-wrap overflow-x-auto p-2 border border-border rounded-md bg-muted/30",children:e.metadata})]})]},s)});let e=new Map;t.messages.forEach(t=>{if("tool"===t.type){var s;let r=(0,u.jD)(t.metadata,{}).assistant_message_id||null;e.has(r)||e.set(r,[]),null==(s=e.get(r))||s.push(t)}});let s=[];return t.messages.forEach((e,t)=>{if("assistant"===e.type){let n=(0,u.jD)(e.content,{}),a=e.message_id||"submsg-assistant-".concat(t);if(!n.content)return;let l=function(e,t,s,n,a,l,c){let i;if(c)return(0,r.jsx)("pre",{className:"text-xs font-mono whitespace-pre-wrap overflow-x-auto p-2 border border-border rounded-md bg-muted/30 text-foreground",children:e});let d=/<(?!inform\b)([a-zA-Z\-_]+)(?:\s+[^>]*)?>(?:[\s\S]*?)<\/\1>|<(?!inform\b)([a-zA-Z\-_]+)(?:\s+[^>]*)?\/>/g,m=0,x=[];if(!e.match(d))return(0,r.jsx)(o.o,{className:"text-sm prose prose-sm dark:prose-invert chat-markdown max-w-none break-words",children:e});for(;null!==(i=d.exec(e));){if(i.index>m){let t=e.substring(m,i.index);x.push((0,r.jsx)(o.o,{className:"text-sm prose prose-sm dark:prose-invert chat-markdown max-w-none inline-block mr-1 break-words",children:t},"md-".concat(m)))}let c=i[0],h=i[1]||i[2],f="tool-".concat(i.index);if("ask"===h){let e=c.match(/attachments=["']([^"']*)["']/i),t=e?e[1].split(",").map(e=>e.trim()):[],s=c.match(/<ask[^>]*>([\s\S]*?)<\/ask>/i),d=s?s[1]:"";x.push((0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsx)(o.o,{className:"text-sm prose prose-sm dark:prose-invert chat-markdown max-w-none break-words [&>:first-child]:mt-0 prose-headings:mt-3",children:d}),p(t,n,a,l)]},"ask-".concat(i.index)))}else{let e=(0,u.S8)(h),n=(0,u.D5)(h,c);x.push((0,r.jsxs)("button",{onClick:()=>t(s,h),className:"inline-flex items-center gap-1.5 py-1 px-2.5 my-1 text-xs text-muted-foreground bg-muted hover:bg-muted/80 rounded-md transition-colors cursor-pointer border border-border",children:[(0,r.jsx)(e,{className:"h-3.5 w-3.5 text-muted-foreground flex-shrink-0"}),(0,r.jsx)("span",{className:"font-mono text-xs text-foreground",children:h}),n&&(0,r.jsx)("span",{className:"ml-1 text-muted-foreground truncate max-w-[200px]",title:n,children:n})]},f))}m=d.lastIndex}return m<e.length&&x.push((0,r.jsx)(o.o,{className:"text-sm prose prose-sm dark:prose-invert chat-markdown max-w-none break-words",children:e.substring(m)},"md-".concat(m))),x}(n.content,g,e.message_id,b,y,E,S);s.push((0,r.jsx)("div",{className:t>0?"mt-2":"",children:(0,r.jsx)("div",{className:"prose prose-sm dark:prose-invert chat-markdown max-w-none [&>:first-child]:mt-0 prose-headings:mt-3",children:l})},a))}}),s})(),n===e.length-1&&!j&&("streaming"===z||"connecting"===z)&&(0,r.jsx)("div",{className:"mt-2",children:(()=>{if(S&&s)return(0,r.jsx)("pre",{className:"text-xs font-mono whitespace-pre-wrap overflow-x-auto p-2 border border-border rounded-md bg-muted/30",children:s});let e=null,t=-1;if(s)for(let r of h){let n="<".concat(r),a=s.indexOf(n);if(-1!==a){e=r,t=a;break}}let n=s||"",a=e?n.substring(0,t):n,c=("streaming"===z||"connecting"===z)&&!e;return(0,r.jsxs)(r.Fragment,{children:[a&&(0,r.jsx)(o.o,{className:"text-sm prose prose-sm dark:prose-invert chat-markdown max-w-none [&>:first-child]:mt-0 prose-headings:mt-3",children:a}),c&&(0,r.jsx)("span",{className:"inline-block h-4 w-0.5 bg-primary ml-0.5 -mb-1 animate-pulse"}),e&&(0,r.jsx)("div",{className:"mt-2 mb-1",children:(0,r.jsxs)("button",{className:"inline-flex items-center gap-1.5 py-1 px-2.5 text-xs font-medium text-primary bg-primary/10 hover:bg-primary/20 rounded-md transition-colors cursor-pointer border border-primary/20",children:[(0,r.jsx)(l.A,{className:"h-3.5 w-3.5 text-primary flex-shrink-0 animate-spin animation-duration-2000"}),(0,r.jsx)("span",{className:"font-mono text-xs text-primary",children:e})]})}),d&&!e&&(0,r.jsx)("div",{className:"mt-2 mb-1",children:(()=>{let e=d.name||d.xml_tag_name||"Tool";(0,u.S8)(e);let t=(0,u.D5)(e,d.arguments||"");return(0,r.jsxs)("button",{className:"inline-flex items-center gap-1.5 py-1 px-2.5 text-xs font-medium text-primary bg-primary/10 hover:bg-primary/20 rounded-md transition-colors cursor-pointer border border-primary/20",children:[(0,r.jsx)(l.A,{className:"h-3.5 w-3.5 text-primary flex-shrink-0 animate-spin animation-duration-2000"}),(0,r.jsx)("span",{className:"font-mono text-xs text-primary",children:e}),t&&(0,r.jsx)("span",{className:"ml-1 text-primary/70 truncate max-w-[200px]",title:t,children:t})]})})()})]})})()}),j&&n===e.length-1&&N&&(0,r.jsx)("div",{className:"mt-2",children:(()=>{let e=null,t=-1;if(v)for(let s of h){let r="<".concat(s),n=v.indexOf(r);if(-1!==n){e=s,t=n;break}}let s=v||"",n=e?s.substring(0,t):s,a=N&&!e;return(0,r.jsx)(r.Fragment,{children:S&&v?(0,r.jsx)("pre",{className:"text-xs font-mono whitespace-pre-wrap overflow-x-auto p-2 border border-border rounded-md bg-muted/30",children:v}):(0,r.jsxs)(r.Fragment,{children:[n&&(0,r.jsx)(o.o,{className:"text-sm prose prose-sm dark:prose-invert chat-markdown max-w-none [&>:first-child]:mt-0 prose-headings:mt-3",children:n}),a&&(0,r.jsx)("span",{className:"inline-block h-4 w-0.5 bg-primary ml-0.5 -mb-1 animate-pulse"}),e&&(0,r.jsx)("div",{className:"mt-2 mb-1",children:(0,r.jsxs)("button",{className:"inline-flex items-center gap-1.5 py-1 px-2.5 text-xs font-medium text-primary bg-primary/10 hover:bg-primary/20 rounded-md transition-colors cursor-pointer border border-primary/20",children:[(0,r.jsx)(l.A,{className:"h-3.5 w-3.5 text-primary flex-shrink-0 animate-spin animation-duration-2000"}),(0,r.jsx)("span",{className:"font-mono text-xs text-primary",children:e})]})})]})})})()})]})})})]})},t.key):null})})(),("running"===f||"connecting"===f)&&!j&&(0===t.length||"user"===t[t.length-1].type)&&(0,r.jsx)("div",{ref:R,children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-5 h-5 rounded-md flex items-center justify-center overflow-hidden bg-primary/10",children:(0,r.jsx)(a.default,{src:"/kortix-symbol.svg",alt:"Suna",width:14,height:14,className:"object-contain"})}),(0,r.jsx)("div",{className:"flex-1 space-y-2",children:(0,r.jsx)("div",{className:"max-w-[90%] px-4 py-3 text-sm",children:(0,r.jsxs)("div",{className:"flex items-center gap-1.5 py-1",children:[(0,r.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-primary/50 animate-pulse"}),(0,r.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-primary/50 animate-pulse delay-150"}),(0,r.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-primary/50 animate-pulse delay-300"})]})})})]})}),j&&k&&(0,r.jsx)("div",{ref:R,children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-5 h-5 mt-2 rounded-md flex items-center justify-center overflow-hidden bg-primary/10",children:(0,r.jsx)(a.default,{src:"/kortix-symbol.svg",alt:"Suna",width:14,height:14,className:"object-contain"})}),(0,r.jsx)("div",{className:"flex-1 space-y-2",children:(0,r.jsxs)("div",{className:"inline-flex items-center gap-1.5 py-1.5 px-3 text-xs font-medium text-primary bg-primary/10 rounded-md border border-primary/20",children:[(0,r.jsx)(l.A,{className:"h-3.5 w-3.5 text-primary flex-shrink-0 animate-spin animation-duration-2000"}),(0,r.jsx)("span",{className:"font-mono text-xs text-primary",children:k.name||"Using Tool"})]})})]})}),j&&w&&0===w.length&&N&&(0,r.jsx)("div",{ref:R,children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)("div",{className:"flex-shrink-0 w-5 h-5 mt-2 rounded-md flex items-center justify-center overflow-hidden bg-primary/10",children:(0,r.jsx)(a.default,{src:"/kortix-symbol.svg",alt:"Suna",width:14,height:14,className:"object-contain"})}),(0,r.jsx)("div",{className:"flex-1 space-y-2",children:(0,r.jsx)("div",{className:"max-w-[90%] px-4 py-3 text-sm",children:(0,r.jsxs)("div",{className:"flex items-center gap-1.5 py-1",children:[(0,r.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-primary/50 animate-pulse"}),(0,r.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-primary/50 animate-pulse delay-150"}),(0,r.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-primary/50 animate-pulse delay-300"})]})})})]})})]}):(0,r.jsx)("div",{className:"flex h-full items-center justify-center",children:(0,r.jsx)("div",{className:"text-center text-muted-foreground",children:j?"No messages to display.":"Send a message to start."})}),(0,r.jsx)("div",{ref:A,className:"h-1"})]})}),L&&(0,r.jsx)(i.$,{variant:"outline",size:"icon",className:"fixed bottom-20 right-6 z-10 h-8 w-8 rounded-full shadow-md",onClick:()=>U("smooth"),children:(0,r.jsx)(c.A,{className:"h-4 w-4"})})]})}},12969:(e,t,s)=>{s.d(t,{T:()=>u,w:()=>x});var r=s(95155),n=s(12115),a=s(25789),l=s(93836),c=s(9616),i=s(5710),o=s(66424),d=s(59434),m=s(34513);let x=e=>e?e.replace(/\\u([0-9a-fA-F]{4})/g,(e,t)=>String.fromCharCode(parseInt(t,16))).replace(/\\u([0-9a-fA-F]{8})/g,(e,t)=>String.fromCharCode(parseInt(t.substring(0,4),16),parseInt(t.substring(4,8),16))):"",u=(0,n.forwardRef)((e,t)=>{let{content:s,className:n}=e,u=x(s);return(0,r.jsx)(o.F,{className:(0,d.cn)("w-full h-full rounded-md relative",n),children:(0,r.jsx)("div",{className:"p-4 markdown prose prose-sm dark:prose-invert max-w-none",ref:t,children:(0,r.jsx)(a.oz,{remarkPlugins:[l.A],rehypePlugins:[c.A,i.A],components:{code(e){let{className:t,children:s,...n}=e,a=/language-(\w+)/.exec(t||"");return t&&a?(0,r.jsx)(m.$,{content:String(s).replace(/\n$/,""),language:a?a[1]:""}):(0,r.jsx)("code",{className:t,...n,children:s})},h1:e=>{let{node:t,...s}=e;return(0,r.jsx)("h1",{className:"text-2xl font-bold my-4",...s})},h2:e=>{let{node:t,...s}=e;return(0,r.jsx)("h2",{className:"text-xl font-bold my-3",...s})},h3:e=>{let{node:t,...s}=e;return(0,r.jsx)("h3",{className:"text-lg font-bold my-2",...s})},a:e=>{let{node:t,...s}=e;return(0,r.jsx)("a",{className:"text-primary hover:underline",...s})},p:e=>{let{node:t,...s}=e;return(0,r.jsx)("p",{className:"my-2 font-sans cjk-text",...s})},ul:e=>{let{node:t,...s}=e;return(0,r.jsx)("ul",{className:"list-disc pl-5 my-2",...s})},ol:e=>{let{node:t,...s}=e;return(0,r.jsx)("ol",{className:"list-decimal pl-5 my-2",...s})},li:e=>{let{node:t,...s}=e;return(0,r.jsx)("li",{className:"my-1",...s})},blockquote:e=>{let{node:t,...s}=e;return(0,r.jsx)("blockquote",{className:"border-l-4 border-muted pl-4 italic my-2",...s})},img:e=>{let{node:t,...s}=e;return(0,r.jsx)("img",{className:"max-w-full h-auto rounded-md my-2",...s,alt:s.alt||""})},pre:e=>{let{node:t,...s}=e;return(0,r.jsx)("pre",{className:"p-0 my-2 bg-transparent",...s})},table:e=>{let{node:t,...s}=e;return(0,r.jsx)("table",{className:"w-full border-collapse my-3 text-sm",...s})},th:e=>{let{node:t,...s}=e;return(0,r.jsx)("th",{className:"border border-slate-300 dark:border-zinc-700 px-3 py-2 text-left font-semibold bg-slate-100 dark:bg-zinc-800",...s})},td:e=>{let{node:t,...s}=e;return(0,r.jsx)("td",{className:"border border-slate-300 dark:border-zinc-700 px-3 py-2 cjk-text",...s})}},children:u})})})});u.displayName="MarkdownRenderer"},18068:(e,t,s)=>{s.d(t,{D5:()=>w,S8:()=>j,jD:()=>b});var r=s(17051),n=s(34869),a=s(49992),l=s(4113),c=s(50773),i=s(57434),o=s(41684),d=s(47924),m=s(33786),x=s(19302),u=s(79323),h=s(42337),p=s(29621),f=s(81497),g=s(48313);function b(e,t){if(!e)return t;try{return JSON.parse(e)}catch(e){return t}}let j=e=>{if(!e)return r.A;let t=e.toLowerCase();if(t.startsWith("browser-"))return n.A;switch(t){case"create-file":return a.A;case"str-replace":return l.A;case"full-file-rewrite":return c.A;case"read-file":return i.A;case"execute-command":return o.A;case"web-search":return d.A;case"crawl-webpage":return n.A;case"call-data-provider":return m.A;case"get-data-provider-endpoints":case"execute-data-provider-call":return x.A;case"delete-file":return u.A;case"deploy-site":return h.A;case"execute-code":return p.A;case"ask":return f.A;default:return console.log("[PAGE] Using default icon for unknown tool type: ".concat(e)),g.A}},w=(e,t)=>{if(!t)return null;try{if(null==e?void 0:e.toLowerCase().startsWith("browser-")){let e=t.match(/url=(?:"|')([^"|']+)(?:"|')/);if(e)return e[1];let s=t.match(/goal=(?:"|')([^"|']+)(?:"|')/);if(s){let e=s[1];return e.length>30?e.substring(0,27)+"...":e}return null}if(t.startsWith("<")&&t.includes(">")){let s=t.match(/<[^>]+\s+([^>]+)>/);if(s&&s[1]){let t=s[1].trim(),r=t.match(/file_path=["']([^"']+)["']/);if(r)return r[1].split("/").pop()||r[1];if((null==e?void 0:e.toLowerCase())==="execute-command"){let e=t.match(/(?:command|cmd)=["']([^"']+)["']/);if(e){let t=e[1];return t.length>30?t.substring(0,27)+"...":t}}}}let s=null;switch(null==e?void 0:e.toLowerCase()){case"create-file":case"full-file-rewrite":case"read-file":case"delete-file":case"str-replace":return(s=t.match(/file_path=(?:"|')([^"|']+)(?:"|')/))?s[1].split("/").pop()||s[1]:null;case"execute-command":if(s=t.match(/command=(?:"|')([^"|']+)(?:"|')/)){let e=s[1];return e.length>30?e.substring(0,27)+"...":e}break;case"web-search":return(s=t.match(/query=(?:"|')([^"|']+)(?:"|')/))?s[1].length>30?s[1].substring(0,27)+"...":s[1]:null;case"call-data-provider":s=t.match(/service_name=(?:"|')([^"|']+)(?:"|')/);let r=t.match(/route=(?:"|')([^"|']+)(?:"|')/);return s&&r?"".concat(s[1],"/").concat(r[1]):s?s[1]:null;case"deploy-site":return(s=t.match(/site_name=(?:"|')([^"|']+)(?:"|')/))?s[1]:null}return null}catch(e){return console.warn("Error parsing tool parameters:",e),null}}},34513:(e,t,s)=>{s.d(t,{$:()=>h});var r=s(95155),n=s(12115),a=s(33479),l=s(14098),c=s(72781),i=s(59434),o=s(66424),d=s(96976),m=s(51362),x=s(73603);let u={js:c.cg.javascript,jsx:c.cg.jsx,ts:c.cg.typescript,tsx:c.cg.tsx,html:c.cg.html,css:c.cg.css,json:c.cg.json,md:c.cg.markdown,python:c.cg.python,py:c.cg.python,rust:c.cg.rust,go:c.cg.go,java:c.cg.java,c:c.cg.c,cpp:c.cg.cpp,cs:c.cg.csharp,php:c.cg.php,ruby:c.cg.ruby,sh:c.cg.shell,bash:c.cg.shell,sql:c.cg.sql,yaml:c.cg.yaml,yml:c.cg.yaml};function h(e){let{content:t,language:s="",className:c}=e,{resolvedTheme:h}=(0,m.D)(),[p,f]=(0,n.useState)(!1);(0,n.useEffect)(()=>{f(!0)},[]);let g=[...s&&u[s]?[u[s]()]:[],x.Lz.lineWrapping],b=p&&"dark"===h?l.Ts:d._x;return(0,r.jsx)(o.F,{className:(0,i.cn)("w-full h-full",c),children:(0,r.jsx)("div",{className:"w-full",children:(0,r.jsx)(a.Ay,{value:t,theme:b,extensions:g,basicSetup:{lineNumbers:!1,highlightActiveLine:!1,highlightActiveLineGutter:!1,foldGutter:!1},editable:!1,className:"text-sm w-full min-h-full",style:{maxWidth:"100%"},height:"auto"})})})}},44102:(e,t,s)=>{s.d(t,{s:()=>ed});var r=s(95155),n=s(18068),a=s(12115),l=s(11415),c=s(59434);function i(e){let{className:t,defaultValue:s,value:n,min:i=0,max:o=100,...d}=e,m=a.useMemo(()=>Array.isArray(n)?n:Array.isArray(s)?s:[i,o],[n,s,i,o]);return(0,r.jsxs)(l.bL,{"data-slot":"slider",defaultValue:s,value:n,min:i,max:o,className:(0,c.cn)("relative flex w-full touch-none items-center select-none data-[disabled]:opacity-50 data-[orientation=vertical]:h-full data-[orientation=vertical]:min-h-44 data-[orientation=vertical]:w-auto data-[orientation=vertical]:flex-col",t),...d,children:[(0,r.jsx)(l.CC,{"data-slot":"slider-track",className:(0,c.cn)("bg-muted relative grow overflow-hidden rounded-full data-[orientation=horizontal]:h-1.5 data-[orientation=horizontal]:w-full data-[orientation=vertical]:h-full data-[orientation=vertical]:w-1.5"),children:(0,r.jsx)(l.Q6,{"data-slot":"slider-range",className:(0,c.cn)("bg-primary absolute data-[orientation=horizontal]:h-full data-[orientation=vertical]:w-full")})}),Array.from({length:m.length},(e,t)=>(0,r.jsx)(l.zi,{"data-slot":"slider-thumb",className:"border-primary bg-background ring-ring/50 block size-4 shrink-0 rounded-full border shadow-sm transition-[color,box-shadow] hover:ring-4 focus-visible:ring-4 focus-visible:outline-hidden disabled:pointer-events-none disabled:opacity-50"},t))]})}var o=s(68856),d=s(54416),m=s(66538),x=s(42355),u=s(13052),h=s(40416),p=s(30285),f=s(41684),g=s(40646),b=s(1243);function j(e){if(!e)return"";try{let t=new Date(e);return isNaN(t.getTime())?"Invalid date":t.toLocaleString()}catch(e){return"Invalid date"}}function w(e){let t=e.toLowerCase(),s={"execute-command":"Execute Command","str-replace":"String Replace","create-file":"Create File","full-file-rewrite":"Rewrite File","delete-file":"Delete File","web-search":"Web Search","crawl-webpage":"Web Crawl","scrape-webpage":"Web Scrape","browser-navigate":"Browser Navigate","browser-click":"Browser Click","browser-extract":"Browser Extract","browser-fill":"Browser Fill","browser-wait":"Browser Wait"};if(s[t])return s[t];if(t.startsWith("browser-")){let e=t.replace("browser-","").replace(/-/g," ");return"Browser "+e.charAt(0).toUpperCase()+e.slice(1)}return e.split("-").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}function v(e){if(!e)return null;try{let t=JSON.parse(e);t.content&&"string"==typeof t.content&&(e=t.content)}catch(e){}let t=e.match(/file_path=["']([\s\S]*?)["']/i)||e.match(/target_file=["']([\s\S]*?)["']/i)||e.match(/path=["']([\s\S]*?)["']/i);if(t)return N(t[1].trim());let s=e.match(/<str-replace\s+file_path=["']([\s\S]*?)["']/i)||e.match(/<delete[^>]*file_path=["']([\s\S]*?)["']/i)||e.match(/<delete-file[^>]*>([^<]+)<\/delete-file>/i);if(s)return N(s[1]);if(e.toLowerCase().includes("delete")||e.includes("delete-file")){let t=e.match(/(?:delete|remove|deleting)\s+(?:file|the file)?:?\s+["']?([\w\-./\\]+\.\w+)["']?/i);if(t)return N(t[1]);let s=e.match(/["']?([\w\-./\\]+\.\w+)["']?/);if(s)return N(s[1])}return null}function N(e){return e?e.replace(/\\n/g,"\n").replace(/\\t/g,"	").replace(/\\r/g,"").replace(/\\\\/g,"\\").replace(/\\"/g,'"').replace(/\\'/g,"'").split("\n")[0].trim():e}function k(e){let t,s=[],r=/"?title"?\s*:\s*"([^"]+)"[^}]*"?url"?\s*:\s*"?(https?:\/\/[^",\s]+)"?|https?:\/\/[^",\s]+[",\s]*"?title"?\s*:\s*"([^"]+)"/g;for(;null!==(t=r.exec(e));){let r=t[1]||t[3]||"",n=t[2]||"";if(!n&&r){let s=e.substring(0,t.index).match(/https?:\/\/[^\s",]+\s*$/);s&&s[0]&&(n=s[0].trim())}n&&r&&!s.some(e=>e.url===n)&&s.push({title:r,url:n})}if(0===s.length){let t,r=/https?:\/\/[^\s"<]+/g;for(;null!==(t=r.exec(e));){let r=t[0],n=r.indexOf("://"),a=-1!==n?n+3:0,l=r.indexOf("/n",a),c=r.indexOf("\\n",a),i=-1;for(-1!==l&&-1!==c?i=Math.min(l,c):-1!==l?i=l:-1!==c&&(i=c),-1!==i&&(r=r.substring(0,i)),r=r.replace(/<\/?url>$/,"").replace(/<\/?content>$/,"").replace(/%3C$/,"");/[);.,\/]$/.test(r);)r=r.slice(0,-1);try{r=decodeURIComponent(decodeURIComponent(r))}catch(e){try{r=decodeURIComponent(r)}catch(e){console.warn("Failed to decode URL component:",r,e)}}r=(r=r.replace(/\u2026$/,"")).replace(/<\/?url>$/,"").replace(/<\/?content>$/,"");let o=t.index,d=e.substring(Math.max(0,o-100),o+r.length+200),m=d.match(/title"?\s*:\s*"([^"]+)"/i)||d.match(/Title[:\s]+([^\n<]+)/i)||d.match(/\"(.*?)\"[\s\n]*?https?:\/\//),x=z(r);m&&m[1].trim()&&(x=m[1].trim()),r&&!s.some(e=>e.url===r)&&s.push({title:x,url:r})}}return s}function z(e){try{let t=new URL(e);return t.hostname.replace("www.","")+("/"!==t.pathname?t.pathname:"")}catch(t){return e}}function y(e){if(!e)return null;try{let t=JSON.parse(e);if(t.content){let e=t.content.match(/<(?:crawl|scrape)-webpage\s+url=["'](https?:\/\/[^"']+)["']/i);if(e)return e[1]}}catch(e){}let t=e.match(/<(?:crawl|scrape)-webpage\s+url=["'](https?:\/\/[^"']+)["']/i)||e.match(/url=["'](https?:\/\/[^"']+)["']/i);return t?t[1]:null}function E(e){if(!e)return null;try{let t=JSON.parse(e);if(t.content&&"string"==typeof t.content){let e=t.content.match(/<tool_result>\s*<(?:crawl|scrape)-webpage>([\s\S]*?)<\/(?:crawl|scrape)-webpage>\s*<\/tool_result>/);if(e)try{let t=e[1],s=t.match(/ToolResult\(.*?output='([\s\S]*?)'.*?\)/);if(s)try{let e=JSON.parse(s[1].replace(/\\\\n/g,"\\n").replace(/\\\\u/g,"\\u"));if(Array.isArray(e)&&e.length>0){let t=e[0];return{title:t.Title||t.title||"",text:t.Text||t.text||t.content||""}}return{title:e.Title||e.title||"",text:e.Text||e.text||e.content||""}}catch(e){return{title:"Webpage Content",text:s[1]}}let r=JSON.parse(t);if(Array.isArray(r)&&r.length>0){let e=r[0];return{title:e.Title||e.title||"",text:e.Text||e.text||e.content||""}}return{title:r.Title||r.title||"",text:r.Text||r.text||r.content||""}}catch(t){return{title:"Webpage Content",text:e[1]}}let s=t.content.match(/ToolResult\(.*?output='([\s\S]*?)'.*?\)/);if(s)try{let e=JSON.parse(s[1].replace(/\\\\n/g,"\\n").replace(/\\\\u/g,"\\u"));if(Array.isArray(e)&&e.length>0){let t=e[0];return{title:t.Title||t.title||"",text:t.Text||t.text||t.content||""}}return{title:e.Title||e.title||"",text:e.Text||e.text||e.content||""}}catch(e){return{title:"Webpage Content",text:s[1]}}}let s=e.match(/<(?:crawl|scrape)-webpage>([\s\S]*?)<\/(?:crawl|scrape)-webpage>/);if(s){let e=s[1].match(/ToolResult\(.*?output='([\s\S]*?)'.*?\)/);if(e)try{let t=e[1].replace(/\\\\n/g,"\\n").replace(/\\\\u/g,"\\u"),s=JSON.parse(t);if(Array.isArray(s)&&s.length>0){let e=s[0];return{title:e.Title||e.title||(e.URL?new URL(e.URL).hostname:""),text:e.Text||e.text||e.content||""}}return{title:s.Title||s.title||"",text:s.Text||s.text||s.content||""}}catch(t){return{title:"Webpage Content",text:e[1]}}}if(Array.isArray(t)&&t.length>0){let e=t[0];return{title:e.Title||e.title||"",text:e.Text||e.text||e.content||""}}if("object"==typeof t)return{title:t.Title||t.title||"Webpage Content",text:t.Text||t.text||t.content||JSON.stringify(t)}}catch(s){let t=e.match(/ToolResult\(.*?output='([\s\S]*?)'.*?\)/);if(t)try{let e=JSON.parse(t[1].replace(/\\\\n/g,"\\n").replace(/\\\\u/g,"\\u"));if(Array.isArray(e)&&e.length>0){let t=e[0];return{title:t.Title||t.title||"",text:t.Text||t.text||t.content||""}}return{title:e.Title||e.title||"",text:e.Text||e.text||e.content||""}}catch(e){return{title:"Webpage Content",text:t[1]}}if(e)return{title:"Webpage Content",text:e}}return null}function S(e){var t,s,n;let{name:l="execute-command",assistantContent:i,toolContent:o,assistantTimestamp:d,toolTimestamp:x,isSuccess:u=!0,isStreaming:h=!1}=e,p=a.useMemo(()=>{if(!i)return null;try{let e=JSON.parse(i);if(e.content){let t=e.content.match(/<execute-command[^>]*>([\s\S]*?)<\/execute-command>/);if(t)return t[1].trim()}}catch(t){let e=i.match(/<execute-command[^>]*>([\s\S]*?)<\/execute-command>/);if(e)return e[1].trim()}return null},[i]),v=null==p||null==(n=p.replace(/^suna@computer:~\$\s*/g,""))||null==(s=n.replace(/\\n/g,""))||null==(t=s.replace(/\n/g,""))?void 0:t.trim(),N=a.useMemo(()=>{if(!o)return null;try{let e=JSON.parse(o);if(e.content){let t=e.content.match(/<tool_result>\s*<execute-command>([\s\S]*?)<\/execute-command>\s*<\/tool_result>/);if(t)return t[1].trim();let s=e.content.match(/ToolResult\(.*?output='([\s\S]*?)'.*?\)/);if(s)return s[1].replace(/\\n/g,"\n").replace(/\\"/g,'"');try{let t=JSON.parse(e.content);if(t.output)return t.output}catch(t){return e.content}}}catch(s){let e=o.match(/<tool_result>\s*<execute-command>([\s\S]*?)<\/execute-command>\s*<\/tool_result>/);if(e)return e[1].trim();let t=o.match(/ToolResult\(.*?output='([\s\S]*?)'.*?\)/);if(t)return t[1].replace(/\\n/g,"\n").replace(/\\"/g,'"')}return o},[o]),k=function(e){if(!e)return null;try{let t=e.match(/exit_code=(\d+)/);if(t&&t[1])return parseInt(t[1],10);return 0}catch(e){return null}}(o);return w(l),(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"flex-1 p-4 overflow-auto",children:(0,r.jsxs)("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded-md overflow-hidden h-full flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center p-2 bg-zinc-100 dark:bg-zinc-900 justify-between border-b border-zinc-200 dark:border-zinc-800",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(f.A,{className:"h-4 w-4 mr-2 text-zinc-600 dark:text-zinc-400"}),(0,r.jsx)("span",{className:"text-xs font-medium text-zinc-700 dark:text-zinc-300",children:"Terminal"})]}),null!==k&&!h&&(0,r.jsxs)("span",{className:(0,c.cn)("text-xs flex items-center",u?"text-emerald-600 dark:text-emerald-400":"text-red-600 dark:text-red-400"),children:[(0,r.jsx)("span",{className:"h-1.5 w-1.5 rounded-full mr-1.5 bg-current"}),"Exit: ",k]})]}),(0,r.jsx)("div",{className:"terminal-container flex-1 overflow-auto bg-black text-zinc-300 font-mono",children:(0,r.jsxs)("div",{className:"p-3 text-xs",children:[v&&N&&!h&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("span",{className:"text-emerald-400 shrink-0 mr-2",children:"suna@computer:~$"}),(0,r.jsx)("span",{className:"text-zinc-300",children:v})]}),(0,r.jsx)("div",{className:"whitespace-pre-wrap break-words text-zinc-400 pl-0",children:N}),u&&(0,r.jsx)("div",{className:"text-emerald-400 mt-1",children:"suna@computer:~$ _"})]}),v&&!N&&!h&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("span",{className:"text-emerald-400 shrink-0 mr-2",children:"suna@computer:~$"}),(0,r.jsx)("span",{className:"text-zinc-300",children:v})]}),(0,r.jsx)("div",{className:"flex items-center h-4",children:(0,r.jsx)("div",{className:"w-2 h-4 bg-zinc-500 animate-pulse"})})]}),!v&&!N&&!h&&(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("span",{className:"text-emerald-400 shrink-0 mr-2",children:"suna@computer:~$"}),(0,r.jsx)("span",{className:"w-2 h-4 bg-zinc-500 animate-pulse"})]}),h&&(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{className:"flex items-start",children:[(0,r.jsx)("span",{className:"text-emerald-400 shrink-0 mr-2",children:"suna@computer:~$"}),(0,r.jsx)("span",{className:"text-zinc-300",children:v||"running command..."})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 text-zinc-400",children:[(0,r.jsx)(m.A,{className:"h-3 w-3 animate-spin text-blue-400"}),(0,r.jsx)("span",{children:"Command execution in progress..."})]})]})]})})]})}),(0,r.jsx)("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-800",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-zinc-500 dark:text-zinc-400",children:[!h&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[u?(0,r.jsx)(g.A,{className:"h-3.5 w-3.5 text-emerald-500"}):(0,r.jsx)(b.A,{className:"h-3.5 w-3.5 text-red-500"}),(0,r.jsx)("span",{children:u?"Command completed successfully".concat(null!==k?" (exit code: ".concat(k,")"):""):"Command failed".concat(null!==k?" with exit code ".concat(k):"")})]}),h&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(m.A,{className:"h-3.5 w-3.5 text-blue-500 animate-spin"}),(0,r.jsx)("span",{children:"Executing command..."})]}),(0,r.jsx)("div",{className:"text-xs",children:x&&!h?j(x):d?j(d):""})]})})]})}var A=s(81422),C=s(31834);function R(e){let{name:t="unknown",assistantContent:s,toolContent:l,isSuccess:i=!0,isStreaming:o=!1,assistantTimestamp:d,toolTimestamp:x}=e;console.log("GenericToolView:",{name:t,assistantContent:s,toolContent:l,isSuccess:i,isStreaming:o,assistantTimestamp:d,toolTimestamp:x});let u=w(t);(0,n.S8)(t);let h=e=>{if(!e)return null;try{let t=JSON.parse(e);return JSON.stringify(t,null,2)}catch(t){return e}},p=a.useMemo(()=>h(s),[s]),f=a.useMemo(()=>h(l),[l]);return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"flex-1 p-4 overflow-auto",children:[s&&!o&&(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("div",{className:"text-xs font-medium text-zinc-500 dark:text-zinc-400",children:"Input"}),d&&(0,r.jsx)("div",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:j(d)})]}),(0,r.jsx)("div",{className:"rounded-md border border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900 p-3",children:(0,r.jsx)(C.o,{className:"text-xs text-zinc-800 dark:text-zinc-300",children:p})})]}),l&&(0,r.jsxs)("div",{className:"space-y-1.5 mt-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("div",{className:"text-xs font-medium text-zinc-500 dark:text-zinc-400",children:o?"Processing":"Output"}),x&&!o&&(0,r.jsx)("div",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:j(x)})]}),(0,r.jsx)("div",{className:(0,c.cn)("rounded-md border p-3",o?"border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-900/10":i?"border-zinc-200 bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-900":"border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-900/10"),children:o?(0,r.jsxs)("div",{className:"flex items-center gap-2 text-xs font-medium text-blue-700 dark:text-blue-400",children:[(0,r.jsx)(m.A,{className:"h-3 w-3 animate-spin"}),(0,r.jsxs)("span",{children:["Executing ",u.toLowerCase(),"..."]})]}):(0,r.jsx)(C.o,{className:"text-xs text-zinc-800 dark:text-zinc-300",children:f})})]})]}),(0,r.jsx)("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-800",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-zinc-500 dark:text-zinc-400",children:[!o&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[i?(0,r.jsx)(g.A,{className:"h-3.5 w-3.5 text-emerald-500"}):(0,r.jsx)(b.A,{className:"h-3.5 w-3.5 text-red-500"}),(0,r.jsx)("span",{children:i?"Completed successfully":"Execution failed"})]}),o&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(m.A,{className:"h-3.5 w-3.5 text-blue-500 animate-spin"}),(0,r.jsx)("span",{children:"Processing..."})]}),(0,r.jsx)("div",{className:"text-xs",children:x&&!o?j(x):d?j(d):""})]})})]})}function L(e){let{name:t="str-replace",assistantContent:s,toolContent:n,assistantTimestamp:a,toolTimestamp:l,isSuccess:i=!0,isStreaming:o=!1}=e,d=v(s),{oldStr:x,newStr:u}=function(e){if(!e)return{oldStr:null,newStr:null};let t=e.match(/<old_str>([\s\S]*?)<\/old_str>/),s=e.match(/<new_str>([\s\S]*?)<\/new_str>/);return{oldStr:t?t[1]:null,newStr:s?s[1]:null}}(s);if(w(t),!x||!u)return(0,r.jsx)(R,{name:t,assistantContent:s,toolContent:n,assistantTimestamp:a,toolTimestamp:l,isSuccess:i,isStreaming:o});let h=((e,t)=>{let s=0;for(;s<e.length&&s<t.length&&e[s]===t[s];)s++;let r=e.length,n=t.length;for(;r>s&&n>s&&e[r-1]===t[n-1];)r--,n--;let a=[];return s>0&&a.push({text:e.substring(0,s),type:"unchanged"}),r>s&&a.push({text:e.substring(s,r),type:"removed"}),n>s&&a.push({text:t.substring(s,n),type:"added"}),r<e.length&&a.push({text:e.substring(r),type:"unchanged"}),a})(x,u);return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"flex-1 p-4 overflow-auto",children:(0,r.jsxs)("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded-md overflow-hidden h-full flex flex-col",children:[(0,r.jsx)("div",{className:"flex items-center p-2 bg-zinc-100 dark:bg-zinc-900 justify-between border-b border-zinc-200 dark:border-zinc-800",children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(A.A,{className:"h-4 w-4 mr-2 text-zinc-600 dark:text-zinc-400"}),(0,r.jsx)("span",{className:"text-xs font-medium text-zinc-700 dark:text-zinc-300",children:"String Replacement"})]})}),(0,r.jsx)("div",{className:"px-3 py-2 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900 flex items-center",children:(0,r.jsx)("code",{className:"text-xs font-mono text-zinc-700 dark:text-zinc-300",children:d||"Unknown file"})}),o?(0,r.jsx)("div",{className:"flex-1 bg-white dark:bg-zinc-950 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center p-6",children:[(0,r.jsx)(m.A,{className:"h-8 w-8 mx-auto mb-3 text-blue-500 animate-spin"}),(0,r.jsx)("p",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Processing string replacement..."}),d&&(0,r.jsx)("p",{className:"text-xs mt-1 text-zinc-500 dark:text-zinc-400 font-mono",children:d})]})}):(0,r.jsx)("div",{className:"p-3 bg-white dark:bg-zinc-950 font-mono text-sm flex-1",children:h.map((e,t)=>(0,r.jsx)("span",{className:(0,c.cn)("removed"===e.type?"bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-400 line-through mx-0.5":"added"===e.type?"bg-emerald-50 text-emerald-700 dark:bg-emerald-900/20 dark:text-emerald-400 mx-0.5":"text-zinc-700 dark:text-zinc-300"),children:e.text},t))})]})}),(0,r.jsx)("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-800",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-zinc-500 dark:text-zinc-400",children:[!o&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[i?(0,r.jsx)(g.A,{className:"h-3.5 w-3.5 text-emerald-500"}):(0,r.jsx)(b.A,{className:"h-3.5 w-3.5 text-red-500"}),(0,r.jsx)("span",{children:i?"Replacement applied successfully":"Replacement failed"})]}),o&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(m.A,{className:"h-3.5 w-3.5 text-blue-500 animate-spin"}),(0,r.jsx)("span",{children:"Processing string replacement..."})]}),(0,r.jsx)("div",{className:"text-xs",children:l&&!o?j(l):a?j(a):""})]})})]})}var I=s(9343),F=s(64320),_=s(79323),T=s(62332),W=s(64261),U=s(11084),V=s(29621),P=s(92657),O=s(33786),D=s(12969),M=s(24039),$=s(66424),q=s(85127),J=s(62523),B=s(47924);function H(e){let{content:t,className:s}=e,[n,l]=(0,a.useState)(""),[i,o]=(0,a.useState)(1),d=(0,a.useMemo)(()=>{if(!t)return{data:[],headers:[]};try{let e=[],s=[];return(0,M.E3)(t,{header:!0,skipEmptyLines:!0,complete:t=>{t.errors&&t.errors.length>0&&console.error("CSV parsing errors:",t.errors),e=t.meta.fields||[],s=t.data||[]},error:e=>{console.error("CSV parsing error:",e)}}),{data:s,headers:e}}catch(e){return console.error("Failed to parse CSV:",e),{data:[],headers:[]}}},[t]),m=(0,a.useMemo)(()=>{if(!n.trim())return d.data;let e=n.toLowerCase();return d.data.filter(t=>Object.values(t).some(t=>null!=t&&String(t).toLowerCase().includes(e)))},[d.data,n]),h=(0,a.useMemo)(()=>{let e=(i-1)*15;return m.slice(e,e+15)},[m,i,15]),f=Math.max(1,Math.ceil(m.length/15));return(0,a.useEffect)(()=>{o(1)},[n]),(0,r.jsxs)("div",{className:(0,c.cn)("flex flex-col h-full w-full",s),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,r.jsxs)("div",{className:"relative w-full max-w-sm",children:[(0,r.jsx)(B.A,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),(0,r.jsx)(J.p,{type:"text",placeholder:"Search...",value:n,onChange:e=>l(e.target.value),className:"pl-9"})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 ml-4",children:[(0,r.jsx)(p.$,{variant:"outline",size:"icon",onClick:()=>o(Math.max(1,i-1)),disabled:1===i,children:(0,r.jsx)(x.A,{className:"h-4 w-4"})}),(0,r.jsxs)("span",{className:"text-sm text-muted-foreground min-w-[100px] text-center",children:["Page ",i," of ",f]}),(0,r.jsx)(p.$,{variant:"outline",size:"icon",onClick:()=>o(Math.min(f,i+1)),disabled:i===f,children:(0,r.jsx)(u.A,{className:"h-4 w-4"})})]})]}),(0,r.jsx)($.F,{className:"flex-1 w-full relative",children:(0,r.jsx)("div",{className:"min-w-full",children:(0,r.jsxs)(q.Table,{children:[(0,r.jsx)(q.A0,{className:"sticky top-0 bg-background z-10",children:(0,r.jsx)(q.TableRow,{children:d.headers.map((e,t)=>(0,r.jsx)(q.nd,{className:"whitespace-nowrap",children:e},t))})}),(0,r.jsx)(q.TableBody,{children:h.length>0?h.map((e,t)=>(0,r.jsx)(q.TableRow,{children:d.headers.map((t,s)=>(0,r.jsx)(q.TableCell,{className:0===s?"font-medium":"",children:e[t]||""},s))},t)):(0,r.jsx)(q.TableRow,{children:(0,r.jsx)(q.TableCell,{colSpan:d.headers.length||1,className:"h-24 text-center",children:n?"No results found.":"No data available."})})})]})})})]})}var G=s(51362),Y=s(66722),Z=s(63496);let X=e=>{var t;return({html:"html",htm:"html",css:"css",scss:"scss",sass:"scss",less:"less",js:"javascript",jsx:"jsx",ts:"typescript",tsx:"tsx",json:"json",jsonc:"json",xml:"xml",yml:"yaml",yaml:"yaml",toml:"toml",ini:"ini",env:"bash",gitignore:"bash",dockerignore:"bash",py:"python",rb:"ruby",php:"php",go:"go",java:"java",kt:"kotlin",c:"c",cpp:"cpp",h:"c",hpp:"cpp",cs:"csharp",swift:"swift",rs:"rust",sh:"bash",bash:"bash",zsh:"bash",ps1:"powershell",bat:"batch",cmd:"batch",svg:"svg",tex:"latex",graphql:"graphql",gql:"graphql"})[(null==(t=e.split(".").pop())?void 0:t.toLowerCase())||""]||"text"};function K(e){var t;let{assistantContent:s,toolContent:n,assistantTimestamp:l,toolTimestamp:i,isSuccess:o=!0,isStreaming:d=!1,name:x,project:u}=e,{resolvedTheme:h}=(0,G.D)(),p=(()=>{if(x){if(x.includes("create"))return"create";if(x.includes("rewrite"))return"rewrite";if(x.includes("delete"))return"delete"}return!s||s.includes("<create-file>")?"create":s.includes("<full-file-rewrite>")?"rewrite":s.includes("delete-file")||s.includes("<delete>")?"delete":s.toLowerCase().includes("create file")?"create":s.toLowerCase().includes("rewrite file")?"rewrite":s.toLowerCase().includes("delete file")?"delete":"create"})(),f=v(s);w(x||"file-".concat(p));let N="delete"!==p?function(e,t){var s;if(!e)return null;let r="create-file"===t?"create-file":"full-file-rewrite",n=e.match(RegExp("<".concat(r,"[^>]*>([\\s\\S]*?)<\\/").concat(r,">"),"i"));return n&&n[1]?(s=n[1])?s.replace(/\\n/g,"\n").replace(/\\t/g,"	").replace(/\\r/g,"").replace(/\\\\/g,"\\").replace(/\\"/g,'"').replace(/\\'/g,"'"):s:null}(s,"create"===p?"create-file":"full-file-rewrite"):null,k=!f&&"delete"===p,z=f?f.trim().replace(/\\n/g,"\n").split("\n")[0]:null,y=N?N.replace(/\\n/g,"\n").split("\n"):[],E=z?z.split("/").pop()||z:"",S=z?function(e){var t;let s=(null==(t=e.split(".").pop())?void 0:t.toLowerCase())||"";switch(s){case"js":return"JavaScript";case"ts":return"TypeScript";case"jsx":case"tsx":return"React";case"py":return"Python";case"html":return"HTML";case"css":return"CSS";case"json":return"JSON";case"md":return"Markdown";default:return s.toUpperCase()||"Text"}}(z):"",A=E.endsWith(".md"),C=E.endsWith(".html"),L=E.endsWith(".csv"),M=X(E),$="text"!==M,q=C&&(null==u||null==(t=u.sandbox)?void 0:t.sandbox_url)&&z?(0,Z.i)(u.sandbox.sandbox_url,z):void 0;console.log("HTML Preview URL:",q);let[J,B]=(0,a.useState)(C||A||L?"preview":"code");if(!f&&!k||"delete"!==p&&!N)return(0,r.jsx)(R,{name:x||"file-".concat(p),assistantContent:s,toolContent:n,assistantTimestamp:l,toolTimestamp:i,isSuccess:o,isStreaming:d});let K={create:{icon:I.A,successMessage:"File created successfully"},rewrite:{icon:F.A,successMessage:"File rewritten successfully"},delete:{icon:_.A,successMessage:"File deleted successfully"}}[p];return K.icon,(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"flex-1 p-4 overflow-auto",children:["delete"!==p&&N&&!d&&(0,r.jsxs)("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded-md overflow-hidden shadow-sm bg-white dark:bg-zinc-950 h-full flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center p-2 bg-zinc-100 dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 justify-between border-b border-zinc-200 dark:border-zinc-800",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[A?(0,r.jsx)(T.A,{className:"h-4 w-4 mr-2 text-zinc-600 dark:text-zinc-400"}):L?(0,r.jsx)(W.A,{className:"h-4 w-4 mr-2 text-zinc-600 dark:text-zinc-400"}):(0,r.jsx)(U.A,{className:"h-4 w-4 mr-2 text-zinc-600 dark:text-zinc-400"}),(0,r.jsx)("span",{className:"text-xs font-medium",children:E})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[C&&q&&o&&(0,r.jsxs)("div",{className:"flex rounded-md overflow-hidden border border-zinc-200 dark:border-zinc-700",children:[(0,r.jsxs)("button",{onClick:()=>B("code"),className:(0,c.cn)("flex items-center gap-1 text-xs px-2 py-1 transition-colors","code"===J?"bg-zinc-800 text-zinc-100 dark:bg-zinc-700 dark:text-zinc-100":"bg-zinc-200 text-zinc-700 dark:bg-zinc-800 dark:text-zinc-400 hover:bg-zinc-300 dark:hover:bg-zinc-700"),children:[(0,r.jsx)(V.A,{className:"h-3 w-3"}),(0,r.jsx)("span",{children:"Code"})]}),(0,r.jsxs)("button",{onClick:()=>B("preview"),className:(0,c.cn)("flex items-center gap-1 text-xs px-2 py-1 transition-colors","preview"===J?"bg-zinc-800 text-zinc-100 dark:bg-zinc-700 dark:text-zinc-100":"bg-zinc-200 text-zinc-700 dark:bg-zinc-800 dark:text-zinc-400 hover:bg-zinc-300 dark:hover:bg-zinc-700"),children:[(0,r.jsx)(P.A,{className:"h-3 w-3"}),(0,r.jsx)("span",{children:"Preview"})]})]}),A&&o&&(0,r.jsxs)("div",{className:"flex rounded-md overflow-hidden border border-zinc-200 dark:border-zinc-700",children:[(0,r.jsxs)("button",{onClick:()=>B("code"),className:(0,c.cn)("flex items-center gap-1 text-xs px-2 py-1 transition-colors","code"===J?"bg-zinc-800 text-zinc-100 dark:bg-zinc-700 dark:text-zinc-100":"bg-zinc-200 text-zinc-700 dark:bg-zinc-800 dark:text-zinc-400 hover:bg-zinc-300 dark:hover:bg-zinc-700"),children:[(0,r.jsx)(V.A,{className:"h-3 w-3"}),(0,r.jsx)("span",{children:"Code"})]}),(0,r.jsxs)("button",{onClick:()=>B("preview"),className:(0,c.cn)("flex items-center gap-1 text-xs px-2 py-1 transition-colors","preview"===J?"bg-zinc-800 text-zinc-100 dark:bg-zinc-700 dark:text-zinc-100":"bg-zinc-200 text-zinc-700 dark:bg-zinc-800 dark:text-zinc-400 hover:bg-zinc-300 dark:hover:bg-zinc-700"),children:[(0,r.jsx)(P.A,{className:"h-3 w-3"}),(0,r.jsx)("span",{children:"Preview"})]})]}),L&&o&&(0,r.jsxs)("div",{className:"flex rounded-md overflow-hidden border border-zinc-200 dark:border-zinc-700",children:[(0,r.jsxs)("button",{onClick:()=>B("code"),className:(0,c.cn)("flex items-center gap-1 text-xs px-2 py-1 transition-colors","code"===J?"bg-zinc-800 text-zinc-100 dark:bg-zinc-700 dark:text-zinc-100":"bg-zinc-200 text-zinc-700 dark:bg-zinc-800 dark:text-zinc-400 hover:bg-zinc-300 dark:hover:bg-zinc-700"),children:[(0,r.jsx)(V.A,{className:"h-3 w-3"}),(0,r.jsx)("span",{children:"Code"})]}),(0,r.jsxs)("button",{onClick:()=>B("preview"),className:(0,c.cn)("flex items-center gap-1 text-xs px-2 py-1 transition-colors","preview"===J?"bg-zinc-800 text-zinc-100 dark:bg-zinc-700 dark:text-zinc-100":"bg-zinc-200 text-zinc-700 dark:bg-zinc-800 dark:text-zinc-400 hover:bg-zinc-300 dark:hover:bg-zinc-700"),children:[(0,r.jsx)(P.A,{className:"h-3 w-3"}),(0,r.jsx)("span",{children:"Preview"})]})]}),(0,r.jsx)("span",{className:"text-xs text-zinc-500 dark:text-zinc-400 bg-zinc-200 dark:bg-zinc-800 px-2 py-0.5 rounded",children:$?M.toUpperCase():S})]})]}),"code"!==J&&(C||A||L)&&o?null:(0,r.jsx)("div",{className:"flex-1 overflow-auto bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100",children:$?(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("div",{className:"absolute left-0 top-0 bottom-0 w-12 border-r border-zinc-200 dark:border-zinc-800 z-10 flex flex-col",children:y.map((e,t)=>(0,r.jsx)("div",{className:"h-6 text-right pr-3 text-xs font-mono text-zinc-500 dark:text-zinc-500 select-none",children:t+1},t))}),(0,r.jsx)("div",{className:"pl-12",children:(0,r.jsx)(Y.sd,{code:(0,D.w)(N),language:M,className:"text-xs p-2"})})]}):(0,r.jsxs)("div",{className:"min-w-full table",children:[y.map((e,t)=>(0,r.jsxs)("div",{className:"table-row hover:bg-zinc-50 dark:hover:bg-zinc-900 transition-colors",children:[(0,r.jsx)("div",{className:"table-cell text-right pr-3 py-0.5 text-xs font-mono text-zinc-500 dark:text-zinc-500 select-none w-12 border-r border-zinc-200 dark:border-zinc-800",children:t+1}),(0,r.jsx)("div",{className:"table-cell pl-3 py-0.5 text-xs font-mono whitespace-pre text-zinc-800 dark:text-zinc-300",children:(0,D.w)(e)||" "})]},t)),(0,r.jsx)("div",{className:"table-row h-4"})]})}),C&&"preview"===J&&q&&o&&(0,r.jsx)("div",{className:"flex-1 bg-white overflow-hidden",children:(0,r.jsx)("iframe",{src:q,title:"HTML Preview of ".concat(E),className:"w-full h-full border-0",style:{minHeight:"300px"},sandbox:"allow-same-origin allow-scripts"})}),A&&"preview"===J&&o&&(0,r.jsx)("div",{className:"flex-1 overflow-auto bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100",children:(0,r.jsx)(D.T,{content:(0,D.w)(N)})}),L&&"preview"===J&&o&&(0,r.jsx)("div",{className:"flex-1 overflow-hidden bg-white dark:bg-zinc-950",children:(0,r.jsx)(H,{content:(0,D.w)(N)})}),C&&"preview"===J&&q&&o&&(0,r.jsx)("div",{className:"bg-zinc-100 dark:bg-zinc-900 p-2 border-t border-zinc-200 dark:border-zinc-800 flex justify-end",children:(0,r.jsxs)("a",{href:q,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1.5 py-1 px-2 text-xs text-zinc-700 dark:text-zinc-300 bg-zinc-200 dark:bg-zinc-800 hover:bg-zinc-300 dark:hover:bg-zinc-700 rounded transition-colors",children:[(0,r.jsx)(O.A,{className:"h-3.5 w-3.5 text-zinc-500 flex-shrink-0"}),(0,r.jsx)("span",{children:"Open in Browser"})]})})]}),"delete"!==p&&d&&(0,r.jsxs)("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded-md overflow-hidden shadow-sm bg-white dark:bg-zinc-950 h-full flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center p-2 bg-zinc-100 dark:bg-zinc-900 text-zinc-900 dark:text-zinc-100 justify-between border-b border-zinc-200 dark:border-zinc-800",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(U.A,{className:"h-4 w-4 mr-2 text-zinc-600 dark:text-zinc-400"}),(0,r.jsx)("span",{className:"text-xs font-medium",children:E||"file.txt"})]}),(0,r.jsx)("span",{className:"text-xs text-zinc-500 dark:text-zinc-400 bg-zinc-200 dark:bg-zinc-800 px-2 py-0.5 rounded",children:S||"Text"})]}),(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center p-8 bg-white dark:bg-zinc-950",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(m.A,{className:"h-8 w-8 mx-auto mb-3 text-blue-500 animate-spin"}),(0,r.jsx)("p",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"create"===p?"Creating file...":"Rewriting file..."}),(0,r.jsx)("p",{className:"text-xs mt-1 text-zinc-500 dark:text-zinc-400",children:z||"Processing file operation"})]})})]}),"delete"===p&&z&&!d&&(0,r.jsx)("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded-md overflow-hidden h-full flex flex-col",children:(0,r.jsxs)("div",{className:"p-6 flex-1 flex flex-col items-center justify-center bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100",children:[(0,r.jsx)("div",{className:"w-14 h-14 rounded-full bg-red-50 dark:bg-red-900/20 flex items-center justify-center mb-4",children:(0,r.jsx)(_.A,{className:"h-7 w-7 text-red-600 dark:text-red-400"})}),(0,r.jsx)("h3",{className:"text-lg font-medium mb-4 text-red-600 dark:text-red-400",children:"File Deleted"}),(0,r.jsx)("div",{className:"bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-md p-4 w-full max-w-md text-center mb-2",children:(0,r.jsx)("code",{className:"text-sm font-mono text-zinc-700 dark:text-zinc-300 break-all",children:z})}),(0,r.jsx)("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 mt-2",children:"This file has been permanently removed"})]})}),"delete"===p&&d&&(0,r.jsx)("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded-md overflow-hidden h-full flex flex-col",children:(0,r.jsx)("div",{className:"p-6 flex-1 flex flex-col items-center justify-center bg-white dark:bg-zinc-950",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(m.A,{className:"h-8 w-8 mx-auto mb-3 text-blue-500 animate-spin"}),(0,r.jsx)("p",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Deleting file..."}),z&&(0,r.jsx)("p",{className:"text-xs mt-2 font-mono text-zinc-500 dark:text-zinc-400 break-all",children:z})]})})}),"delete"===p&&!z&&!k&&!d&&(0,r.jsx)("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded-md overflow-hidden h-full flex flex-col",children:(0,r.jsxs)("div",{className:"p-6 flex-1 flex flex-col items-center justify-center bg-white dark:bg-zinc-950 text-zinc-900 dark:text-zinc-100",children:[(0,r.jsx)("div",{className:"w-14 h-14 rounded-full bg-red-50 dark:bg-red-900/20 flex items-center justify-center mb-4",children:(0,r.jsx)(_.A,{className:"h-7 w-7 text-red-600 dark:text-red-400"})}),(0,r.jsx)("h3",{className:"text-lg font-medium mb-4 text-red-600 dark:text-red-400",children:"File Deleted"}),(0,r.jsx)("div",{className:"bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-md p-4 w-full max-w-md text-center mb-2",children:(0,r.jsx)("p",{className:"text-sm text-zinc-700 dark:text-zinc-300",children:"Unknown file path"})}),(0,r.jsx)("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 mt-2",children:"A file has been deleted but the path could not be determined"})]})})]}),(0,r.jsx)("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-800",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-zinc-500 dark:text-zinc-400",children:[!d&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[o?(0,r.jsx)(g.A,{className:"h-3.5 w-3.5 text-emerald-500"}):(0,r.jsx)(b.A,{className:"h-3.5 w-3.5 text-red-500"}),(0,r.jsx)("span",{children:o?K.successMessage:"Failed to ".concat(p," file")})]}),d&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(m.A,{className:"h-3.5 w-3.5 text-blue-500 animate-spin"}),(0,r.jsx)("span",{children:"Processing file operation..."})]}),(0,r.jsx)("div",{className:"text-xs",children:i&&!d?j(i):l?j(l):""})]})})]})}var Q=s(66611);function ee(e){var t,s;let l,{name:c="browser-operation",assistantContent:i,toolContent:o,assistantTimestamp:d,toolTimestamp:x,isSuccess:u=!0,isStreaming:h=!1,project:p,agentStatus:f="idle",messages:v=[],currentIndex:N=0,totalCalls:k=1}=e,z=function(e){if(!e)return null;let t=e.match(/url=["'](https?:\/\/[^"']+)["']/);return t?t[1]:null}(i),y=function(e){if(!e)return"Browser Operation";let t=e.replace("browser-","").replace(/-/g," ");return t.charAt(0).toUpperCase()+t.slice(1)}(c);w(c);try{let e=(0,n.jD)(o,{}),t=null==e?void 0:e.content;if(t&&"string"==typeof t){let e=t.match(/\boutput='(.*?)'(?=\s*\))/),s=e?e[1]:null;if(s){let e=s.replace(/\\n/g,"\n").replace(/\\"/g,'"'),t=(0,n.jD)(e,{});l=null==t?void 0:t.message_id}}}catch(e){console.error("[BrowserToolView] Error parsing tool content for message_id:",e)}let E=null;if(l&&v.length>0){let e=v.find(e=>"browser_state"===e.type&&e.message_id===l);if(e){let t=(0,n.jD)(e.content,{});E=(null==t?void 0:t.screenshot_base64)||null}}let S=(null==p||null==(t=p.sandbox)?void 0:t.vnc_preview)?"".concat(p.sandbox.vnc_preview,"/vnc_lite.html?password=").concat(null==p||null==(s=p.sandbox)?void 0:s.pass,"&autoconnect=true&scale=local&width=1024&height=768"):void 0,A=h||"running"===f,C=(0,a.useMemo)(()=>S?(console.log("[BrowserToolView] Creating memoized VNC iframe with URL:",S),(0,r.jsx)("iframe",{src:S,title:"Browser preview",className:"w-full h-full border-0 flex-1"})):null,[S]);return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"flex-1 p-4 overflow-auto",children:(0,r.jsxs)("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded-md overflow-hidden h-full flex flex-col",children:[(0,r.jsxs)("div",{className:"bg-zinc-100 dark:bg-zinc-900 p-2 flex items-center justify-between border-b border-zinc-200 dark:border-zinc-800",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(Q.A,{className:"h-4 w-4 mr-2 text-zinc-600 dark:text-zinc-400"}),(0,r.jsx)("span",{className:"text-xs font-medium text-zinc-700 dark:text-zinc-300",children:"Browser Window"})]}),z&&(0,r.jsx)("div",{className:"text-xs font-mono text-zinc-500 dark:text-zinc-400 truncate max-w-[340px]",children:z})]}),(0,r.jsx)("div",{className:"flex-1 flex items-stretch bg-black",children:N===k-1?A&&C?C:E?(0,r.jsx)("div",{className:"flex items-center justify-center w-full h-full max-h-[650px] overflow-auto",children:(0,r.jsx)("img",{src:"data:image/jpeg;base64,".concat(E),alt:"Browser Screenshot",className:"max-w-full max-h-full object-contain"})}):C||(0,r.jsxs)("div",{className:"p-8 flex flex-col items-center justify-center w-full bg-zinc-50 dark:bg-zinc-900 text-zinc-700 dark:text-zinc-400",children:[(0,r.jsx)(Q.A,{className:"h-12 w-12 mb-3 opacity-40"}),(0,r.jsx)("p",{className:"text-sm font-medium",children:"Browser preview not available"}),z&&(0,r.jsxs)("a",{href:z,target:"_blank",rel:"noopener noreferrer",className:"mt-3 flex items-center text-blue-600 dark:text-blue-500 hover:text-blue-500 dark:hover:text-blue-400 hover:underline",children:["Visit URL ",(0,r.jsx)(O.A,{className:"h-3 w-3 ml-1"})]})]}):E?(0,r.jsx)("div",{className:"flex items-center justify-center w-full h-full max-h-[650px] overflow-auto",children:(0,r.jsx)("img",{src:"data:image/jpeg;base64,".concat(E),alt:"Browser Screenshot",className:"max-w-full max-h-full object-contain"})}):(0,r.jsxs)("div",{className:"p-8 flex flex-col items-center justify-center w-full bg-zinc-50 dark:bg-zinc-900 text-zinc-700 dark:text-zinc-400",children:[(0,r.jsx)(Q.A,{className:"h-12 w-12 mb-3 opacity-40"}),(0,r.jsx)("p",{className:"text-sm font-medium",children:"No Browser State image found"})]})})]})}),(0,r.jsx)("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-800",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-zinc-500 dark:text-zinc-400",children:[!A&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[u?(0,r.jsx)(g.A,{className:"h-3.5 w-3.5 text-emerald-500"}):(0,r.jsx)(b.A,{className:"h-3.5 w-3.5 text-red-500"}),(0,r.jsx)("span",{children:u?"".concat(y," completed successfully"):"".concat(y," failed")})]}),A&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(m.A,{className:"h-3.5 w-3.5 text-blue-500 animate-spin"}),(0,r.jsx)("span",{children:"Executing browser action..."})]}),(0,r.jsx)("div",{className:"text-xs",children:x&&!A?j(x):d?j(d):""})]})})]})}var et=s(27213);function es(e){let{name:t="web-search",assistantContent:s,toolContent:n,assistantTimestamp:l,toolTimestamp:i,isSuccess:o=!0,isStreaming:d=!1}=e,x=function(e){if(!e)return null;let t=e;try{let s=JSON.parse(e);if(s.query&&"string"==typeof s.query)return s.query;if("string"==typeof s.content){if(t=s.content,"string"==typeof s.query)return s.query;if("object"==typeof s.arguments&&null!==s.arguments&&"string"==typeof s.arguments.query)return s.arguments.query;if(Array.isArray(s.tool_calls)&&s.tool_calls.length>0){let e=s.tool_calls[0];if("object"==typeof e.arguments&&null!==e.arguments&&"string"==typeof e.arguments.query)return e.arguments.query;if("string"==typeof e.arguments)try{let t=JSON.parse(e.arguments);if("string"==typeof t.query)return t.query}catch(e){}}}}catch(e){}let s=t.match(/<web-search[^>]*query=[\"']([^\"']*)["'][^>]*>/i);if(s&&s[1])return s[1].trim();let r=t.match(/query=[\"']([\s\S]*?)["']/i);return r&&r[1]?r[1].split(/[\"']/)[0].trim():null}(s),u=function(e){if(!e)return[];try{let t=JSON.parse(e);if(t.results&&Array.isArray(t.results))return t.results.map(e=>({title:e.title||"",url:e.url||"",snippet:e.content||""}));if(t.content&&"string"==typeof t.content){let e=t.content.match(/<tool_result>\s*<web-search>([\s\S]*?)<\/web-search>\s*<\/tool_result>/);if(e)try{return JSON.parse(e[1])}catch(t){return k(e[1])}let s=t.content.match(/ToolResult\(.*?output='([\s\S]*?)'.*?\)/);if(s)try{return JSON.parse(s[1])}catch(e){return k(s[1])}let r=t.content.match(/\[\s*{[\s\S]*}\s*\]/);if(r)try{return JSON.parse(r[0])}catch(e){}return k(t.content)}}catch(e){}return k(e)}(n),h=w(t),[p,f]=a.useState(null),[v,N]=a.useState([]);return a.useEffect(()=>{if(n)try{let e=JSON.parse(n);e.answer&&"string"==typeof e.answer&&f(e.answer),e.images&&Array.isArray(e.images)&&N(e.images)}catch(e){}},[n]),(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"flex-1 p-4 overflow-auto",children:(0,r.jsxs)("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded-md overflow-hidden h-full flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center p-2 bg-zinc-100 dark:bg-zinc-900 justify-between border-b border-zinc-200 dark:border-zinc-800",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(B.A,{className:"h-4 w-4 mr-2 text-zinc-600 dark:text-zinc-400"}),(0,r.jsx)("span",{className:"text-xs font-medium text-zinc-700 dark:text-zinc-300",children:h})]}),!d&&(0,r.jsxs)("span",{className:(0,c.cn)("text-xs flex items-center",o?"text-emerald-600 dark:text-emerald-400":"text-red-600 dark:text-red-400"),children:[(0,r.jsx)("span",{className:"h-1.5 w-1.5 rounded-full mr-1.5 bg-current"}),o?"Success":"Failed"]})]}),(0,r.jsx)("div",{className:"px-3 py-2 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900",children:(0,r.jsx)("code",{className:"text-xs font-mono text-zinc-700 dark:text-zinc-300",children:x||"Unknown query"})}),(0,r.jsx)("div",{className:"flex-1 overflow-auto bg-white dark:bg-zinc-950 font-mono text-sm",children:d?(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center p-6",children:[(0,r.jsx)(m.A,{className:"h-8 w-8 mx-auto mb-3 text-blue-500 animate-spin"}),(0,r.jsx)("p",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Searching the web..."}),(0,r.jsx)("p",{className:"text-xs mt-1 text-zinc-500 dark:text-zinc-400",children:"This might take a moment"})]})}):u.length>0?(0,r.jsxs)("div",{className:"p-3",children:[p&&(0,r.jsxs)("div",{className:"mb-4 bg-blue-50 dark:bg-blue-950 p-3 rounded-md border border-blue-100 dark:border-blue-900",children:[(0,r.jsx)("h3",{className:"text-xs font-medium text-blue-700 dark:text-blue-400 mb-1",children:"Answer"}),(0,r.jsx)("p",{className:"text-sm text-zinc-700 dark:text-zinc-300 whitespace-pre-wrap font-sans",children:p})]}),v.length>0&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsxs)("h3",{className:"text-xs font-medium text-zinc-500 dark:text-zinc-400 mb-2 flex items-center",children:[(0,r.jsx)(et.A,{className:"h-3.5 w-3.5 mr-1"}),"Images"]}),(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 max-h-48 overflow-y-auto",children:v.map((e,t)=>(0,r.jsxs)("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"group relative overflow-hidden rounded border border-zinc-200 dark:border-zinc-800 bg-zinc-100 dark:bg-zinc-900 hover:border-blue-300 dark:hover:border-blue-700 transition-colors",children:[(0,r.jsx)("img",{src:e,alt:"Search result ".concat(t+1),className:"object-cover w-full h-24 group-hover:opacity-90 transition-opacity",onError:e=>{let t=e.target;t.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23888' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Crect x='3' y='3' width='18' height='18' rx='2' ry='2'%3E%3C/rect%3E%3Ccircle cx='8.5' cy='8.5' r='1.5'%3E%3C/circle%3E%3Cpolyline points='21 15 16 10 5 21'%3E%3C/polyline%3E%3C/svg%3E",t.classList.add("p-4")}}),(0,r.jsx)("div",{className:"absolute inset-0 bg-black opacity-0 group-hover:opacity-10 transition-opacity"})]},t))})]}),(0,r.jsxs)("div",{className:"text-xs font-medium text-zinc-500 dark:text-zinc-400 mb-3",children:["Found ",u.length," results"]}),(0,r.jsx)("div",{className:"divide-y divide-zinc-100 dark:divide-zinc-800 bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-md",children:u.map((e,t)=>(0,r.jsxs)("div",{className:"p-3 space-y-1",children:[(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("div",{className:"text-xs text-zinc-500 dark:text-zinc-400 truncate mb-0.5",children:z(e.url)}),(0,r.jsxs)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-blue-600 dark:text-blue-400 hover:underline font-medium flex items-center gap-1",children:[e.title,(0,r.jsx)(O.A,{className:"h-3 w-3 opacity-60"})]})]}),e.snippet&&(0,r.jsx)("p",{className:"text-xs text-zinc-600 dark:text-zinc-400 line-clamp-2",children:e.snippet})]},t))})]}):(0,r.jsxs)("div",{className:"p-6 text-center flex-1 flex flex-col items-center justify-center h-full",children:[(0,r.jsx)(B.A,{className:"h-6 w-6 mx-auto mb-2 text-zinc-400 dark:text-zinc-500"}),(0,r.jsx)("p",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"No results found"}),(0,r.jsx)("p",{className:"text-xs mt-1 text-zinc-500 dark:text-zinc-400",children:"Try refining your search query"})]})})]})}),(0,r.jsx)("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-800",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-zinc-500 dark:text-zinc-400",children:[!d&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[o?(0,r.jsx)(g.A,{className:"h-3.5 w-3.5 text-emerald-500"}):(0,r.jsx)(b.A,{className:"h-3.5 w-3.5 text-red-500"}),(0,r.jsx)("span",{children:o?"".concat(h," completed successfully"):"".concat(h," operation failed")})]}),d&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(m.A,{className:"h-3.5 w-3.5 text-blue-500 animate-spin"}),(0,r.jsxs)("span",{children:["Executing ",h.toLowerCase(),"..."]})]}),(0,r.jsx)("div",{className:"text-xs",children:i&&!d?j(i):l?j(l):""})]})})]})}var er=s(34869);function en(e){let{name:t="crawl-webpage",assistantContent:s,toolContent:n,assistantTimestamp:a,toolTimestamp:l,isSuccess:i=!0,isStreaming:o=!1}=e,d=y(s),x=E(n),u=w(t);if(!d)return(0,r.jsx)(R,{name:t,assistantContent:s,toolContent:n,assistantTimestamp:a,toolTimestamp:l,isSuccess:i,isStreaming:o});let h=d?(e=>{try{return new URL(e).hostname.replace("www.","")}catch(t){return e}})(d):"Unknown";return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"flex-1 p-4 overflow-auto",children:(0,r.jsxs)("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded-md overflow-hidden h-full flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center p-2 bg-zinc-100 dark:bg-zinc-900 justify-between border-b border-zinc-200 dark:border-zinc-800",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(er.A,{className:"h-4 w-4 mr-2 text-zinc-600 dark:text-zinc-400"}),(0,r.jsx)("span",{className:"text-xs font-medium text-zinc-700 dark:text-zinc-300",children:u})]}),!o&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("span",{className:(0,c.cn)("text-xs flex items-center",i?"text-emerald-600 dark:text-emerald-400":"text-red-600 dark:text-red-400"),children:[(0,r.jsx)("span",{className:"h-1.5 w-1.5 rounded-full mr-1.5 bg-current"}),i?"Success":"Failed"]}),(0,r.jsxs)("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1.5 py-1 px-2 text-xs text-zinc-700 dark:text-zinc-300 bg-zinc-200 dark:bg-zinc-800 hover:bg-zinc-300 dark:hover:bg-zinc-700 rounded transition-colors",children:[(0,r.jsx)(O.A,{className:"h-3.5 w-3.5 text-zinc-500 flex-shrink-0"}),(0,r.jsx)("span",{children:"Open URL"})]})]})]}),(0,r.jsx)("div",{className:"px-3 py-2 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900",children:(0,r.jsx)("code",{className:"text-xs font-mono text-zinc-700 dark:text-zinc-300",children:d})}),o?(0,r.jsx)("div",{className:"flex-1 bg-white dark:bg-zinc-950 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center p-6",children:[(0,r.jsx)(m.A,{className:"h-8 w-8 mx-auto mb-3 text-blue-500 animate-spin"}),(0,r.jsx)("p",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Crawling webpage..."}),(0,r.jsxs)("p",{className:"text-xs mt-1 text-zinc-500 dark:text-zinc-400",children:["Fetching content from ",h]})]})}):(0,r.jsx)("div",{className:"flex-1 overflow-auto bg-white dark:bg-zinc-950 font-mono text-sm",children:x?(0,r.jsxs)("div",{className:"p-3",children:[(0,r.jsx)("div",{className:"text-xs font-medium text-zinc-500 dark:text-zinc-400 mb-2",children:"Page Content"}),(0,r.jsx)("div",{className:"bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-md",children:(0,r.jsx)("pre",{className:"p-3 text-xs overflow-auto whitespace-pre-wrap text-zinc-800 dark:text-zinc-300 font-mono",children:x.text||"No content extracted"})})]}):(0,r.jsx)("div",{className:"p-6 h-full flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(er.A,{className:"h-6 w-6 mx-auto mb-2 text-zinc-400 dark:text-zinc-500"}),(0,r.jsx)("p",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"No content extracted"}),(0,r.jsx)("p",{className:"text-xs mt-1 text-zinc-500 dark:text-zinc-400",children:"The webpage might be restricted or empty"})]})})})]})}),(0,r.jsx)("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-800",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-zinc-500 dark:text-zinc-400",children:[!o&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[i?(0,r.jsx)(g.A,{className:"h-3.5 w-3.5 text-emerald-500"}):(0,r.jsx)(b.A,{className:"h-3.5 w-3.5 text-red-500"}),(0,r.jsx)("span",{children:i?"".concat(u," completed successfully"):"".concat(u," operation failed")})]}),o&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(m.A,{className:"h-3.5 w-3.5 text-blue-500 animate-spin"}),(0,r.jsxs)("span",{children:["Executing ",u.toLowerCase(),"..."]})]}),(0,r.jsx)("div",{className:"text-xs",children:l&&!o?j(l):a?j(a):""})]})})]})}function ea(e){let{name:t="scrape-webpage",assistantContent:s,toolContent:n,assistantTimestamp:a,toolTimestamp:l,isSuccess:i=!0,isStreaming:o=!1}=e,d=y(s),x=E(n),u=w(t);if(!d)return(0,r.jsx)(R,{name:t,assistantContent:s,toolContent:n,assistantTimestamp:a,toolTimestamp:l,isSuccess:i,isStreaming:o});let h=d?(e=>{try{return new URL(e).hostname.replace("www.","")}catch(t){return e}})(d):"Unknown";return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"flex-1 p-4 overflow-auto",children:(0,r.jsxs)("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded-md overflow-hidden h-full flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center p-2 bg-zinc-100 dark:bg-zinc-900 justify-between border-b border-zinc-200 dark:border-zinc-800",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(er.A,{className:"h-4 w-4 mr-2 text-zinc-600 dark:text-zinc-400"}),(0,r.jsx)("span",{className:"text-xs font-medium text-zinc-700 dark:text-zinc-300",children:u})]}),!o&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("span",{className:(0,c.cn)("text-xs flex items-center",i?"text-emerald-600 dark:text-emerald-400":"text-red-600 dark:text-red-400"),children:[(0,r.jsx)("span",{className:"h-1.5 w-1.5 rounded-full mr-1.5 bg-current"}),i?"Success":"Failed"]}),(0,r.jsxs)("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-1.5 py-1 px-2 text-xs text-zinc-700 dark:text-zinc-300 bg-zinc-200 dark:bg-zinc-800 hover:bg-zinc-300 dark:hover:bg-zinc-700 rounded transition-colors",children:[(0,r.jsx)(O.A,{className:"h-3.5 w-3.5 text-zinc-500 flex-shrink-0"}),(0,r.jsx)("span",{children:"Open URL"})]})]})]}),(0,r.jsx)("div",{className:"px-3 py-2 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900",children:(0,r.jsx)("code",{className:"text-xs font-mono text-zinc-700 dark:text-zinc-300",children:d})}),o?(0,r.jsx)("div",{className:"flex-1 bg-white dark:bg-zinc-950 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center p-6",children:[(0,r.jsx)(m.A,{className:"h-8 w-8 mx-auto mb-3 text-blue-500 animate-spin"}),(0,r.jsx)("p",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"Scraping webpage..."}),(0,r.jsxs)("p",{className:"text-xs mt-1 text-zinc-500 dark:text-zinc-400",children:["Fetching content from ",h]})]})}):(0,r.jsx)("div",{className:"flex-1 overflow-auto bg-white dark:bg-zinc-950 font-mono text-sm",children:x?(0,r.jsxs)("div",{className:"p-3",children:[(0,r.jsx)("div",{className:"text-xs font-medium text-zinc-500 dark:text-zinc-400 mb-2",children:"Page Content"}),(0,r.jsx)("div",{className:"bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-md",children:(0,r.jsx)("pre",{className:"p-3 text-xs overflow-auto whitespace-pre-wrap text-zinc-800 dark:text-zinc-300 font-mono",children:x.text||"No content extracted"})})]}):(0,r.jsx)("div",{className:"p-6 h-full flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)(er.A,{className:"h-6 w-6 mx-auto mb-2 text-zinc-400 dark:text-zinc-500"}),(0,r.jsx)("p",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300",children:"No content extracted"}),(0,r.jsx)("p",{className:"text-xs mt-1 text-zinc-500 dark:text-zinc-400",children:"The webpage might be restricted or empty"})]})})})]})}),(0,r.jsx)("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-800",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-zinc-500 dark:text-zinc-400",children:[!o&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[i?(0,r.jsx)(g.A,{className:"h-3.5 w-3.5 text-emerald-500"}):(0,r.jsx)(b.A,{className:"h-3.5 w-3.5 text-red-500"}),(0,r.jsx)("span",{children:i?"".concat(u," completed successfully"):"".concat(u," operation failed")})]}),o&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(m.A,{className:"h-3.5 w-3.5 text-blue-500 animate-spin"}),(0,r.jsxs)("span",{children:["Executing ",u.toLowerCase(),"..."]})]}),(0,r.jsx)("div",{className:"text-xs",children:l&&!o?j(l):a?j(a):""})]})})]})}var el=s(19302),ec=s(54213);function ei(e){let{name:t="unknown",assistantContent:s,toolContent:l,isSuccess:i=!0,isStreaming:o=!1,assistantTimestamp:d,toolTimestamp:x}=e,u=w(t);(0,n.S8)(t)||el.A;let h=a.useMemo(()=>{if(!s)return null;try{let e=JSON.parse(s);if(e.content){let s=e.content.match(/service_name=\\?"([^"\\]+)\\?"/),r=e.content.match(/route=\\?"([^"\\]+)\\?"/),n=null;if("execute-data-provider-call"===t){let t=e.content.match(/{([^}]+)}/);if(t)try{n=JSON.parse("{".concat(t[1],"}"))}catch(e){n=t[1]}}return{service:s?s[1]:void 0,route:r?r[1]:void 0,payload:n}}}catch(e){console.error("Error parsing assistant content:",e)}return null},[s,t]),p=a.useMemo(()=>{if(!l||o)return null;try{let e=l.match(/<tool_result>\s*<[^>]+>([\s\S]*?)<\/[^>]+>\s*<\/tool_result>/),t=e?e[1]:l,s=t.match(/ToolResult\(success=.+?, output='([\s\S]*?)'\)/);s&&(t=s[1]);try{t=t.replace(/\\"/g,'"').replace(/\\n/g,"\n");let e=JSON.parse(t);return JSON.stringify(e,null,2)}catch(e){return t}}catch(e){return l}},[l,o]);return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"flex-1 p-4 overflow-auto",children:(0,r.jsxs)("div",{className:"border border-zinc-200 dark:border-zinc-800 rounded-md overflow-hidden h-full flex flex-col",children:[(0,r.jsxs)("div",{className:"flex items-center p-2 bg-zinc-100 dark:bg-zinc-900 justify-between border-b border-zinc-200 dark:border-zinc-800",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(ec.A,{className:"h-4 w-4 mr-2 text-zinc-600 dark:text-zinc-400"}),(0,r.jsx)("span",{className:"text-xs font-medium text-zinc-700 dark:text-zinc-300",children:u})]}),!o&&(0,r.jsxs)("span",{className:(0,c.cn)("text-xs flex items-center",i?"text-emerald-600 dark:text-emerald-400":"text-red-600 dark:text-red-400"),children:[(0,r.jsx)("span",{className:"h-1.5 w-1.5 rounded-full mr-1.5 bg-current"}),i?"Success":"Failed"]})]}),h&&(0,r.jsx)("div",{className:"px-3 py-2 border-b border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900",children:(0,r.jsxs)("code",{className:"text-xs font-mono text-zinc-700 dark:text-zinc-300",children:[h.service,h.route&&"/".concat(h.route)]})}),o?(0,r.jsx)("div",{className:"flex-1 bg-white dark:bg-zinc-950 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center p-6",children:[(0,r.jsx)(m.A,{className:"h-8 w-8 mx-auto mb-3 text-blue-500 animate-spin"}),(0,r.jsxs)("p",{className:"text-sm font-medium text-zinc-700 dark:text-zinc-300",children:["Processing ",t.toLowerCase()," operation..."]}),(null==h?void 0:h.service)&&(null==h?void 0:h.route)&&(0,r.jsxs)("p",{className:"text-xs mt-1 text-zinc-500 dark:text-zinc-400 font-mono",children:[h.service,"/",h.route]})]})}):(0,r.jsx)("div",{className:"flex-1 bg-white dark:bg-zinc-950 font-mono text-sm",children:(0,r.jsxs)("div",{className:"p-3",children:[(null==h?void 0:h.payload)&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("div",{className:"text-xs font-medium text-zinc-500 dark:text-zinc-400 mb-2",children:"Request Payload"}),(0,r.jsx)("div",{className:"bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-md",children:(0,r.jsx)("pre",{className:"p-3 text-xs overflow-auto whitespace-pre-wrap text-zinc-800 dark:text-zinc-300 font-mono",children:"object"==typeof h.payload?JSON.stringify(h.payload,null,2):h.payload})})]}),p&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs font-medium text-zinc-500 dark:text-zinc-400 mb-2",children:"Response Data"}),(0,r.jsx)("div",{className:"bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-md",children:(0,r.jsx)("pre",{className:"p-3 text-xs overflow-auto whitespace-pre-wrap text-zinc-800 dark:text-zinc-300 font-mono",children:p})})]}),!(null==h?void 0:h.payload)&&!p&&s&&(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("div",{className:"text-xs font-medium text-zinc-500 dark:text-zinc-400 mb-2",children:"Raw Request"}),(0,r.jsx)("div",{className:"bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-md",children:(0,r.jsx)("pre",{className:"p-3 text-xs overflow-auto whitespace-pre-wrap text-zinc-800 dark:text-zinc-300 font-mono",children:s})})]}),!p&&l&&(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-xs font-medium text-zinc-500 dark:text-zinc-400 mb-2",children:"Raw Response"}),(0,r.jsx)("div",{className:"bg-zinc-50 dark:bg-zinc-900 border border-zinc-200 dark:border-zinc-800 rounded-md",children:(0,r.jsx)("pre",{className:"p-3 text-xs overflow-auto whitespace-pre-wrap text-zinc-800 dark:text-zinc-300 font-mono",children:l})})]})]})})]})}),(0,r.jsx)("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-800",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-zinc-500 dark:text-zinc-400",children:[!o&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[i?(0,r.jsx)(g.A,{className:"h-3.5 w-3.5 text-emerald-500"}):(0,r.jsx)(b.A,{className:"h-3.5 w-3.5 text-red-500"}),(0,r.jsx)("span",{children:i?"".concat(u," completed successfully"):"".concat(u," operation failed")})]}),o&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(m.A,{className:"h-3.5 w-3.5 text-blue-500 animate-spin"}),(0,r.jsxs)("span",{children:["Executing ",u.toLowerCase(),"..."]})]}),(0,r.jsx)("div",{className:"text-xs",children:x&&!o?j(x):d?j(d):""})]})})]})}function eo(e){let{name:t="expose-port",assistantContent:s,toolContent:n,isSuccess:l=!0,isStreaming:i=!1,assistantTimestamp:o,toolTimestamp:d}=e;console.log("ExposePortToolView:",{name:t,assistantContent:s,toolContent:n,isSuccess:l,isStreaming:i,assistantTimestamp:o,toolTimestamp:d});let m=a.useMemo(()=>{if(!s)return null;try{return JSON.parse(s).content}catch(e){return console.error("Failed to parse assistant content:",e),null}},[s]),x=a.useMemo(()=>{if(!n)return null;try{let e=JSON.parse(n).content.match(/output='(.*?)'/);if(e){let t=e[1].replace(/\\n/g,"").replace(/\\"/g,'"');return JSON.parse(t)}return null}catch(e){return console.error("Failed to parse tool content:",e),null}},[n]),u=a.useMemo(()=>{if(!m)return null;try{let e=m.match(/<expose-port>\s*(\d+)\s*<\/expose-port>/);return e?e[1]:null}catch(e){return console.error("Failed to extract port number:",e),null}},[m]);return u||x||i?(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsxs)("div",{className:"flex-1 p-4 overflow-auto",children:[u&&!i&&(0,r.jsxs)("div",{className:"space-y-1.5",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("div",{className:"text-xs font-medium text-zinc-500 dark:text-zinc-400",children:"Port to Expose"}),o&&(0,r.jsx)("div",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:j(o)})]}),(0,r.jsx)("div",{className:"rounded-md border border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900 p-3",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"text-xs font-medium text-zinc-800 dark:text-zinc-300",children:"Port"}),(0,r.jsx)("div",{className:"px-2 py-1 rounded-md bg-zinc-100 dark:bg-zinc-800 text-xs font-mono text-zinc-800 dark:text-zinc-300",children:u})]})})]}),x&&(0,r.jsxs)("div",{className:"space-y-1.5 mt-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsx)("div",{className:"text-xs font-medium text-zinc-500 dark:text-zinc-400",children:i?"Processing":"Exposed URL"}),d&&!i&&(0,r.jsx)("div",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:j(d)})]}),(0,r.jsx)("div",{className:(0,c.cn)("rounded-md border p-3",i?"border-blue-200 bg-blue-50 dark:border-blue-800 dark:bg-blue-900/10":l?"border-zinc-200 bg-zinc-50 dark:border-zinc-800 dark:bg-zinc-900":"border-red-200 bg-red-50 dark:border-red-800 dark:bg-red-900/10"),children:i?(0,r.jsx)("div",{className:"flex items-center gap-2 text-xs font-medium text-blue-700 dark:text-blue-400",children:(0,r.jsxs)("span",{children:["Exposing port ",u,"..."]})}):(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(O.A,{className:"h-4 w-4 text-zinc-500 dark:text-zinc-400"}),(0,r.jsx)("a",{href:x.url,target:"_blank",rel:"noopener noreferrer",className:"text-xs font-medium text-blue-600 dark:text-blue-400 hover:underline break-all",children:x.url})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"text-xs text-zinc-600 dark:text-zinc-400",children:"Port"}),(0,r.jsx)("div",{className:"px-2 py-1 rounded-md bg-zinc-100 dark:bg-zinc-800 text-xs font-mono text-zinc-800 dark:text-zinc-300",children:x.port})]}),(0,r.jsx)("div",{className:"text-xs text-zinc-600 dark:text-zinc-400",children:x.message}),(0,r.jsx)("div",{className:"text-xs text-amber-600 dark:text-amber-400 italic",children:"Note: This URL might only be temporarily available and could expire after some time."})]})})]})]}),(0,r.jsx)("div",{className:"p-4 border-t border-zinc-200 dark:border-zinc-800",children:(0,r.jsxs)("div",{className:"flex items-center justify-between text-xs text-zinc-500 dark:text-zinc-400",children:[!i&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[l?(0,r.jsx)(g.A,{className:"h-3.5 w-3.5 text-emerald-500"}):(0,r.jsx)(b.A,{className:"h-3.5 w-3.5 text-red-500"}),(0,r.jsx)("span",{children:l?"Port exposed successfully":"Failed to expose port"})]}),i&&(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)("span",{children:"Exposing port..."})}),(0,r.jsx)("div",{className:"text-xs",children:d&&!i?j(d):o?j(o):""})]})})]}):(0,r.jsx)("div",{className:"flex flex-col h-full p-4",children:(0,r.jsx)("div",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:"No port exposure information available"})})}function ed(e){var t,s,l,f;let{isOpen:g,onClose:b,toolCalls:j,currentIndex:w,onNavigate:v,messages:N,agentStatus:k,project:z,renderAssistantMessage:y,renderToolResult:E,isLoading:A=!1}=e,[C,I]=a.useState(""),F=j[w],_=j.length,T=(null==F||null==(t=F.assistantCall)?void 0:t.name)||"Tool Call",W=(0,n.S8)("Tool Call"===T?"unknown":T),U=(null==F||null==(s=F.toolResult)?void 0:s.content)==="STREAMING",V=null==(f=null==F||null==(l=F.toolResult)?void 0:l.isSuccess)||f,P=(0,h.a)();a.useEffect(()=>{if(!g)return;let e=e=>{(e.metaKey||e.ctrlKey)&&"i"===e.key&&(e.preventDefault(),b())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[g,b]),a.useEffect(()=>{if(!g)return;let e=e=>{e.detail.expanded&&b()};return window.addEventListener("sidebar-left-toggled",e),()=>window.removeEventListener("sidebar-left-toggled",e)},[g,b]),a.useEffect(()=>{if(!U)return;let e=setInterval(()=>{I(e=>"..."===e?"":e+".")},500);return()=>clearInterval(e)},[U]);let O=a.useCallback(()=>{w>0&&v(w-1)},[w,v]),D=a.useCallback(()=>{w<_-1&&v(w+1)},[w,_,v]);return g?A?(0,r.jsx)("div",{className:(0,c.cn)("fixed inset-y-0 right-0 border-l flex flex-col z-30 h-screen transition-all duration-200 ease-in-out",P?"w-full":"w-[90%] sm:w-[450px] md:w-[500px] lg:w-[550px] xl:w-[650px]",!g&&"translate-x-full"),children:(0,r.jsx)("div",{className:"flex-1 flex flex-col overflow-hidden bg-background",children:(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"pt-4 pl-4 pr-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)("h2",{className:"text-lg font-medium text-zinc-900 dark:text-zinc-100",children:"Suna's Computer"})}),(0,r.jsx)(p.$,{variant:"ghost",size:"icon",onClick:b,className:"h-8 w-8",children:(0,r.jsx)(d.A,{className:"h-4 w-4"})})]})}),(0,r.jsx)("div",{className:"flex-1 p-4 overflow-auto",children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsx)(o.E,{className:"h-8 w-32"}),(0,r.jsx)(o.E,{className:"h-20 w-full rounded-md"}),(0,r.jsx)(o.E,{className:"h-40 w-full rounded-md"}),(0,r.jsx)(o.E,{className:"h-20 w-full rounded-md"})]})})]})})}):(0,r.jsxs)("div",{className:(0,c.cn)("fixed inset-y-0 right-0 border-l flex flex-col z-30 h-screen transition-all duration-200 ease-in-out",P?"w-full":"w-[90%] sm:w-[450px] md:w-[500px] lg:w-[550px] xl:w-[650px]",!g&&"translate-x-full"),children:[(0,r.jsx)("div",{className:"flex-1 flex flex-col overflow-hidden bg-background",children:(()=>{var e,t,s,n,a,l;if(!F)return(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"pt-4 pl-4 pr-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)("h2",{className:"text-lg font-medium text-zinc-900 dark:text-zinc-100",children:"Suna's Computer"})}),(0,r.jsx)(p.$,{variant:"ghost",size:"icon",onClick:b,className:"h-8 w-8",children:(0,r.jsx)(d.A,{className:"h-4 w-4"})})]})}),(0,r.jsx)("div",{className:"flex items-center justify-center flex-1 p-4",children:(0,r.jsx)("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 text-center",children:"No tool call details available."})})]});let i=function(e,t,s,n,a){let l=!(arguments.length>5)||void 0===arguments[5]||arguments[5],c=arguments.length>6?arguments[6]:void 0,i=arguments.length>7?arguments[7]:void 0,o=arguments.length>8?arguments[8]:void 0,d=arguments.length>9?arguments[9]:void 0,m=arguments.length>10?arguments[10]:void 0,x=arguments.length>11?arguments[11]:void 0;if(!e)return null;let u=e.toLowerCase();switch(u){case"execute-command":return(0,r.jsx)(S,{assistantContent:t,toolContent:s,assistantTimestamp:n,toolTimestamp:a,isSuccess:l});case"str-replace":return(0,r.jsx)(L,{assistantContent:t,toolContent:s,assistantTimestamp:n,toolTimestamp:a,isSuccess:l});case"expose-port":return(0,r.jsx)(eo,{assistantContent:t,toolContent:s,assistantTimestamp:n,toolTimestamp:a,isSuccess:l,isStreaming:x});case"create-file":case"full-file-rewrite":case"delete-file":return(0,r.jsx)(K,{assistantContent:t,toolContent:s,assistantTimestamp:n,toolTimestamp:a,isSuccess:l,name:u,project:c});case"browser-navigate":case"browser-click":case"browser-extract":case"browser-fill":case"browser-wait":return(0,r.jsx)(ee,{currentIndex:d,totalCalls:m,agentStatus:o,messages:i,name:u,assistantContent:t,toolContent:s,assistantTimestamp:n,toolTimestamp:a,isSuccess:l,project:c});case"web-search":return(0,r.jsx)(es,{assistantContent:t,toolContent:s,assistantTimestamp:n,toolTimestamp:a,isSuccess:l});case"crawl-webpage":return(0,r.jsx)(en,{assistantContent:t,toolContent:s,assistantTimestamp:n,toolTimestamp:a,isSuccess:l});case"scrape-webpage":return(0,r.jsx)(ea,{assistantContent:t,toolContent:s,assistantTimestamp:n,toolTimestamp:a,isSuccess:l});case"execute-data-provider-call":case"get-data-provider-endpoints":return(0,r.jsx)(ei,{name:u,assistantContent:t,toolContent:s,assistantTimestamp:n,toolTimestamp:a,isSuccess:l,isStreaming:x});default:if(u.startsWith("browser-"))return(0,r.jsx)(ee,{currentIndex:d,totalCalls:m,agentStatus:o,messages:i,name:e,assistantContent:t,toolContent:s,assistantTimestamp:n,toolTimestamp:a,isSuccess:l,project:c});return(0,r.jsx)(R,{name:e,assistantContent:t,toolContent:s,assistantTimestamp:n,toolTimestamp:a,isSuccess:l,isStreaming:x})}}(F.assistantCall.name,F.assistantCall.content,null==(e=F.toolResult)?void 0:e.content,F.assistantCall.timestamp,null==(t=F.toolResult)?void 0:t.timestamp,!!U||null==(l=null==(s=F.toolResult)?void 0:s.isSuccess)||l,z,N,k,w,_,U);return i?(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"pt-4 pl-4 pr-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)("h2",{className:"text-lg font-medium text-zinc-900 dark:text-zinc-100",children:"Suna's Computer"})}),(null==(n=F.toolResult)?void 0:n.content)&&!U&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"h-6 w-6 rounded-full bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center",children:(0,r.jsx)(W,{className:"h-3.5 w-3.5 text-zinc-800 dark:text-zinc-300"})}),(0,r.jsx)("span",{className:(0,c.cn)("text-sm text-zinc-700 dark:text-zinc-300",P&&"hidden sm:inline"),children:T}),(0,r.jsx)("div",{className:(0,c.cn)("px-2.5 py-0.5 rounded-full text-xs font-medium",V?"bg-emerald-50 text-emerald-700 dark:bg-emerald-900/20 dark:text-emerald-400":"bg-red-50 text-red-700 dark:bg-red-900/20 dark:text-red-400"),children:V?"Success":"Failed"}),(0,r.jsx)(p.$,{variant:"ghost",size:"icon",onClick:b,className:"h-8 w-8 ml-1",children:(0,r.jsx)(d.A,{className:"h-4 w-4"})})]}),U&&(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-50 text-blue-700 dark:bg-blue-900/20 dark:text-blue-400 flex items-center gap-1.5",children:[(0,r.jsx)(m.A,{className:"h-3 w-3 animate-spin"}),(0,r.jsx)("span",{children:"Running"})]}),(0,r.jsx)(p.$,{variant:"ghost",size:"icon",onClick:b,className:"h-8 w-8 ml-1",children:(0,r.jsx)(d.A,{className:"h-4 w-4"})})]}),!(null==(a=F.toolResult)?void 0:a.content)&&!U&&(0,r.jsx)(p.$,{variant:"ghost",size:"icon",onClick:b,className:"h-8 w-8",children:(0,r.jsx)(d.A,{className:"h-4 w-4"})})]})}),(0,r.jsx)("div",{className:"flex-1 overflow-auto scrollbar-thin scrollbar-thumb-zinc-300 dark:scrollbar-thumb-zinc-700 scrollbar-track-transparent",children:i})]}):(0,r.jsxs)("div",{className:"flex flex-col h-full",children:[(0,r.jsx)("div",{className:"pt-4 pl-4 pr-4",children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)("h2",{className:"text-lg font-medium text-zinc-900 dark:text-zinc-100",children:"Suna's Computer"})}),(0,r.jsx)(p.$,{variant:"ghost",size:"icon",onClick:b,className:"h-8 w-8",children:(0,r.jsx)(d.A,{className:"h-4 w-4"})})]})}),(0,r.jsx)("div",{className:"flex items-center justify-center flex-1 p-4",children:(0,r.jsx)("p",{className:"text-sm text-zinc-500 dark:text-zinc-400 text-center",children:"Unable to display tool details."})})]})})()}),_>1&&(0,r.jsxs)("div",{className:(0,c.cn)("border-t border-zinc-200 dark:border-zinc-800 bg-zinc-50 dark:bg-zinc-900",P?"p-3":"p-4 space-y-2"),children:[!P&&(0,r.jsxs)("div",{className:"flex justify-between items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 min-w-0",children:[(0,r.jsx)("div",{className:"h-5 w-5 rounded-full bg-zinc-100 dark:bg-zinc-800 flex items-center justify-center",children:(0,r.jsx)(W,{className:"h-3 w-3 text-zinc-800 dark:text-zinc-300"})}),(0,r.jsxs)("span",{className:"text-xs font-medium text-zinc-700 dark:text-zinc-300 truncate",title:T,children:[T," ",U&&"(Running".concat(C,")")]})]}),(0,r.jsxs)("span",{className:"text-xs text-zinc-500 dark:text-zinc-400 flex-shrink-0",children:["Step ",w+1," of ",_]})]}),P?(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)(p.$,{variant:"outline",size:"sm",onClick:O,disabled:w<=0,className:"h-9 px-3",children:[(0,r.jsx)(x.A,{className:"h-4 w-4 mr-1"}),(0,r.jsx)("span",{children:"Previous"})]}),(0,r.jsxs)("span",{className:"text-xs text-zinc-500 dark:text-zinc-400",children:[w+1," / ",_]}),(0,r.jsxs)(p.$,{variant:"outline",size:"sm",onClick:D,disabled:w>=_-1,className:"h-9 px-3",children:[(0,r.jsx)("span",{children:"Next"}),(0,r.jsx)(u.A,{className:"h-4 w-4 ml-1"})]})]}):(0,r.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(p.$,{variant:"ghost",size:"icon",onClick:O,disabled:w<=0,className:"h-6 w-6 text-zinc-500 hover:text-zinc-700 dark:text-zinc-400 dark:hover:text-zinc-200",children:(0,r.jsx)(x.A,{className:"h-3.5 w-3.5"})}),(0,r.jsx)(p.$,{variant:"ghost",size:"icon",onClick:D,disabled:w>=_-1,className:"h-6 w-6 text-zinc-500 hover:text-zinc-700 dark:text-zinc-400 dark:hover:text-zinc-200",children:(0,r.jsx)(u.A,{className:"h-3.5 w-3.5"})})]}),(0,r.jsx)(i,{min:0,max:_-1,step:1,value:[w],onValueChange:e=>{let[t]=e;return v(t)},className:"w-full [&>span:first-child]:h-1 [&>span:first-child]:bg-zinc-200 dark:[&>span:first-child]:bg-zinc-800 [&>span:first-child>span]:bg-zinc-500 dark:[&>span:first-child>span]:bg-zinc-400 [&>span:first-child>span]:h-1"})]})]})]}):null}},51548:(e,t,s)=>{s.d(t,{S:()=>J});var r=s(95155),n=s(12115),a=s(54165),l=s(30285),c=s(57340),i=s(13052),o=s(94631),d=s(91788),m=s(57434),x=s(66474),u=s(29869),h=s(1243),p=s(21380),f=s(99890),g=s(66424),b=s(59434),j=s(12969),w=s(34513),v=s(13824),N=s(55404),k=s(49280);function z(e){let{url:t,className:s}=e,[a,l]=(0,n.useState)(null),[c,i]=(0,n.useState)(1),[o,d]=(0,n.useState)(1);function m(e){i(t=>{let s=t+e;return s>=1&&s<=(a||1)?s:t})}return(0,r.jsxs)("div",{className:(0,b.cn)("flex flex-col w-full h-full",s),children:[(0,r.jsx)("div",{className:"flex-1 overflow-auto rounded-md",children:(0,r.jsx)(N.A,{file:t,onLoadSuccess:function(e){let{numPages:t}=e;l(t)},className:"flex flex-col items-center",children:(0,r.jsx)(k.A,{pageNumber:c,scale:o,renderTextLayer:!0,renderAnnotationLayer:!0})})}),a&&(0,r.jsxs)("div",{className:"flex items-center justify-between p-2 bg-background border-t",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:function(){d(e=>Math.max(e-.2,.5))},className:"px-2 py-1 bg-muted rounded hover:bg-muted/80",disabled:o<=.5,children:"-"}),(0,r.jsxs)("span",{children:[Math.round(100*o),"%"]}),(0,r.jsx)("button",{onClick:function(){d(e=>Math.min(e+.2,3))},className:"px-2 py-1 bg-muted rounded hover:bg-muted/80",disabled:o>=3,children:"+"})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("button",{onClick:function(){m(-1)},className:"px-2 py-1 bg-muted rounded hover:bg-muted/80",disabled:c<=1,children:"Previous"}),(0,r.jsxs)("span",{children:["Page ",c," of ",a]}),(0,r.jsx)("button",{onClick:function(){m(1)},className:"px-2 py-1 bg-muted rounded hover:bg-muted/80",disabled:c>=a,children:"Next"})]})]})]})}s(88851),s(42465),v.EA.workerSrc=new s.U(s(27266)).toString();var y=s(6262),E=s(54481),S=s(32568),A=s(81284),C=s(91981),R=s(74311);function L(e){let{url:t,className:s}=e,[a,c]=(0,n.useState)(1),[i,o]=(0,n.useState)(0),[d,m]=(0,n.useState)(!1),[x,u]=(0,n.useState)({x:0,y:0}),[h,p]=(0,n.useState)({x:0,y:0}),[f,g]=(0,n.useState)(!0),[j,w]=(0,n.useState)(!1),[v,N]=(0,n.useState)(!1),[k,z]=(0,n.useState)(null),L=(0,n.useRef)(null),I=(0,n.useRef)(null),F=(null==t?void 0:t.toLowerCase().endsWith(".svg"))||(null==t?void 0:t.includes("image/svg"));(0,n.useEffect)(()=>{f&&u({x:0,y:0})},[a,f]);let _=()=>{if(w(!0),N(!1),I.current){var e;z({width:I.current.naturalWidth,height:I.current.naturalHeight,type:F?"SVG":(null==(e=t.split(".").pop())?void 0:e.toUpperCase())||"Image"})}},T=()=>{w(!1),N(!0)},W="scale(".concat(a,") rotate(").concat(i,"deg)"),U="translate(".concat(x.x,"px, ").concat(x.y,"px)"),[V,P]=(0,n.useState)(!1);return(0,r.jsxs)("div",{className:(0,b.cn)("flex flex-col w-full h-full",s),children:[(0,r.jsxs)("div",{className:"flex items-center justify-between py-2 px-4 bg-muted/30 border-b mb-2 rounded-t-md",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(l.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>{let e=Math.max(a-.25,.5);c(e),.5===e&&g(!0)},title:"Zoom out",disabled:v,children:(0,r.jsx)(y.A,{className:"h-4 w-4"})}),(0,r.jsxs)("span",{className:"text-xs font-medium",children:[Math.round(100*a),"%"]}),(0,r.jsx)(l.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>{c(e=>Math.min(e+.25,3)),g(!1)},title:"Zoom in",disabled:v,children:(0,r.jsx)(E.A,{className:"h-4 w-4"})}),(0,r.jsx)(l.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>{o(e=>(e+90)%360)},title:"Rotate",disabled:v,children:(0,r.jsx)(S.A,{className:"h-4 w-4"})})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)(l.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>P(!V),title:"Image information",children:(0,r.jsx)(A.A,{className:"h-4 w-4"})}),(0,r.jsx)(l.$,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",onClick:()=>{f?(c(1),g(!1)):(c(.5),u({x:0,y:0}),g(!0))},title:f?"Actual size":"Fit to screen",disabled:v,children:f?(0,r.jsx)(C.A,{className:"h-4 w-4"}):(0,r.jsx)(R.A,{className:"h-4 w-4"})})]})]}),V&&k&&(0,r.jsxs)("div",{className:"absolute top-16 right-4 z-50 bg-background/80 backdrop-blur-sm p-3 rounded-md shadow-md border border-border text-xs",children:[(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Type:"})," ",k.type]}),(0,r.jsxs)("p",{children:[(0,r.jsx)("strong",{children:"Dimensions:"})," ",k.width," \xd7 ",k.height]})]}),(0,r.jsx)("div",{ref:L,className:"flex-1 overflow-hidden relative bg-grid-pattern rounded-b-md",onMouseDown:e=>{a>.5&&(m(!0),p({x:e.clientX-x.x,y:e.clientY-x.y}))},onMouseMove:e=>{d&&a>.5&&u({x:e.clientX-h.x,y:e.clientY-h.y})},onMouseUp:()=>{m(!1)},onMouseLeave:()=>{m(!1)},style:{cursor:d?"grabbing":a>.5?"grab":"default",backgroundColor:"#f5f5f5",backgroundImage:"linear-gradient(45deg, #e0e0e0 25%, transparent 25%), linear-gradient(-45deg, #e0e0e0 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #e0e0e0 75%), linear-gradient(-45deg, transparent 75%, #e0e0e0 75%)",backgroundSize:"20px 20px",backgroundPosition:"0 0, 0 10px, 10px -10px, -10px 0px"},children:v?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full p-6 text-center",children:[(0,r.jsx)("p",{className:"text-destructive font-medium mb-2",children:"Failed to load image"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"The image could not be displayed"})]}):(0,r.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",style:{transform:f?"none":U,transition:d?"none":"transform 0.1s ease"},children:F?(0,r.jsx)("object",{data:t,type:"image/svg+xml",className:"max-w-full max-h-full",style:{transform:W,transition:"transform 0.2s ease",width:"100%",height:"100%"},children:(0,r.jsx)("img",{ref:I,src:t,alt:"SVG preview",className:"max-w-full max-h-full object-contain",style:{transform:W,transition:"transform 0.2s ease"},draggable:!1,onLoad:_,onError:T})}):(0,r.jsx)("img",{ref:I,src:t,alt:"Image preview",className:"max-w-full max-h-full object-contain",style:{transform:W,transition:"transform 0.2s ease"},draggable:!1,onLoad:_,onError:T})})})]})}function I(e){var t;let{url:s,fileName:n,className:a}=e,c=(null==(t=n.split(".").pop())?void 0:t.toLowerCase())||"";return(0,r.jsx)("div",{className:(0,b.cn)("flex flex-col items-center justify-center p-10",a),children:(0,r.jsxs)("div",{className:"flex flex-col items-center text-center max-w-md",children:[(0,r.jsxs)("div",{className:"relative mb-6",children:[(0,r.jsx)(f.A,{className:"h-24 w-24 text-muted-foreground/50"}),(0,r.jsx)("div",{className:"absolute bottom-1 right-1 bg-background rounded-sm px-1.5 py-0.5 text-xs font-medium text-muted-foreground border",children:c.toUpperCase()})]}),(0,r.jsx)("h3",{className:"text-lg font-semibold mb-2",children:n}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-6",children:"This binary file cannot be previewed in the browser"}),(0,r.jsxs)(l.$,{variant:"default",className:"min-w-[150px]",onClick:()=>{let e=document.createElement("a");e.href=s,e.download=n,document.body.appendChild(e),e.click(),document.body.removeChild(e)},children:[(0,r.jsx)(d.A,{className:"h-4 w-4 mr-2"}),"Download"]})]})})}var F=s(14738),_=s(29621),T=s(33786);function W(e){let{content:t,previewUrl:s,className:a}=e,[c,i]=(0,n.useState)("preview");return(0,r.jsx)("div",{className:(0,b.cn)("w-full h-full flex flex-col",a),children:(0,r.jsxs)("div",{className:"flex-1 min-h-0 relative",children:[(0,r.jsxs)("div",{className:"absolute left-2 top-2 z-10 flex items-center gap-2",children:[(0,r.jsxs)(l.$,{variant:"ghost",size:"sm",className:(0,b.cn)("flex items-center gap-2 bg-background/80 backdrop-blur-sm hover:bg-background/90","preview"===c&&"bg-background/90"),onClick:()=>i("preview"),children:[(0,r.jsx)(F.A,{className:"h-4 w-4"}),"Preview"]}),(0,r.jsxs)(l.$,{variant:"ghost",size:"sm",className:(0,b.cn)("flex items-center gap-2 bg-background/80 backdrop-blur-sm hover:bg-background/90","code"===c&&"bg-background/90"),onClick:()=>i("code"),children:[(0,r.jsx)(_.A,{className:"h-4 w-4"}),"Code"]}),(0,r.jsxs)(l.$,{variant:"ghost",size:"sm",className:"flex items-center gap-2 bg-background/80 backdrop-blur-sm hover:bg-background/90",onClick:()=>window.open(s,"_blank"),children:[(0,r.jsx)(T.A,{className:"h-4 w-4"}),"Open"]})]}),"preview"===c?(0,r.jsx)("div",{className:"absolute inset-0",children:(0,r.jsx)("iframe",{src:s,title:"HTML Preview",className:"w-full h-full border-0",sandbox:"allow-same-origin allow-scripts"})}):(0,r.jsx)("div",{className:"absolute inset-0",children:(0,r.jsx)(w.$,{content:t,language:"html",className:"w-full h-full"})})]})})}var U=s(63496);function V(e){var t,s,a;let{content:l,binaryUrl:c,fileName:i,className:o,project:d,markdownRef:m}=e,x=function(e){var t;let s=(null==(t=e.split(".").pop())?void 0:t.toLowerCase())||"";if(["md","markdown"].includes(s))return"markdown";if(["js","jsx","ts","tsx","html","css","json","py","python","java","c","cpp","h","cs","go","rs","php","rb","sh","bash","xml","yml","yaml","toml","sql","graphql","swift","kotlin","dart","r","lua","scala","perl","haskell","rust"].includes(s))return"code";if(["png","jpg","jpeg","gif","webp","svg","bmp","ico"].includes(s))return"image";if(["pdf"].includes(s))return"pdf";if(["txt","csv","log","env","ini"].includes(s))return"text";else return"binary"}(i),u={js:"javascript",jsx:"jsx",ts:"typescript",tsx:"tsx",html:"html",css:"css",json:"json",py:"python",python:"python",java:"java",c:"c",cpp:"cpp",h:"c",cs:"csharp",go:"go",rs:"rust",php:"php",rb:"ruby",sh:"shell",bash:"shell",xml:"xml",yml:"yaml",yaml:"yaml",sql:"sql"}[(null==(a=i.split(".").pop())?void 0:a.toLowerCase())||""]||"",h=i.toLowerCase().endsWith(".html"),p=n.useMemo(()=>{var e;if(h&&l&&!(null==d||null==(e=d.sandbox)?void 0:e.sandbox_url)){let e=new Blob([l],{type:"text/html"});return URL.createObjectURL(e)}},[h,l,null==d||null==(t=d.sandbox)?void 0:t.sandbox_url]),f=h&&(null==d||null==(s=d.sandbox)?void 0:s.sandbox_url)&&i?(0,U.i)(d.sandbox.sandbox_url,i):p;return n.useEffect(()=>()=>{p&&URL.revokeObjectURL(p)},[p]),(0,r.jsx)("div",{className:(0,b.cn)("w-full h-full",o),children:"binary"===x?(0,r.jsx)(I,{url:c||"",fileName:i}):"image"===x&&c?(0,r.jsx)(L,{url:c}):"pdf"===x&&c?(0,r.jsx)(z,{url:c}):"markdown"===x?(0,r.jsx)(j.T,{content:l||"",ref:m}):h?(0,r.jsx)(W,{content:l||"",previewUrl:f||"",className:"w-full h-full"}):"code"===x||"text"===x?(0,r.jsx)(w.$,{content:l||"",language:u,className:"w-full h-full"}):(0,r.jsx)("div",{className:"w-full h-full p-4",children:(0,r.jsx)("pre",{className:"text-sm font-mono whitespace-pre-wrap break-words leading-relaxed bg-muted/30 p-4 rounded-lg overflow-auto max-h-full",children:l||""})})})}var P=s(25731),O=s(56671),D=s(52643),M=s(64541),$=s(44838),q=s(43089);function J(e){let{open:t,onOpenChange:s,sandboxId:b,initialFilePath:j,project:w}=e,{session:v}=(0,M.A)(),[N,k]=(0,n.useState)("/workspace"),[z,y]=(0,n.useState)([]),[E,S]=(0,n.useState)(!1),[A,C]=(0,n.useState)(!0),[R,L]=(0,n.useState)(!1),I=(0,n.useRef)(null),[F,_]=(0,n.useState)(null),[T,W]=(0,n.useState)(null),[U,J]=(0,n.useState)(null),[B,H]=(0,n.useState)(null),[G,Y]=(0,n.useState)(!1),[Z,X]=(0,n.useState)(null),K=(0,n.useRef)(null),{data:Q,isLoading:ee,error:et}=(0,q.iy)(b,F,{contentType:"text"}),[es,er]=(0,n.useState)(!1),[en,ea]=(0,n.useState)(!1),el=(0,n.useRef)(null),[ec,ei]=(0,n.useState)(!1),[eo,ed]=(0,n.useState)(w),[em,ex]=(0,n.useState)(!1);(0,n.useRef)(null);let eu=(0,n.useRef)(null),[eh,ep]=(0,n.useState)("portrait"),ef=(0,n.useRef)(new Set);(0,n.useEffect)(()=>{w&&ed(w)},[w,b]);let eg=(0,n.useCallback)(e=>"string"==typeof e&&e?e.startsWith("/workspace")?e:"/workspace/".concat(e.replace(/^\//,"")):(console.warn("[FILE VIEWER] normalizePath received non-string or empty value:",e,"Returning '/workspace'"),"/workspace"),[]),eb=e=>e instanceof Blob,ej=(0,n.useCallback)(()=>{_(null),W(null),J(null),H(null),X(null),Y(!1),K.current=null},[]),ew=(0,n.useCallback)(async e=>{if(e.is_dir){if(!e.is_dir)return;let t=eg(e.path);console.log("[FILE VIEWER] Navigating to folder: ".concat(e.path," → ").concat(t)),console.log("[FILE VIEWER] Current path before navigation: ".concat(N)),ej(),k(t);return}if(F===e.path&&T)return void console.log("[FILE VIEWER] File already loaded: ".concat(e.path));console.log("[FILE VIEWER] Opening file: ".concat(e.path));let t=q.pH.isImageFile(e.path),s=q.pH.isPdfFile(e.path);t?console.log("[FILE VIEWER][IMAGE DEBUG] Opening image file: ".concat(e.path)):s&&console.log("[FILE VIEWER] Opening PDF file: ".concat(e.path)),ej(),Y(!0),_(e.path),K.current=e.path;try{if(!(null==v?void 0:v.access_token))throw Error("Authentication token missing. Please refresh the page and login again.");let t=performance.now(),r=s?"blob":q.pH.getContentTypeFromPath(e.path);console.log("[FILE VIEWER] Fetching content for ".concat(e.path," with content type: ").concat(r));let n=await (0,q.j8)(b,e.path,{contentType:r,force:s,token:v.access_token}),a=Math.round(performance.now()-t);if(console.log("[FILE VIEWER] Received content for ".concat(e.path," in ").concat(a,"ms (").concat(typeof n,")")),K.current!==e.path){console.log("[FILE VIEWER] Selection changed during loading, aborting. Loading: ".concat(K.current,", Expected: ").concat(e.path)),Y(!1);return}if(W(n),"string"==typeof n)if(n.startsWith("blob:"))console.log("[FILE VIEWER] Setting blob URL directly: ".concat(n)),J(null),H(n);else if(s){console.error("[FILE VIEWER] Received PDF content as string instead of blob, length: ".concat(n.length)),console.log("[FILE VIEWER] First 100 chars of content: ".concat(n.substring(0,100))),console.log("[FILE VIEWER] Retrying PDF fetch with explicit blob type and force refresh");let t=await (0,q.j8)(b,e.path,{contentType:"blob",force:!0,token:v.access_token});if("string"==typeof t&&t.startsWith("blob:"))console.log("[FILE VIEWER] Successfully got blob URL on retry: ".concat(t)),J(null),H(t);else throw Error("Failed to load PDF in correct format after retry")}else console.log("[FILE VIEWER] Setting text content directly for renderer."),J(n),H(null);else if(eb(n)){console.log("[FILE VIEWER] Content is a Blob. Creating blob URL.");let e=URL.createObjectURL(n);console.log("[FILE VIEWER] Created blob URL: ".concat(e)),J(null),H(e)}Y(!1)}catch(t){if(console.error("[FILE VIEWER] Error loading file:",t),K.current===e.path){let e=t instanceof Error?t.message:String(t);e.includes("Authentication token required")||e.includes("Authentication token missing")?(O.oR.error("Authentication error. Please refresh and login again."),X("Authentication error. Please refresh the page and login again.")):X("Failed to load file: ".concat(e)),Y(!1),W(null)}}finally{K.current===e.path&&(K.current=null)}},[b,F,T,ej,null==v?void 0:v.access_token,N,eg]);(0,n.useEffect)(()=>{if(!t||!b)return;if(E&&I.current===N)return void console.log("[FILE VIEWER] Already loading ".concat(N,", skipping duplicate load"));I.current=N,console.log("[FILE VIEWER] Starting navigation to: ".concat(N));let e=setTimeout(async()=>{S(!0),console.log("[FILE VIEWER] useEffect[currentPath]: Triggered. Loading files for path: ".concat(N));try{let e;console.log("[FILE VIEWER] Checking cache for directory listing at ".concat(N));let t="".concat(b,":directory:").concat(N);q.pH.has(t)&&!A?(console.log("[FILE VIEWER] Using cached directory listing for ".concat(N)),e=q.pH.get(t)):(console.log("[FILE VIEWER] Cache miss, fetching directory listing from API for ".concat(N)),(e=await (0,P.XY)(b,N))&&Array.isArray(e)&&(console.log("[FILE VIEWER] Caching directory listing: ".concat(e.length," files")),q.pH.set(t,e))),I.current===N?(console.log("[FILE VIEWER] useEffect[currentPath]: Got ".concat((null==e?void 0:e.length)||0," files for ").concat(N)),y(e||[])):console.log("[FILE VIEWER] Path changed during loading, aborting file update for ".concat(N)),A&&C(!1)}catch(e){console.error("Failed to load files:",e),O.oR.error("Failed to load files"),I.current===N&&y([])}finally{I.current===N&&(S(!1),console.log("[FILE VIEWER] Completed loading for: ".concat(N)))}},50);return()=>clearTimeout(e)},[t,b,N,A,E]);let ev=(0,n.useCallback)(e=>{if(!e.is_dir)return;let t=eg(e.path);console.log("[FILE VIEWER] Navigating to folder: ".concat(e.path," → ").concat(t)),console.log("[FILE VIEWER] Current path before navigation: ".concat(N)),ej(),k(t)},[eg,ej,N]),eN=(0,n.useCallback)(e=>{let t=eg(e);console.log("[FILE VIEWER] Navigating to breadcrumb path: ".concat(e," → ").concat(t)),ej(),k(t)},[eg,ej]),ek=(0,n.useCallback)(()=>{console.log("[FILE VIEWER] Navigating home from:",N),ej(),k("/workspace")},[ej,N]),ez=(0,n.useCallback)(e=>{let t=eg(e).replace(/^\/workspace\/?/,"");if(!t)return[];let s=t.split("/").filter(Boolean),r="/workspace";return s.map((e,t)=>(r="".concat(r,"/").concat(e),{name:e,path:r,isLast:t===s.length-1}))},[eg]);(0,n.useCallback)(e=>{let t=e;t.startsWith("/workspace")||(t="/workspace/".concat(t.startsWith("/")?t.substring(1):t));let s=q.pH.getContentTypeFromPath(e),r="".concat(b,":").concat(t,":").concat(s);if(console.log("[FILE VIEWER] Checking cache for key: ".concat(r)),q.pH.has(r)){let e=q.pH.get(r);return console.log("[FILE VIEWER] Direct cache hit for ".concat(t," (").concat(s,")")),{found:!0,content:e,contentType:s}}return console.log("[FILE VIEWER] Cache miss for key: ".concat(r)),{found:!1,content:null,contentType:s}},[b]),(0,n.useEffect)(()=>{if(t&&j&&!ec){console.log("[FILE VIEWER] useEffect[initialFilePath]: Processing initial path: ".concat(j));let e=eg(j),t=e.lastIndexOf("/"),s=t>0?e.substring(0,t):"/workspace",r=t>=0?e.substring(t+1):"";if(console.log("[FILE VIEWER] useEffect[initialFilePath]: Normalized Path: ".concat(e,", Directory: ").concat(s,", File: ").concat(r)),N!==s&&(console.log("[FILE VIEWER] useEffect[initialFilePath]: Setting current path to ".concat(s)),k(s)),j){console.log("[FILE VIEWER] Attempting to load initial file directly from cache: ".concat(j));let t={name:r,path:e,is_dir:!1,size:0,mod_time:new Date().toISOString()};console.log("[FILE VIEWER] Opening initial file: ".concat(e)),ew(t)}ei(!0)}else t||(console.log("[FILE VIEWER] useEffect[initialFilePath]: Modal closed, resetting initialPathProcessed flag."),ei(!1))},[t,j,ec,eg,N,ew]),(0,n.useEffect)(()=>{if(T&&eb(T)&&F&&!B){let e=F.match(/\.(png|jpg|jpeg|gif|svg|webp|bmp)$/i),t=URL.createObjectURL(T);e?(console.log("[FILE VIEWER][IMAGE DEBUG] Created new blob URL: ".concat(t," for image: ").concat(F)),console.log("[FILE VIEWER][IMAGE DEBUG] Image blob size: ".concat(T.size," bytes, type: ").concat(T.type))):console.log("[FILE VIEWER] Created blob URL: ".concat(t," for ").concat(F)),H(t)}return()=>{B&&(console.log("[FILE VIEWER] Revoking blob URL on cleanup: ".concat(B)),URL.revokeObjectURL(B))}},[T,F,eb,B]),(0,n.useEffect)(()=>{if(F){if(ee&&!G)Y(!0);else if(!ee&&G){if(et)X("Failed to load file: ".concat(et.message));else if(null!==Q){if(console.log("[FILE VIEWER] Received cached content type: ".concat(typeof Q)),console.log("[FILE VIEWER] Received cached content is Blob: ".concat(eb(Q))),console.log("[FILE VIEWER] Received cached content is string: ".concat("string"==typeof Q)),console.log("[FILE VIEWER] Received cached content starts with blob: ".concat("string"==typeof Q&&Q.startsWith("blob:"))),q.pH.isPdfFile(F))if("string"==typeof Q&&Q.startsWith("blob:"))console.log("[FILE VIEWER] Using existing blob URL for PDF"),H(Q),J(null);else if(eb(Q))console.log("[FILE VIEWER] Creating new blob URL from cached PDF blob"),H(URL.createObjectURL(Q)),J(null);else{console.log("[FILE VIEWER] Invalid PDF content type, forcing refresh with blob type"),(async()=>{try{console.log("[FILE VIEWER] Explicitly fetching PDF as blob");let e=await (0,q.j8)(b,F,{contentType:"blob",force:!0,token:null==v?void 0:v.access_token});"string"==typeof e&&e.startsWith("blob:")?(console.log("[FILE VIEWER] Received correct blob URL for PDF: ".concat(e)),H(e),J(null)):(console.error("[FILE VIEWER] Failed to get correct PDF format after retry"),X("Failed to load PDF in correct format"))}catch(e){console.error("[FILE VIEWER] Error loading PDF:",e),X("Failed to load PDF: ".concat(e instanceof Error?e.message:String(e)))}finally{Y(!1)}})();return}else if(W(Q),"string"==typeof Q)Q.startsWith("blob:")?(J(null),H(Q)):(J(Q),H(null));else if(Q&&eb(Q)){let e=URL.createObjectURL(Q);J(null),H(e)}}Y(!1)}}},[F,Q,ee,et,G,eb,ew,b,null==v?void 0:v.access_token]),(0,n.useEffect)(()=>()=>{!B||en||ef.current.has(B)||(console.log("[FILE VIEWER] Revoking blob URL on cleanup: ".concat(B)),URL.revokeObjectURL(B))},[B,en]);let ey=(0,n.useCallback)(e=>{e||(console.log("[FILE VIEWER] handleOpenChange: Modal closing, resetting state."),!B||en||ef.current.has(B)||(console.log("[FILE VIEWER] Manually revoking blob URL on modal close: ".concat(B)),URL.revokeObjectURL(B)),ej(),k("/workspace"),y([]),ei(!1),C(!0)),s(e)},[s,ej,C,B,en]),eE=(0,n.useCallback)(e=>!!e&&e.toLowerCase().endsWith(".md"),[]),eS=(0,n.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"portrait";if(F&&!em&&eE(F)){ex(!0);try{if(!eu.current)throw Error("Markdown content not found");let t=window.open("","_blank");if(!t)throw Error("Unable to open print window. Please check if popup blocker is enabled.");window.location.origin;let s=(F.split("/").pop()||"document").replace(/\.md$/,""),r=eu.current.innerHTML,n='\n        <!DOCTYPE html>\n        <html>\n        <head>\n          <meta charset="UTF-8">\n          <title>'.concat(s,"</title>\n          <style>\n            @media print {\n              @page { \n                size: ").concat("landscape"===e?"A4 landscape":"A4",";\n                margin: 15mm;\n              }\n              body {\n                -webkit-print-color-adjust: exact;\n                print-color-adjust: exact;\n              }\n            }\n            body {\n              font-family: 'Helvetica', 'Arial', sans-serif;\n              font-size: 12pt;\n              color: #333;\n              line-height: 1.5;\n              padding: 20px;\n              max-width: 100%;\n              margin: 0 auto;\n              background: white;\n            }\n            h1 { font-size: 24pt; margin-top: 20pt; margin-bottom: 12pt; }\n            h2 { font-size: 20pt; margin-top: 18pt; margin-bottom: 10pt; }\n            h3 { font-size: 16pt; margin-top: 16pt; margin-bottom: 8pt; }\n            h4, h5, h6 { font-weight: bold; margin-top: 12pt; margin-bottom: 6pt; }\n            p { margin: 8pt 0; }\n            pre, code {\n              font-family: 'Courier New', monospace;\n              background-color: #f5f5f5;\n              border-radius: 3pt;\n              padding: 2pt 4pt;\n              font-size: 10pt;\n            }\n            pre {\n              padding: 8pt;\n              margin: 8pt 0;\n              overflow-x: auto;\n              white-space: pre-wrap;\n            }\n            code {\n              white-space: pre-wrap;\n            }\n            img {\n              max-width: 100%;\n              height: auto;\n            }\n            a {\n              color: #0066cc;\n              text-decoration: underline;\n            }\n            ul, ol {\n              padding-left: 20pt;\n              margin: 8pt 0;\n            }\n            blockquote {\n              margin: 8pt 0;\n              padding-left: 12pt;\n              border-left: 4pt solid #ddd;\n              color: #666;\n            }\n            table {\n              border-collapse: collapse;\n              width: 100%;\n              margin: 12pt 0;\n            }\n            th, td {\n              border: 1pt solid #ddd;\n              padding: 6pt;\n              text-align: left;\n            }\n            th {\n              background-color: #f5f5f5;\n              font-weight: bold;\n            }\n            /* Syntax highlighting basic styles */\n            .hljs-keyword, .hljs-selector-tag { color: #569cd6; }\n            .hljs-literal, .hljs-number { color: #b5cea8; }\n            .hljs-string { color: #ce9178; }\n            .hljs-comment { color: #6a9955; }\n            .hljs-attribute, .hljs-attr { color: #9cdcfe; }\n            .hljs-function, .hljs-name { color: #dcdcaa; }\n            .hljs-title.class_ { color: #4ec9b0; }\n            .markdown-content pre { background-color: #f8f8f8; }\n          </style>\n        </head>\n        <body>\n          <div class=\"markdown-content\">\n            ").concat(r,"\n          </div>\n          <script>\n            // Remove any complex CSS variables or functions that might cause issues\n            document.querySelectorAll('[style]').forEach(el => {\n              const style = el.getAttribute('style');\n              if (style && (style.includes('oklch') || style.includes('var(--') || style.includes('hsl('))) {\n                // Replace complex color values with simple ones or remove them\n                el.setAttribute('style', style\n                  .replace(/color:.*?(;|$)/g, 'color: #333;')\n                  .replace(/background-color:.*?(;|$)/g, 'background-color: transparent;')\n                );\n              }\n            });\n            \n            // Print automatically when loaded\n            window.onload = () => {\n              setTimeout(() => {\n                window.print();\n                setTimeout(() => window.close(), 500);\n              }, 300);\n            };\n          <\/script>\n        </body>\n        </html>\n      ");t.document.open(),t.document.write(n),t.document.close(),O.oR.success("PDF export initiated. Check your print dialog.")}catch(e){console.error("PDF export failed:",e),O.oR.error("Failed to export PDF: ".concat(e instanceof Error?e.message:String(e)))}finally{ex(!1)}}},[F,em,eE]),eA=async()=>{if(F&&!en)try{ea(!0),console.log("[FILE VIEWER] Starting download for: ".concat(F));let e="".concat(b,":").concat(F),t=q.pH.get(e);if(t){console.log("[FILE VIEWER] Using cached content for download");let e=URL.createObjectURL(t);console.log("[FILE VIEWER] Created download URL from cache: ".concat(e));let s=document.createElement("a");s.href=e,s.download=F.split("/").pop()||"file",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(e)}else{console.log("[FILE VIEWER] Cache miss for download, fetching fresh content");let e=await (0,q.j8)(b,F,{contentType:q.pH.getContentTypeFromPath(F),force:!0,token:null==v?void 0:v.access_token});if(!e)throw Error("Failed to fetch file content");let t=URL.createObjectURL(e);console.log("[FILE VIEWER] Created download URL: ".concat(t));let s=document.createElement("a");s.href=t,s.download=F.split("/").pop()||"file",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(t)}O.oR.success("Download started")}catch(e){console.error("Download failed:",e),O.oR.error("Failed to download file: ".concat(e instanceof Error?e.message:String(e)))}finally{ea(!1)}},eC=(0,n.useCallback)(()=>{el.current&&el.current.click()},[]),eR=(0,n.useCallback)(async e=>{if(!e.target.files||0===e.target.files.length)return;let t=e.target.files[0];er(!0);try{let e=new FormData;e.append("file",t),e.append("path","".concat(N,"/").concat(t.name));let s=(0,D.U)(),{data:{session:r}}=await s.auth.getSession();if(!(null==r?void 0:r.access_token))throw Error("No access token available");let n=await fetch("".concat("https://api.suna.so/api","/sandboxes/").concat(b,"/files"),{method:"POST",headers:{Authorization:"Bearer ".concat(r.access_token)},body:e});if(!n.ok){let e=await n.text();throw Error(e||"Upload failed")}let a=await (0,P.XY)(b,N);y(a),O.oR.success("Uploaded: ".concat(t.name))}catch(e){console.error("Upload failed:",e),O.oR.error("Upload failed: ".concat(e instanceof Error?e.message:String(e)))}finally{er(!1),e.target&&(e.target.value="")}},[N,b]);return(0,r.jsx)(a.lG,{open:t,onOpenChange:ey,children:(0,r.jsxs)(a.Cf,{className:"sm:max-w-[90vw] md:max-w-[1200px] w-[95vw] h-[90vh] max-h-[900px] flex flex-col p-0 gap-0 overflow-hidden",children:[(0,r.jsx)(a.c7,{className:"px-4 py-2 border-b flex-shrink-0",children:(0,r.jsx)(a.L3,{className:"text-lg font-semibold",children:"Workspace Files"})}),(0,r.jsxs)("div",{className:"px-4 py-2 border-b flex items-center gap-2",children:[(0,r.jsx)(l.$,{variant:"ghost",size:"icon",onClick:ek,className:"h-8 w-8",title:"Go to home directory",children:(0,r.jsx)(c.A,{className:"h-4 w-4"})}),(0,r.jsxs)("div",{className:"flex items-center overflow-x-auto flex-1 min-w-0 scrollbar-hide whitespace-nowrap",children:[(0,r.jsx)(l.$,{variant:"ghost",size:"sm",className:"h-7 px-2 text-sm font-medium min-w-fit flex-shrink-0",onClick:ek,children:"home"}),"/workspace"!==N&&(0,r.jsx)(r.Fragment,{children:ez(N).map((e,t)=>(0,r.jsxs)(n.Fragment,{children:[(0,r.jsx)(i.A,{className:"h-4 w-4 mx-1 text-muted-foreground opacity-50 flex-shrink-0"}),(0,r.jsx)(l.$,{variant:"ghost",size:"sm",className:"h-7 px-2 text-sm font-medium truncate max-w-[200px]",onClick:()=>eN(e.path),children:e.name})]},e.path))}),F&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.A,{className:"h-4 w-4 mx-1 text-muted-foreground opacity-50 flex-shrink-0"}),(0,r.jsx)("div",{className:"flex items-center gap-2",children:(0,r.jsx)("span",{className:"text-sm font-medium truncate",children:F.split("/").pop()})})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2 flex-shrink-0",children:[F&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(l.$,{variant:"outline",size:"sm",onClick:eA,disabled:en||G,className:"h-8 gap-1",children:[en?(0,r.jsx)(o.A,{className:"h-4 w-4 animate-spin"}):(0,r.jsx)(d.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Download"})]}),eE(F)&&(0,r.jsxs)($.rI,{children:[(0,r.jsx)($.ty,{asChild:!0,children:(0,r.jsxs)(l.$,{variant:"outline",size:"sm",disabled:em||G||null!==Z,className:"h-8 gap-1",children:[em?(0,r.jsx)(o.A,{className:"h-4 w-4 animate-spin"}):(0,r.jsx)(m.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Export as PDF"}),(0,r.jsx)(x.A,{className:"h-3 w-3 ml-1"})]})}),(0,r.jsxs)($.SQ,{align:"end",children:[(0,r.jsxs)($._2,{onClick:()=>eS("portrait"),className:"flex items-center gap-2 cursor-pointer",children:[(0,r.jsx)("span",{className:"rotate-90",children:"⬌"})," Portrait"]}),(0,r.jsxs)($._2,{onClick:()=>eS("landscape"),className:"flex items-center gap-2 cursor-pointer",children:[(0,r.jsx)("span",{children:"⬌"})," Landscape"]})]})]})]}),!F&&(0,r.jsxs)(l.$,{variant:"outline",size:"sm",onClick:eC,disabled:es,className:"h-8 gap-1",children:[es?(0,r.jsx)(o.A,{className:"h-4 w-4 animate-spin"}):(0,r.jsx)(u.A,{className:"h-4 w-4"}),(0,r.jsx)("span",{className:"hidden sm:inline",children:"Upload"})]}),(0,r.jsx)("input",{type:"file",ref:el,className:"hidden",onChange:eR,disabled:es})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-hidden",children:F?(0,r.jsx)("div",{className:"h-full w-full overflow-auto",children:G?(0,r.jsxs)("div",{className:"h-full w-full flex flex-col items-center justify-center",children:[(0,r.jsx)(o.A,{className:"h-8 w-8 animate-spin text-primary mb-3"}),(0,r.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Loading file",F?": ".concat(F.split("/").pop()):"..."]}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground/70 mt-1",children:(()=>{if(!F)return"Preparing...";let e=F;e.startsWith("/workspace")||(e="/workspace/".concat(e.startsWith("/")?e.substring(1):e));let t=q.pH.getContentTypeFromPath(e);return q.pH.has("".concat(b,":").concat(e,":").concat(t))?"Using cached version":"Fetching from server"})()})]}):Z?(0,r.jsx)("div",{className:"h-full w-full flex items-center justify-center p-4",children:(0,r.jsxs)("div",{className:"max-w-md p-6 text-center border rounded-lg bg-muted/10",children:[(0,r.jsx)(h.A,{className:"h-10 w-10 text-orange-500 mx-auto mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Error Loading File"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:Z}),(0,r.jsxs)("div",{className:"flex justify-center gap-3",children:[(0,r.jsx)(l.$,{onClick:()=>{X(null),Y(!0),ew({path:F,name:F.split("/").pop()||"",is_dir:!1,size:0,mod_time:new Date().toISOString()})},children:"Retry"}),(0,r.jsx)(l.$,{variant:"outline",onClick:()=>{ej()},children:"Back to Files"})]})]})}):(0,r.jsx)("div",{className:"h-full w-full relative",children:(0,r.jsx)(V,{content:U,binaryUrl:B,fileName:F,className:"h-full w-full",project:eo,markdownRef:eE(F)?eu:void 0},F)})}):(0,r.jsx)("div",{className:"h-full w-full",children:E?(0,r.jsx)("div",{className:"h-full w-full flex items-center justify-center",children:(0,r.jsx)(o.A,{className:"h-6 w-6 animate-spin text-primary"})}):0===z.length?(0,r.jsxs)("div",{className:"h-full w-full flex flex-col items-center justify-center",children:[(0,r.jsx)(p.A,{className:"h-12 w-12 mb-2 text-muted-foreground opacity-30"}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground",children:"Directory is empty"})]}):(0,r.jsx)(g.F,{className:"h-full w-full p-2",children:(0,r.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3 p-4",children:z.map(e=>(0,r.jsxs)("button",{className:"flex flex-col items-center p-3 rounded-lg border hover:bg-muted/50 transition-colors ".concat(F===e.path?"bg-muted border-primary/20":""),onClick:()=>{e.is_dir?(console.log("[FILE VIEWER] Folder clicked: ".concat(e.name,", path: ").concat(e.path)),ev(e)):ew(e)},children:[(0,r.jsx)("div",{className:"w-12 h-12 flex items-center justify-center mb-1",children:e.is_dir?(0,r.jsx)(p.A,{className:"h-9 w-9 text-blue-500"}):(0,r.jsx)(f.A,{className:"h-8 w-8 text-muted-foreground"})}),(0,r.jsx)("span",{className:"text-xs text-center font-medium truncate max-w-full",children:e.name})]},e.path))})})})})]})})}},52300:(e,t,s)=>{s.d(t,{y:()=>l});var r=s(95155),n=s(12115),a=s(68856);function l(e){let{isSidePanelOpen:t=!1,showHeader:s=!0,messageCount:l=3}=e;return(0,r.jsxs)("div",{className:"flex h-screen",children:[(0,r.jsxs)("div",{className:"flex flex-col flex-1 overflow-hidden transition-all duration-200 ease-in-out",children:[s&&(0,r.jsx)("div",{className:"border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:(0,r.jsxs)("div",{className:"flex h-14 items-center gap-4 px-4",children:[(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(a.E,{className:"h-6 w-6 rounded-full"}),(0,r.jsx)(a.E,{className:"h-5 w-40"})]})}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(a.E,{className:"h-8 w-8 rounded-full"}),(0,r.jsx)(a.E,{className:"h-8 w-8 rounded-full"})]})]})}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-4 pb-[5.5rem]",children:(0,r.jsxs)("div",{className:"mx-auto max-w-3xl space-y-6",children:[Array.from({length:l}).map((e,t)=>(0,r.jsx)(n.Fragment,{children:t%2==0?(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)("div",{className:"max-w-[85%] rounded-lg bg-primary/10 px-4 py-3",children:(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)(a.E,{className:"h-4 w-48"}),(0,r.jsx)(a.E,{className:"h-4 w-32"})]})})}):(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)(a.E,{className:"flex-shrink-0 w-5 h-5 mt-2 rounded-full"}),(0,r.jsx)("div",{className:"flex-1 space-y-2",children:(0,r.jsx)("div",{className:"max-w-[90%] w-full rounded-lg bg-muted px-4 py-3",children:(0,r.jsxs)("div",{className:"space-y-3",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(a.E,{className:"h-4 w-full max-w-[360px] mb-2"}),(0,r.jsx)(a.E,{className:"h-4 w-full max-w-[320px] mb-2"}),(0,r.jsx)(a.E,{className:"h-4 w-full max-w-[290px]"})]}),t%3==1&&(0,r.jsx)("div",{className:"py-1",children:(0,r.jsx)(a.E,{className:"h-6 w-32 rounded-md"})}),t%3==1&&(0,r.jsxs)("div",{children:[(0,r.jsx)(a.E,{className:"h-4 w-full max-w-[340px] mb-2"}),(0,r.jsx)(a.E,{className:"h-4 w-full max-w-[280px]"})]})]})})})]})})},t)),(0,r.jsx)("div",{children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[(0,r.jsx)(a.E,{className:"flex-shrink-0 w-5 h-5 mt-2 rounded-full"}),(0,r.jsx)("div",{className:"flex-1 space-y-2",children:(0,r.jsxs)("div",{className:"flex items-center gap-1.5 py-1",children:[(0,r.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-gray-400/50 animate-pulse"}),(0,r.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-gray-400/50 animate-pulse delay-150"}),(0,r.jsx)("div",{className:"h-1.5 w-1.5 rounded-full bg-gray-400/50 animate-pulse delay-300"})]})})]})})]})})]}),t&&(0,r.jsx)("div",{className:"hidden sm:block",children:(0,r.jsx)("div",{className:"h-screen w-[450px] border-l",children:(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)(a.E,{className:"h-8 w-32 mb-4"}),(0,r.jsx)(a.E,{className:"h-20 w-full rounded-md mb-4"}),(0,r.jsx)(a.E,{className:"h-40 w-full rounded-md"})]})})})]})}},53732:(e,t,s)=>{s.d(t,{Z:()=>i});var r=s(12115),n=s(25731),a=s(56671),l=s(18068);let c=(e,t)=>(e||[]).filter(e=>"status"!==e.type).map(e=>({message_id:e.message_id||null,thread_id:e.thread_id||t,type:e.type||"system",is_llm_message:!!e.is_llm_message,content:e.content||"",metadata:e.metadata||"{}",created_at:e.created_at||new Date().toISOString(),updated_at:e.updated_at||new Date().toISOString()}));function i(e,t,s){let[i,o]=(0,r.useState)(null),[d,m]=(0,r.useState)("idle"),[x,u]=(0,r.useState)(""),[h,p]=(0,r.useState)(null),[f,g]=(0,r.useState)(null),b=(0,r.useRef)(null),j=(0,r.useRef)(!0),w=(0,r.useRef)(null),v=(0,r.useRef)(t),N=(0,r.useRef)(s);(0,r.useEffect)(()=>{v.current=t},[t]),(0,r.useEffect)(()=>{N.current=s},[s]);let k=e=>{switch(e){case"completed":return"completed";case"stopped":return"stopped";case"failed":return"failed";default:return"error"}},z=(0,r.useCallback)(t=>{if(j.current){var s,r,n;m(t),null==(s=e.onStatusChange)||s.call(e,t),"error"===t&&f&&(null==(r=e.onError)||r.call(e,f)),["completed","stopped","failed","error","agent_not_running"].includes(t)&&(null==(n=e.onClose)||n.call(e,t))}},[e,f]),y=(0,r.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:i;if(!j.current)return;let s=v.current,r=N.current;console.log("[useAgentStream] Finalizing stream for ".concat(t," on thread ").concat(s," with status: ").concat(e)),b.current&&(b.current(),b.current=null),u(""),p(null),z(e),o(null),w.current=null,s&&["completed","stopped","failed","error","agent_not_running"].includes(e)?(console.log("[useAgentStream] Refetching messages for thread ".concat(s," after finalization with status ").concat(e,".")),(0,n.VL)(s).then(e=>{j.current&&e?(console.log("[useAgentStream] Refetched ".concat(e.length," messages for thread ").concat(s,".")),r(c(e,s))):j.current||console.log("[useAgentStream] Component unmounted before messages could be set after refetch for thread ".concat(s,"."))}).catch(e=>{console.error("[useAgentStream] Error refetching messages for thread ".concat(s," after finalization:"),e),a.oR.error("Failed to refresh messages: ".concat(e.message))})):console.log("[useAgentStream] Skipping message refetch for thread ".concat(s,". Final status: ").concat(e)),t&&("completed"===e||"stopped"===e||"agent_not_running"===e)&&(0,n._L)(t).catch(e=>{console.log("[useAgentStream] Post-finalization status check for ".concat(t," failed (this might be expected if not found): ").concat(e.message))})},[i,z]),E=(0,r.useCallback)(t=>{var s,r,n;if(!j.current)return;window.lastStreamMessage=Date.now();let c=t;if(c.startsWith("data: ")&&(c=c.substring(6).trim()),!c)return;if('{"type": "status", "status": "completed", "message": "Agent run completed successfully"}'===c){console.log("[useAgentStream] Received final completion status message"),y("completed",w.current);return}if(c.includes("Run data not available for streaming")||c.includes("Stream ended with status: completed")){console.log('[useAgentStream] Detected final completion message: "'.concat(c,'", finalizing.')),y("completed",w.current);return}try{let t=JSON.parse(c);if("error"===t.status){console.error("[useAgentStream] Received error status message:",t);let r=t.message||"Unknown error occurred";g(r),a.oR.error(r,{duration:15e3}),null==(s=e.onError)||s.call(e,r);return}}catch(e){}let i=(0,l.jD)(c,null);if(!i)return void console.warn("[useAgentStream] Failed to parse streamed message:",c);let o=(0,l.jD)(i.content,{}),m=(0,l.jD)(i.metadata,{});switch("streaming"!==d&&z("streaming"),i.type){case"assistant":"chunk"===m.stream_status&&o.content?(u(e=>e+o.content),null==(r=e.onAssistantChunk)||r.call(e,{content:o.content})):"complete"===m.stream_status?(u(""),p(null),i.message_id&&e.onMessage(i)):!m.stream_status&&(null==(n=e.onAssistantStart)||n.call(e),i.message_id&&e.onMessage(i));break;case"tool":p(null),i.message_id&&e.onMessage(i);break;case"status":switch(o.status_type){case"tool_started":p({role:"assistant",status_type:"tool_started",name:o.function_name,arguments:o.arguments,xml_tag_name:o.xml_tag_name,tool_index:o.tool_index});break;case"tool_completed":case"tool_failed":case"tool_error":(null==h?void 0:h.tool_index)===o.tool_index&&p(null);break;case"thread_run_end":console.log("[useAgentStream] Received thread run end status, finalizing.");break;case"finish":console.log("[useAgentStream] Received finish status:",o.finish_reason);break;case"error":console.error("[useAgentStream] Received error status message:",o.message),g(o.message||"Agent run failed"),y("error",w.current)}break;case"user":case"system":i.message_id&&e.onMessage(i);break;default:console.warn("[useAgentStream] Unhandled message type:",i.type)}},[t,s,d,h,e,y,z]),S=(0,r.useCallback)(e=>{if(!j.current)return;let t="Unknown streaming error";if("string"==typeof e?t=e:e instanceof Error?t=e.message:e instanceof Event&&"error"===e.type&&(t="Stream connection error"),console.error("[useAgentStream] Streaming error:",t,e),g(t),a.oR.error(t,{duration:15e3}),!w.current){console.warn("[useAgentStream] Stream error occurred but no agentRunId is active."),y("error");return}},[y]),A=(0,r.useCallback)(()=>{if(!j.current)return;console.log("[useAgentStream] Stream connection closed by server.");let e=w.current;if(!e){console.warn("[useAgentStream] Stream closed but no active agentRunId."),"streaming"===d||"connecting"===d?y("error"):"idle"!==d&&"completed"!==d&&"stopped"!==d&&"agent_not_running"!==d&&y("idle");return}(0,n._L)(e).then(t=>{if(j.current)if(console.log("[useAgentStream] Agent status after stream close for ".concat(e,": ").concat(t.status)),"running"===t.status)console.warn("[useAgentStream] Stream closed for ".concat(e,", but agent is still running. Finalizing with error.")),g("Stream closed unexpectedly while agent was running."),y("error",e),a.oR.warning("Stream disconnected. Agent might still be running.");else{let s=k(t.status);console.log("[useAgentStream] Stream closed for ".concat(e,", agent status is ").concat(t.status,". Finalizing stream as ").concat(s,".")),y(s,e)}}).catch(t=>{if(!j.current)return;let s=t instanceof Error?t.message:String(t);console.error("[useAgentStream] Error checking agent status for ".concat(e," after stream close: ").concat(s)),s.includes("not found")||s.includes("404")||s.includes("does not exist")?(console.log("[useAgentStream] Agent run ".concat(e," not found after stream close. Finalizing.")),y("agent_not_running",e)):y("error",e)})},[d,y]);(0,r.useEffect)(()=>(j.current=!0,()=>{j.current=!1,console.log("[useAgentStream] Unmounting or agentRunId changing. Cleaning up stream."),b.current&&(b.current(),b.current=null),m("idle"),u(""),p(null),g(null),o(null),w.current=null}),[]);let C=(0,r.useCallback)(async e=>{if(j.current){console.log("[useAgentStream] Received request to start streaming for ".concat(e)),b.current&&(console.log("[useAgentStream] Cleaning up existing stream before starting new one."),b.current(),b.current=null),u(""),p(null),g(null),z("connecting"),o(e),w.current=e;try{let t=await (0,n._L)(e);if(!j.current)return;if("running"!==t.status){console.warn("[useAgentStream] Agent run ".concat(e," is not in running state (status: ").concat(t.status,"). Cannot start stream.")),g("Agent run is not running (status: ".concat(t.status,")")),y(k(t.status)||"agent_not_running",e);return}console.log("[useAgentStream] Agent run ".concat(e," confirmed running. Setting up EventSource.")),b.current=(0,n.MA)(e,{onMessage:E,onError:S,onClose:A})}catch(s){if(!j.current)return;let t=s instanceof Error?s.message:String(s);console.error("[useAgentStream] Error initiating stream for ".concat(e,": ").concat(t)),g(t),y(t.includes("not found")||t.includes("404")||t.includes("does not exist")?"agent_not_running":"error",e)}}},[z,y,E,S,A]),R=(0,r.useCallback)(async()=>{if(j.current&&i){console.log("[useAgentStream] Stopping stream for agent run ".concat(i)),y("stopped",i);try{await (0,n.eD)(i),a.oR.success("Agent stopped.")}catch(t){let e=t instanceof Error?t.message:String(t);console.error("[useAgentStream] Error sending stop request for ".concat(i,": ").concat(e)),a.oR.error("Failed to stop agent: ".concat(e))}}},[i,y]);return{status:d,textContent:x,toolCall:h,error:f,agentRunId:i,startStreaming:C,stopStreaming:R}}},85127:(e,t,s)=>{s.d(t,{A0:()=>l,Table:()=>a,TableBody:()=>c,TableCell:()=>d,TableRow:()=>i,nd:()=>o});var r=s(95155);s(12115);var n=s(59434);function a(e){let{className:t,...s}=e;return(0,r.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,r.jsx)("table",{"data-slot":"table",className:(0,n.cn)("w-full caption-bottom text-sm",t),...s})})}function l(e){let{className:t,...s}=e;return(0,r.jsx)("thead",{"data-slot":"table-header",className:(0,n.cn)("[&_tr]:border-b",t),...s})}function c(e){let{className:t,...s}=e;return(0,r.jsx)("tbody",{"data-slot":"table-body",className:(0,n.cn)("[&_tr:last-child]:border-0",t),...s})}function i(e){let{className:t,...s}=e;return(0,r.jsx)("tr",{"data-slot":"table-row",className:(0,n.cn)("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",t),...s})}function o(e){let{className:t,...s}=e;return(0,r.jsx)("th",{"data-slot":"table-head",className:(0,n.cn)("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s})}function d(e){let{className:t,...s}=e;return(0,r.jsx)("td",{"data-slot":"table-cell",className:(0,n.cn)("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",t),...s})}}}]);