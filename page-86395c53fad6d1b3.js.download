(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6301],{8772:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>T});var n=s(95155),a=s(12115),r=s(35695),l=s(1243),o=s(25731),i=s(56671),c=s(99630),d=s(51548),u=s(30285),m=s(74783),g=s(5196),h=s(54416),x=s(19946);let f=(0,x.A)("PanelRightOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M15 3v18",key:"14nvp0"}],["path",{d:"m10 15-3-3 3-3",key:"1pgupc"}]]),p=(0,x.A)("FolderOpen",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);var v=s(66516),w=s(46102),y=s(62523),j=s(68856),k=s(40416),b=s(59434),C=s(52695),_=s(45132);function N(e){let{threadId:t,projectId:s,projectName:l,onViewFiles:c,onToggleSidePanel:d,onProjectRenamed:x,isMobileView:N,debugMode:S}=e;(0,r.usePathname)();let[E,A]=(0,a.useState)(!1),[I,R]=(0,a.useState)(l),D=(0,a.useRef)(null),[P,T]=(0,a.useState)(!1),O=(0,k.a)()||N,{setOpenMobile:M}=(0,C.cL)(),F=()=>{A(!1),R(l)},L=async()=>{if(""===I.trim()){R(l),A(!1);return}if(I!==l)try{if(!s){i.oR.error("Cannot rename: Project ID is missing"),R(l),A(!1);return}if(await (0,o.vr)(s,{name:I}))null==x||x(I),i.oR.success("Project renamed successfully");else throw Error("Failed to update project")}catch(t){let e=t instanceof Error?t.message:"Failed to rename project";console.error("Failed to rename project:",e),i.oR.error(e),R(l)}A(!1)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("header",{className:(0,b.cn)("bg-background sticky top-0 flex h-14 shrink-0 items-center gap-2 z-20 w-full",O&&"px-2"),children:[O&&(0,n.jsx)(u.$,{variant:"ghost",size:"icon",onClick:()=>M(!0),className:"h-9 w-9 mr-1","aria-label":"Open sidebar",children:(0,n.jsx)(m.A,{className:"h-4 w-4"})}),(0,n.jsx)("div",{className:"flex flex-1 items-center gap-2 px-3",children:E?(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)(y.p,{ref:D,value:I,onChange:e=>R(e.target.value),onKeyDown:e=>{"Enter"===e.key?L():"Escape"===e.key&&F()},onBlur:L,className:"h-8 w-auto min-w-[180px] text-base font-medium",maxLength:50}),(0,n.jsx)(u.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:L,children:(0,n.jsx)(g.A,{className:"h-3.5 w-3.5"})}),(0,n.jsx)(u.$,{variant:"ghost",size:"icon",className:"h-7 w-7",onClick:F,children:(0,n.jsx)(h.A,{className:"h-3.5 w-3.5"})})]}):l&&"Project"!==l?(0,n.jsx)("div",{className:"text-base font-medium text-muted-foreground hover:text-foreground cursor-pointer flex items-center",onClick:()=>{R(l),A(!0),setTimeout(()=>{var e,t;null==(e=D.current)||e.focus(),null==(t=D.current)||t.select()},0)},title:"Click to rename project",children:l}):(0,n.jsx)(j.E,{className:"h-5 w-32"})}),(0,n.jsxs)("div",{className:"flex items-center gap-1 pr-4",children:[S&&(0,n.jsx)("div",{className:"bg-amber-500 text-black text-xs px-2 py-0.5 rounded-md mr-2",children:"Debug"}),O?(0,n.jsx)(u.$,{variant:"ghost",size:"icon",onClick:d,className:"h-9 w-9 cursor-pointer","aria-label":"Toggle computer panel",children:(0,n.jsx)(f,{className:"h-4 w-4"})}):(0,n.jsxs)(w.Bc,{children:[(0,n.jsxs)(w.m_,{children:[(0,n.jsx)(w.k$,{asChild:!0,children:(0,n.jsx)(u.$,{variant:"ghost",size:"icon",onClick:c,className:"h-9 w-9 cursor-pointer",children:(0,n.jsx)(p,{className:"h-4 w-4"})})}),(0,n.jsx)(w.ZI,{children:(0,n.jsx)("p",{children:"View Files in Task"})})]}),(0,n.jsxs)(w.m_,{children:[(0,n.jsx)(w.k$,{asChild:!0,children:(0,n.jsx)(u.$,{variant:"ghost",size:"icon",onClick:()=>{T(!0)},className:"h-9 w-9 cursor-pointer",children:(0,n.jsx)(v.A,{className:"h-4 w-4"})})}),(0,n.jsx)(w.ZI,{children:(0,n.jsx)("p",{children:"Share Chat"})})]}),(0,n.jsxs)(w.m_,{children:[(0,n.jsx)(w.k$,{asChild:!0,children:(0,n.jsx)(u.$,{variant:"ghost",size:"icon",onClick:d,className:"h-9 w-9 cursor-pointer",children:(0,n.jsx)(f,{className:"h-4 w-4"})})}),(0,n.jsx)(w.ZI,{children:(0,n.jsx)("p",{children:"Toggle Computer Preview (CMD+I)"})})]})]})]})]}),(0,n.jsx)(_.Z,{isOpen:P,onClose:()=>T(!1),threadId:t,projectId:s})]})}var S=s(44102),E=s(53732),A=s(61446),I=s(23843),R=s(8288),D=s(52300),P=s(18068);function T(e){let{params:t}=e,s=a.use(t).threadId,u=(0,k.a)(),m=(0,r.useSearchParams)();(0,r.useRouter)();let[g,h]=(0,a.useState)([]),[x,f]=(0,a.useState)(""),[p,v]=(0,a.useState)(!0),[w,y]=(0,a.useState)(!1),[j,_]=(0,a.useState)(null),[T,O]=(0,a.useState)(null),[M,F]=(0,a.useState)("idle"),[L,G]=(0,a.useState)(!1),[z,H]=(0,a.useState)([]),[V,U]=(0,a.useState)(0),[$,q]=(0,a.useState)(!1),[Z,B]=(0,a.useState)(!1),[K,J]=(0,a.useState)(!1),[X,Y]=(0,a.useState)({}),Q=(0,a.useRef)(null),W=(0,a.useRef)(null),ee=(0,a.useRef)(null),[et,es]=(0,a.useState)(!1),[en,ea]=(0,a.useState)(!1),er=(0,a.useRef)(!1),[el,eo]=(0,a.useState)(null),[ei,ec]=(0,a.useState)(null),[ed,eu]=(0,a.useState)(!1),[em,eg]=(0,a.useState)(""),[eh,ex]=(0,a.useState)(null),ef=(0,a.useRef)(!1),ep=(0,a.useRef)(!1),ev=(0,a.useRef)(!1),ew=(0,a.useRef)("idle"),[ey,ej]=(0,a.useState)(!1),ek=(0,a.useCallback)(e=>{eg(e)},[]),{state:eb,setOpen:eC}=(0,C.cL)(),e_=(0,a.useRef)(!1),eN=(0,a.useRef)(!1);(0,a.useEffect)(()=>{ef.current&&!Z&&(B(!0),z.length>0?(G(!0),U(z.length-1)):g.length>0&&G(!0))},[Z,g,z]);let eS=(0,a.useCallback)(()=>{G(e=>{let t=!e;return t||(eN.current=!0),t&&eC(!1),t})},[eC]),eE=(0,a.useCallback)(e=>{U(e)},[]);(0,a.useEffect)(()=>{e_.current||(eC(!1),e_.current=!0)},[eC]),(0,a.useEffect)(()=>{let e=e=>{(e.metaKey||e.ctrlKey)&&"i"===e.key&&(e.preventDefault(),L?(G(!1),eN.current=!0):(G(!0),eC(!1))),(e.metaKey||e.ctrlKey)&&"b"===e.key&&(e.preventDefault(),"expanded"===eb?eC(!1):(eC(!0),L&&(G(!1),eN.current=!0))),"Escape"===e.key&&L&&G(!1)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[eS,L,eb,eC]);let eA=(0,a.useCallback)(e=>{if(console.log("[STREAM HANDLER] Received message: ID=".concat(e.message_id,", Type=").concat(e.type)),!e.message_id){var t;console.warn("[STREAM HANDLER] Received message is missing ID: Type=".concat(e.type,", Content=").concat(null==(t=e.content)?void 0:t.substring(0,50),"..."))}h(t=>t.some(t=>t.message_id===e.message_id)?t.map(t=>t.message_id===e.message_id?e:t):[...t,e]),"tool"===e.type&&q(!1)},[]),eI=(0,a.useCallback)(e=>{switch(console.log("[PAGE] Hook status changed: ".concat(e)),e){case"idle":case"completed":case"stopped":case"agent_not_running":case"error":case"failed":F("idle"),O(null),q(!1),["completed","stopped","agent_not_running","error","failed"].includes(e)&&eH("smooth");break;case"connecting":F("connecting");break;case"streaming":F("running")}},[]),eR=(0,a.useCallback)(e=>{console.error("[PAGE] Stream hook error: ".concat(e)),e.toLowerCase().includes("not found")||e.toLowerCase().includes("agent run is not running")||i.oR.error("Stream Error: ".concat(e))},[]),eD=(0,a.useCallback)(()=>{console.log("[PAGE] Stream hook closed with final status: ".concat(M))},[M]),{status:eP,textContent:eT,toolCall:eO,error:eM,agentRunId:eF,startStreaming:eL,stopStreaming:eG}=(0,E.Z)({onMessage:eA,onStatusChange:eI,onError:eR,onClose:eD},s,h);(0,a.useEffect)(()=>{T&&T!==eF&&(console.log("[PAGE] Target agentRunId set to ".concat(T,", initiating stream...")),eL(T))},[T,eL,eF]);let ez=e=>{"Escape"===e.key&&L&&G(!1)};(0,a.useEffect)(()=>(window.addEventListener("keydown",ez),()=>window.removeEventListener("keydown",ez)),[L]);let eH=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"smooth";null==(e=Q.current)||e.scrollIntoView({behavior:t})};(0,a.useEffect)(()=>{let e=!0;return async function(){ef.current||v(!0),_(null);try{if(!s)throw Error("Thread ID is required");let n=await (0,o.fG)(s).catch(e=>{throw Error("Failed to load thread data: "+e.message)});if(!e)return;if(null==n?void 0:n.project_id){let s=await (0,o.U1)(n.project_id);if(e&&s){var t;eo(s),"string"==typeof s.sandbox?ec(s.sandbox):(null==(t=s.sandbox)?void 0:t.id)&&ec(s.sandbox.id),eg(s.name||"")}}if(!ep.current){let t=await (0,o.VL)(s);if(e){let e=(t||[]).filter(e=>"status"!==e.type).map(e=>({message_id:e.message_id||null,thread_id:e.thread_id||s,type:e.type||"system",is_llm_message:!!e.is_llm_message,content:e.content||"",metadata:e.metadata||"{}",created_at:e.created_at||new Date().toISOString(),updated_at:e.updated_at||new Date().toISOString()}));h(e),console.log("[PAGE] Loaded Messages (excluding status, keeping browser_state):",e.length),ep.current=!0,er.current||(eH("auto"),er.current=!0)}}if(!ev.current&&e)try{console.log("[PAGE] Checking for active agent runs...");let t=await (0,o.m9)(s);ev.current=!0;let n=t.find(e=>"running"===e.status);n&&e?(console.log("[PAGE] Found active run on load:",n.id),O(n.id)):(console.log("[PAGE] No active agent runs found"),e&&F("idle"))}catch(t){console.error("[PAGE] Error checking for active runs:",t),ev.current=!0,e&&F("idle")}ef.current=!0}catch(t){if(console.error("Error loading thread data:",t),e){let e=t instanceof Error?t.message:"Failed to load thread";_(e),i.oR.error(e)}}finally{e&&v(!1)}}(),()=>{e=!1}},[s]);let eV=(0,a.useCallback)(async(e,t)=>{if(!e.trim())return;y(!0);let n={message_id:"temp-".concat(Date.now()),thread_id:s,type:"user",is_llm_message:!1,content:e,metadata:"{}",created_at:new Date().toISOString(),updated_at:new Date().toISOString()};h(e=>[...e,n]),f(""),eH("smooth");try{let a=await Promise.allSettled([(0,o.GB)(s,e),(0,o.Ih)(s,t)]);if("rejected"===a[0].status){let e=a[0].reason;throw console.error("Failed to send message:",e),Error("Failed to send message: ".concat((null==e?void 0:e.message)||e))}if("rejected"===a[1].status){let e=a[1].reason;if(console.error("Failed to start agent:",e),e instanceof o.Ey){console.log("Caught BillingError:",e.detail),Y({currentUsage:e.detail.currentUsage,limit:e.detail.limit,message:e.detail.message||"Monthly usage limit reached. Please upgrade.",accountId:(null==el?void 0:el.account_id)||null}),J(!0),h(e=>e.filter(e=>e.message_id!==n.message_id));return}throw Error("Failed to start agent: ".concat((null==e?void 0:e.message)||e))}let r=a[1].value;O(r.agent_run_id)}catch(e){console.error("Error sending message or starting agent:",e),e instanceof o.Ey||i.oR.error(e instanceof Error?e.message:"Operation failed"),h(e=>e.filter(e=>e.message_id!==n.message_id))}finally{y(!1)}},[s,null==el?void 0:el.account_id]),eU=(0,a.useCallback)(async()=>{console.log("[PAGE] Requesting agent stop via hook."),F("idle"),await eG()},[eG]);(0,a.useEffect)(()=>{let e=g[g.length-1];(null==e?void 0:e.type)!=="user"&&"running"!==M||en||eH("smooth")},[g,M,en,eH]),(0,a.useEffect)(()=>{if(!ee.current||0===g.length)return;let e=new IntersectionObserver(e=>{let[t]=e;return es(!(null==t?void 0:t.isIntersecting))},{root:W.current,threshold:.1});return e.observe(ee.current),()=>e.disconnect()},[g,eT,eO,es]),(0,a.useEffect)(()=>{console.log("[PAGE] \uD83D\uDD04 Page AgentStatus: ".concat(M,", Hook Status: ").concat(eP,", Target RunID: ").concat(T||"none",", Hook RunID: ").concat(eF||"none")),("completed"===eP||"stopped"===eP||"agent_not_running"===eP||"error"===eP)&&("running"===M||"connecting"===M)&&(console.log("[PAGE] Detected hook completed but UI still shows running, updating status"),F("idle"),O(null),q(!1))},[M,eP,T,eF]);let e$=(0,a.useCallback)(e=>{e?ex(e):ex(null),eu(!0)},[]),eq=(0,a.useCallback)((e,t)=>e?(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsx)("div",{className:"text-xs font-medium text-muted-foreground",children:"Assistant Message"}),(0,n.jsx)("div",{className:"rounded-md border bg-muted/50 p-3",children:(0,n.jsx)("div",{className:"text-xs prose prose-xs dark:prose-invert chat-markdown max-w-none",children:e})})]}):null,[]),eZ=(0,a.useCallback)((e,t)=>e?(0,n.jsxs)("div",{className:"space-y-1",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center",children:[(0,n.jsx)("div",{className:"text-xs font-medium text-muted-foreground",children:"Tool Result"}),(0,n.jsx)("div",{className:"px-2 py-0.5 rounded-full text-xs ".concat(t?"bg-green-50 text-green-700 dark:bg-green-900 dark:text-green-300":"bg-red-50 text-red-700 dark:bg-red-900 dark:text-red-300"),children:t?"Success":"Failed"})]}),(0,n.jsx)("div",{className:"rounded-md border bg-muted/50 p-3",children:(0,n.jsx)("div",{className:"text-xs prose prose-xs dark:prose-invert chat-markdown max-w-none",children:e})})]}):null,[]);(0,a.useEffect)(()=>{let e=[];g.filter(e=>"assistant"===e.type&&e.message_id).forEach(t=>{let s=g.find(e=>{if("tool"!==e.type||!e.metadata||!t.message_id)return!1;try{return JSON.parse(e.metadata).assistant_message_id===t.message_id}catch(e){return!1}});if(s){let a="unknown";try{let e=t.content.match(/<([a-zA-Z\-_]+)(?:\s+[^>]*)?>|<([a-zA-Z\-_]+)(?:\s+[^>]*)?\/>/);if(e)a=e[1]||e[2]||"unknown";else{let e=(0,P.jD)(t.content,{});e.tool_calls&&e.tool_calls.length>0&&(a=e.tool_calls[0].name||"unknown")}}catch(e){}if("ask"===a||"complete"===a)return;let r=!0;try{var n;let e=(null==(n=s.content)?void 0:n.toLowerCase())||"";r=!(e.includes("failed")||e.includes("error")||e.includes("failure"))}catch(e){}e.push({assistantCall:{name:a,content:t.content,timestamp:t.created_at},toolResult:{content:s.content,isSuccess:r,timestamp:s.created_at}})}}),H(e),e.length>0&&(L&&!eN.current?U(e.length-1):L||$||eN.current||(U(e.length-1),G(!0),q(!0)))},[g,L,$]),(0,a.useEffect)(()=>{L||q(!1)},[L]);let eB=(0,a.useCallback)((e,t)=>{if("ask"===t)return;if(!e){console.warn("Clicked assistant message ID is null. Cannot open side panel."),i.oR.warning("Cannot view details: Assistant message ID is missing.");return}eN.current=!1,console.log("[PAGE] Tool Click Triggered. Assistant Message ID:",e,"Tool Name:",t);let s=z.findIndex(t=>{var s,n,a;if(!(null==(s=t.toolResult)?void 0:s.content)||"STREAMING"===t.toolResult.content)return!1;let r=g.find(t=>t.message_id===e&&"assistant"===t.type);if(!r)return!1;let l=g.find(e=>{if("tool"!==e.type||!e.metadata)return!1;try{return(0,P.jD)(e.metadata,{}).assistant_message_id===r.message_id}catch(e){return!1}});return(null==(n=t.assistantCall)?void 0:n.content)===r.content&&(null==(a=t.toolResult)?void 0:a.content)===(null==l?void 0:l.content)});-1!==s?(console.log("[PAGE] Found tool call at index ".concat(s," for assistant message ").concat(e)),U(s),G(!0)):(console.warn("[PAGE] Could not find matching tool call in toolCalls array for assistant message ID: ".concat(e)),i.oR.info("Could not find details for this tool call."))},[g,z]);(0,a.useCallback)(e=>{if(!e)return;let t=e.name||e.xml_tag_name||"Unknown Tool";if("ask"===t||"complete"===t||(console.log("[STREAM] Received tool call:",t),eN.current))return;let s=e.arguments||"",n=s;if(t.toLowerCase().includes("command")&&!s.includes("<execute-command>"))n="<execute-command>".concat(s,"</execute-command>");else if(t.toLowerCase().includes("file")&&!s.includes("<create-file>")){let e=["create-file","delete-file","full-file-rewrite"].find(e=>t.toLowerCase().includes(e));e&&!s.includes("<".concat(e,">"))&&(n="<".concat(e,">").concat(s,"</").concat(e,">"))}let a={assistantCall:{name:t,content:n,timestamp:new Date().toISOString()},toolResult:{content:"STREAMING",isSuccess:!0,timestamp:new Date().toISOString()}};H(e=>e.length>0&&e[0].assistantCall.name===t?[{...e[0],assistantCall:{...e[0].assistantCall,content:n}}]:[a]),U(0),G(!0)},[]),(0,a.useEffect)(()=>{if(em){document.title="".concat(em," | Kortix Suna");let e=document.querySelector('meta[name="description"]');e&&e.setAttribute("content","".concat(em," - Interactive agent conversation powered by Kortix Suna"));let t=document.querySelector('meta[property="og:title"]');t&&t.setAttribute("content","".concat(em," | Kortix Suna"));let s=document.querySelector('meta[property="og:description"]');s&&s.setAttribute("content","Interactive AI conversation for ".concat(em))}},[em]),(0,a.useEffect)(()=>{if("idle"===M&&"streaming"!==eP&&"connecting"!==eP&&(console.log("[PAGE] Agent status changed to idle, ensuring messages are up to date"),!p&&ef.current)){let e=setTimeout(()=>{(0,o.VL)(s).then(e=>{e&&(console.log("[PAGE] Backup refetch completed with ".concat(e.length," messages")),h((e||[]).filter(e=>"status"!==e.type).map(e=>({message_id:e.message_id||null,thread_id:e.thread_id||s,type:e.type||"system",is_llm_message:!!e.is_llm_message,content:e.content||"",metadata:e.metadata||"{}",created_at:e.created_at||new Date().toISOString(),updated_at:e.updated_at||new Date().toISOString()}))),q(!1),eH("smooth"))}).catch(e=>{console.error("Error in backup message refetch:",e)})},1e3);return()=>clearTimeout(e)}},[M,s,p,eP]);let eK=(0,a.useCallback)(async()=>{if((0,I.Jn)())return console.log("Running in local development mode - billing checks are disabled"),!1;try{let s=await (0,o.Et)();if(!s.can_run){var e,t;return Y({currentUsage:(null==(e=s.subscription)?void 0:e.minutes_limit)||0,limit:(null==(t=s.subscription)?void 0:t.minutes_limit)||0,message:s.message||"Usage limit reached",accountId:(null==el?void 0:el.account_id)||null}),J(!0),!0}return!1}catch(e){return console.error("Error checking billing status:",e),!1}},[null==el?void 0:el.account_id]);return((0,a.useEffect)(()=>{"running"===ew.current&&"idle"===M&&eK(),ew.current=M},[M,eK]),(0,a.useEffect)(()=>{(null==el?void 0:el.account_id)&&ef.current&&(console.log("Checking billing status on page load"),eK())},[null==el?void 0:el.account_id,eK,ef]),(0,a.useEffect)(()=>{ep.current&&(null==el?void 0:el.account_id)&&!p&&(console.log("Checking billing status after messages loaded"),eK())},[ep.current,eK,null==el?void 0:el.account_id,p]),(0,a.useEffect)(()=>{ej("true"===m.get("debug"))},[m]),!ef.current||p)?(0,n.jsx)(D.y,{isSidePanelOpen:L}):j?(0,n.jsxs)("div",{className:"flex h-screen",children:[(0,n.jsxs)("div",{className:"flex flex-col flex-1 overflow-hidden transition-all duration-200 ease-in-out ".concat(L&&ef.current?"mr-[90%] sm:mr-[450px] md:mr-[500px] lg:mr-[550px] xl:mr-[650px]":""),children:[(0,n.jsx)(N,{threadId:s,projectName:em,projectId:(null==el?void 0:el.id)||"",onViewFiles:e$,onToggleSidePanel:eS,isMobileView:u,debugMode:ey}),(0,n.jsx)("div",{className:"flex flex-1 items-center justify-center p-4",children:(0,n.jsxs)("div",{className:"flex w-full max-w-md flex-col items-center gap-4 rounded-lg border bg-card p-6 text-center",children:[(0,n.jsx)("div",{className:"rounded-full bg-destructive/10 p-3",children:(0,n.jsx)(l.A,{className:"h-6 w-6 text-destructive"})}),(0,n.jsx)("h2",{className:"text-lg font-semibold text-destructive",children:"Thread Not Found"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:j.includes("JSON object requested, multiple (or no) rows returned")?"This thread either does not exist or you do not have access to it.":j})]})})]}),(0,n.jsx)(S.s,{isOpen:L&&ef.current,onClose:()=>{G(!1),eN.current=!0,q(!0)},toolCalls:z,messages:g,agentStatus:M,currentIndex:V,onNavigate:eE,project:el||void 0,renderAssistantMessage:eq,renderToolResult:eZ,isLoading:!ef.current||p}),ei&&(0,n.jsx)(d.S,{open:ed,onOpenChange:eu,sandboxId:ei,initialFilePath:eh,project:el||void 0}),(0,n.jsx)(A.i,{message:X.message,currentUsage:X.currentUsage,limit:X.limit,accountId:X.accountId,onDismiss:()=>J(!1),isOpen:K})]}):(0,n.jsxs)("div",{className:"flex h-screen",children:[ey&&(0,n.jsx)("div",{className:"fixed top-16 right-4 bg-amber-500 text-black text-xs px-2 py-1 rounded-md shadow-md z-50",children:"Debug Mode"}),(0,n.jsxs)("div",{className:"flex flex-col flex-1 overflow-hidden transition-all duration-200 ease-in-out ".concat(!ef.current||L?"mr-[90%] sm:mr-[450px] md:mr-[500px] lg:mr-[550px] xl:mr-[650px]":""),children:[(0,n.jsx)(N,{threadId:s,projectName:em,projectId:(null==el?void 0:el.id)||"",onViewFiles:e$,onToggleSidePanel:eS,onProjectRenamed:ek,isMobileView:u,debugMode:ey}),(0,n.jsx)(R.u9,{messages:g,streamingTextContent:eT,streamingToolCall:eO,agentStatus:M,handleToolClick:eB,handleOpenFileViewer:e$,readOnly:!1,streamHookStatus:eP,sandboxId:ei,project:el,debugMode:ey}),(0,n.jsx)("div",{className:(0,b.cn)("fixed bottom-0 z-10 bg-gradient-to-t from-background via-background/90 to-transparent px-4 pt-8 transition-all duration-200 ease-in-out","expanded"===eb?"left-[72px] lg:left-[256px]":"left-[72px]",L?"right-[90%] sm:right-[450px] md:right-[500px] lg:right-[550px] xl:right-[650px]":"right-0",u?"left-0 right-0":""),children:(0,n.jsx)("div",{className:(0,b.cn)("mx-auto",u?"w-full px-4":"max-w-3xl"),children:(0,n.jsx)(c.V,{value:x,onChange:f,onSubmit:eV,placeholder:"Ask Suna anything...",loading:w,disabled:w||"running"===M||"connecting"===M,isAgentRunning:"running"===M||"connecting"===M,onStopAgent:eU,autoFocus:!p,onFileBrowse:e$,sandboxId:ei||void 0})})})]}),(0,n.jsx)(S.s,{isOpen:L&&ef.current,onClose:()=>{G(!1),eN.current=!0,q(!0)},toolCalls:z,messages:g,agentStatus:M,currentIndex:V,onNavigate:eE,project:el||void 0,renderAssistantMessage:eq,renderToolResult:eZ,isLoading:!ef.current||p}),ei&&(0,n.jsx)(d.S,{open:ed,onOpenChange:eu,sandboxId:ei,initialFilePath:eh,project:el||void 0}),(0,n.jsx)(A.i,{message:X.message,currentUsage:X.currentUsage,limit:X.limit,accountId:X.accountId,onDismiss:()=>J(!1),isOpen:K})]})}},24357:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(19946).A)("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]])},38164:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(19946).A)("Link",[["path",{d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71",key:"1cjeqo"}],["path",{d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71",key:"19qd67"}]])},45132:(e,t,s)=>{"use strict";s.d(t,{Z:()=>x});var n=s(95155),a=s(12115),r=s(30285),l=s(54165),o=s(54416),i=s(5196),c=s(24357),d=s(77639),u=s(66516),m=s(38164),g=s(56671),h=s(25731);function x(e){let{isOpen:t,onClose:s,threadId:x,projectId:f}=e,[p,v]=(0,a.useState)(null),[w,y]=(0,a.useState)(!1),[j,k]=(0,a.useState)(!1),[b,C]=(0,a.useState)(!1);(0,a.useEffect)(()=>{t&&x&&_()},[t,x]);let _=async()=>{if(x){k(!0);try{let e=await (0,h.fG)(x);if(null==e?void 0:e.is_public){let e=N();v(e)}else v(null)}catch(e){console.error("Error checking share status:",e),g.oR.error("Failed to check sharing status"),v(null)}finally{k(!1)}}},N=()=>x?"".concat("https://suna.so","/share/").concat(x):"",S=async()=>{if(x){y(!0);try{await A(!0);let e=N();v(e),g.oR.success("Shareable link created successfully")}catch(e){console.error("Error creating share link:",e),g.oR.error("Failed to create shareable link")}finally{y(!1)}}},E=async()=>{if(x){y(!0);try{await A(!1),v(null),g.oR.success("Shareable link removed")}catch(e){console.error("Error removing share link:",e),g.oR.error("Failed to remove shareable link")}finally{y(!1)}}},A=async e=>{console.log("Updating public status for thread:",x,"and project:",f,"to",e),x&&(await (0,h.vr)(f,{is_public:e}),await (0,h.e4)(x,{is_public:e}))},I=[{name:"LinkedIn",icon:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",className:"size-5 text-current",children:(0,n.jsx)("path",{fill:"currentColor",d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 01-2.063-2.065 2.064 2.064 0 112.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})}),onClick:()=>{p&&window.open("https://www.linkedin.com/shareArticle?url=".concat(encodeURIComponent(p),"&text=Shared conversation"),"_blank")}},{name:"X",icon:(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",className:"size-5 text-current",children:(0,n.jsx)("path",{fill:"currentColor",d:"M18.901 1.153h3.68l-8.04 9.19L24 22.846h-7.406l-5.8-7.584-6.638 7.584H.474l8.6-9.83L0 1.154h7.594l5.243 6.932ZM17.61 20.644h2.039L6.486 3.24H4.298Z"})}),onClick:()=>{p&&window.open("https://twitter.com/intent/tweet?url=".concat(encodeURIComponent(p),"&text=Shared conversation"),"_blank")}}];return(0,n.jsx)(l.lG,{open:t,onOpenChange:s,children:(0,n.jsxs)(l.Cf,{className:"sm:max-w-md p-0 gap-0 overflow-hidden",children:[(0,n.jsxs)(l.L3,{className:"p-4 font-medium",children:["Share Chat",(0,n.jsxs)("button",{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",onClick:s,children:[(0,n.jsx)(o.A,{className:"h-4 w-4"}),(0,n.jsx)("span",{className:"sr-only",children:"Close"})]})]}),(0,n.jsx)("div",{className:"p-4 space-y-6",children:j?(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center py-10",children:[(0,n.jsx)("div",{className:"h-6 w-6 border-2 border-t-primary border-primary/30 rounded-full animate-spin"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground mt-4",children:"Checking share status..."})]}):p?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"text-sm text-muted-foreground",children:"Your chat is now publicly accessible with the link below. Anyone with this link can view this conversation."}),(0,n.jsxs)("div",{className:"flex flex-col space-y-2 sm:flex-row sm:space-y-0 sm:space-x-2",children:[(0,n.jsx)("div",{className:"relative flex flex-1 items-center",children:(0,n.jsx)("input",{type:"text",readOnly:!0,value:p,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"})}),(0,n.jsx)(r.$,{variant:"outline",className:"h-10 px-4 py-2",onClick:()=>{p&&(C(!0),navigator.clipboard.writeText(p),g.oR.success("Link copied to clipboard"),setTimeout(()=>{C(!1)},500))},children:b?(0,n.jsx)(i.A,{className:" h-4 w-4"}):(0,n.jsx)(c.A,{className:" h-4 w-4"})})]}),(0,n.jsx)("div",{className:"flex justify-center gap-6 pt-2",children:I.map((e,t)=>(0,n.jsxs)("button",{className:"p-2 rounded-full flex flex-col items-center group",onClick:e.onClick,children:[(0,n.jsx)("div",{className:"w-10 h-10 rounded-full bg-muted flex items-center justify-center text-muted-foreground group-hover:bg-primary group-hover:text-primary-foreground transition-all duration-200",children:e.icon}),(0,n.jsx)("span",{className:"text-xs mt-1 group-hover:text-primary transition-colors duration-200",children:e.name})]},t))}),(0,n.jsx)("div",{className:"pt-1",children:(0,n.jsxs)(r.$,{variant:"default",className:"w-full",onClick:E,disabled:w,children:[(0,n.jsx)(d.A,{className:"mr-2 h-4 w-4"}),w?"Processing...":"Remove link"]})})]}):(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"flex flex-col items-center justify-center py-6 text-center",children:[(0,n.jsx)("div",{className:"h-12 w-12 rounded-full bg-primary/10 flex items-center justify-center mb-4",children:(0,n.jsx)(u.A,{className:"h-6 w-6 text-primary"})}),(0,n.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Share this chat"}),(0,n.jsx)("p",{className:"text-sm text-muted-foreground max-w-sm mb-6",children:"Create a shareable link that allows others to view this conversation."}),(0,n.jsxs)(r.$,{onClick:S,className:"w-full max-w-xs",disabled:w,children:[(0,n.jsx)(m.A,{className:"mr-2 h-4 w-4"}),w?"Creating link...":"Create shareable link"]})]})})})]})})}},66516:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(19946).A)("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]])},77639:(e,t,s)=>{"use strict";s.d(t,{A:()=>n});let n=(0,s(19946).A)("Link2Off",[["path",{d:"M9 17H7A5 5 0 0 1 7 7",key:"10o201"}],["path",{d:"M15 7h2a5 5 0 0 1 4 8",key:"1d3206"}],["line",{x1:"8",x2:"12",y1:"12",y2:"12",key:"rvw6j4"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]])},87114:(e,t,s)=>{Promise.resolve().then(s.bind(s,8772))}},e=>{var t=t=>e(e.s=t);e.O(0,[825,2084,6079,3558,2969,1935,9319,5151,2486,6298,7059,66,6766,9287,2504,3860,6112,1944,8687,4027,9916,2695,3236,6233,8441,1684,7358],()=>t(87114)),_N_E=e.O()}]);