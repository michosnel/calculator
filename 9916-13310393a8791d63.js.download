"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9916],{30431:(e,t,n)=>{n.d(t,{m:()=>A,Q:()=>I});var l=n(95155),r=n(12115),a=n(42118),o=n(62332),c=n(57434),s=n(84209),i=n(45517),d=n(73032),u=n(64261),h=n(39022),p=n(54213),f=n(99890),m=n(51154),b=n(33786),x=n(59434),g=n(86618),v=n(66424),w=n(63496);function j(e){var t,n;let{content:a,previewUrl:o,className:c,project:s}=e,[i,d]=(0,r.useState)("preview"),u=(0,r.useMemo)(()=>{var e;if(a&&!(null==s||null==(e=s.sandbox)?void 0:e.sandbox_url)){let e=new Blob([a],{type:"text/html"});return URL.createObjectURL(e)}},[a,null==s||null==(t=s.sandbox)?void 0:t.sandbox_url]),h=(0,r.useMemo)(()=>{try{if(o.includes("/api/sandboxes/")){let e=new URL(o).searchParams.get("path");if(e)return e.split("/").pop()||""}return o.split("/").pop()||""}catch(e){return console.error("Error extracting filename:",e),""}},[o]),p=(0,r.useMemo)(()=>{var e;return(null==s||null==(e=s.sandbox)?void 0:e.sandbox_url)&&h?(0,w.i)(s.sandbox.sandbox_url,h):u||o},[null==s||null==(n=s.sandbox)?void 0:n.sandbox_url,h,u,o]);return(0,r.useEffect)(()=>()=>{u&&URL.revokeObjectURL(u)},[u]),(0,l.jsx)("div",{className:(0,x.cn)("w-full h-full flex flex-col",c),children:(0,l.jsx)("div",{className:"flex-1 min-h-0 relative",children:"preview"===i?(0,l.jsx)("div",{className:"w-full h-full",children:(0,l.jsx)("iframe",{src:p,title:"HTML Preview",className:"w-full h-full border-0",sandbox:"allow-same-origin allow-scripts",style:{background:"white"}})}):(0,l.jsx)(v.F,{className:"w-full h-full",children:(0,l.jsx)("pre",{className:"p-4 overflow-auto",children:(0,l.jsx)("code",{className:"text-sm",children:a})})})})})}var y=n(31834);function k(e){let{content:t,className:n}=e;return(0,l.jsx)("div",{className:(0,x.cn)("w-full h-full overflow-hidden",n),children:(0,l.jsx)(v.F,{className:"w-full h-full",children:(0,l.jsx)("div",{className:"p-4",children:(0,l.jsx)(y.o,{className:"prose prose-sm dark:prose-invert max-w-none [&>:first-child]:mt-0",children:t})})})})}var C=n(60408),N=n.n(C);function L(e){let{content:t,className:n}=e,r=function(e){if(!e)return{data:[],headers:[]};try{let t=N().parse(e,{header:!0,skipEmptyLines:!0}),n=[];return t.meta&&t.meta.fields&&(n=t.meta.fields||[]),{headers:n,data:t.data}}catch(e){return console.error("Error parsing CSV:",e),{headers:[],data:[]}}}(t),a=0===r.data.length;return(0,l.jsx)("div",{className:(0,x.cn)("w-full h-full overflow-hidden",n),children:(0,l.jsx)(v.F,{className:"w-full h-full",children:(0,l.jsx)("div",{className:"p-2",children:(0,l.jsxs)("table",{className:"w-full border-collapse text-sm",children:[(0,l.jsx)("thead",{className:"bg-muted sticky top-0",children:(0,l.jsx)("tr",{children:r.headers.map((e,t)=>(0,l.jsx)("th",{className:"px-3 py-2 text-left font-medium border border-border",children:e},t))})}),(0,l.jsx)("tbody",{children:a?(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:r.headers.length||1,className:"py-4 text-center text-muted-foreground",children:"No data available"})}):r.data.map((e,t)=>(0,l.jsx)("tr",{className:"border-b border-border hover:bg-muted/50",children:r.headers.map((t,n)=>(0,l.jsx)("td",{className:"px-3 py-2 border border-border",children:e[t]||""},n))},t))})]})})})})}var E=n(64541),F=n(43089);function A(e){var t;let{filepath:n,onClick:g,className:v,sandboxId:w,showPreview:y=!0,localPreviewUrl:C,customStyle:N,collapsed:A=!0,project:I}=e,{session:U}=(0,E.A)(),[R,H]=r.useState(!1),P=n.split("/").pop()||"file",S=(null==(t=P.split(".").pop())?void 0:t.toLowerCase())||"",z=function(e){var t;let n=(null==(t=e.split(".").pop())?void 0:t.toLowerCase())||"";return["png","jpg","jpeg","gif","webp","svg","bmp"].includes(n)?"image":["js","jsx","ts","tsx","html","css","json","py","java","c","cpp"].includes(n)?"code":["txt","log","env"].includes(n)?"text":["md","markdown"].includes(n)?"markdown":"pdf"===n?"pdf":["mp3","wav","ogg","flac"].includes(n)?"audio":["mp4","webm","mov","avi"].includes(n)?"video":["csv","tsv"].includes(n)?"csv":["xls","xlsx"].includes(n)?"spreadsheet":["zip","rar","tar","gz"].includes(n)?"archive":["db","sqlite","sql"].includes(n)?"database":"other"}(P),B=C||(w?function(e,t){if(!e)return t;t.startsWith("/workspace")||(t="/workspace/".concat(t.startsWith("/")?t.substring(1):t));let n=new URL("".concat("https://api.suna.so/api","/sandboxes/").concat(e,"/files/content"));return n.searchParams.append("path",t),n.toString()}(w,n):n),D="code"===z&&S?S.toUpperCase():({image:"Image",code:"Code",text:"Text",markdown:"Markdown",pdf:"PDF",audio:"Audio",video:"Video",spreadsheet:"Spreadsheet",csv:"CSV",archive:"Archive",database:"Database",other:"File"})[z],M=function(e,t){let n=(5*e.length%800+200)*({image:5,video:20,audio:10,code:.5,text:.3,markdown:.3,pdf:8,spreadsheet:3,csv:2,archive:5,database:4,other:1})[t];return n<1024?"".concat(Math.round(n)," B"):n<1048576?"".concat((n/1024).toFixed(1)," KB"):"".concat((n/1048576).toFixed(1)," MB")}(n,z),_={image:a.A,code:o.A,text:c.A,markdown:c.A,pdf:s.A,audio:i.A,video:d.A,spreadsheet:u.A,csv:u.A,archive:h.A,database:p.A,other:f.A}[z],T="image"===z,O="html"===S||"htm"===S||"md"===S||"markdown"===S,W="csv"===S||"tsv"===S,q=(null==N?void 0:N.gridColumn)==="1 / -1"||!!(N&&"--attachment-height"in N),G=(O||W)&&y&&!1===A,{data:V,isLoading:X,error:$}=function(e,t){let[n,l]=(0,r.useState)(null),[a,o]=(0,r.useState)(!1),[c,s]=(0,r.useState)(null),{session:i}=(0,E.A)();return(0,r.useEffect)(()=>{if(!e||!t||!(null==i?void 0:i.access_token))return void l(null);let n="".concat(e,":").concat(t,":text"),r=F.pH.get(n);if(null!==r)return void l(r);o(!0),(0,F.j8)(e,t,{token:i.access_token,contentType:"text"}).then(e=>{l(e),o(!1)}).catch(e=>{console.error("Failed to load file content:",e),s(e),o(!1)})},[e,t,null==i?void 0:i.access_token]),{data:n,isLoading:a,error:c}}(G?w:void 0,G?n:void 0),{data:J,isLoading:K,error:Z}=function(e,t){let[n,l]=(0,r.useState)(null),[a,o]=(0,r.useState)(!1),[c,s]=(0,r.useState)(null),{session:i}=(0,E.A)();return(0,r.useEffect)(()=>{if(!e||!t||!(null==i?void 0:i.access_token))return void l(null);let n="".concat(e,":").concat(t,":blob"),r=F.pH.get(n);if(r){if("string"==typeof r&&r.startsWith("blob:"))l(r);else if(r instanceof Blob){let e=URL.createObjectURL(r);l(e),F.pH.set(n,e)}else l(String(r));return}return o(!0),(0,F.j8)(e,t,{token:i.access_token,contentType:"blob"}).then(e=>{l(e),o(!1)}).catch(e=>{console.error("Failed to load image:",e),s(e),o(!1)}),()=>{}},[e,t,null==i?void 0:i.access_token]),{data:n,isLoading:a,error:c}}(T&&y&&w?w:void 0,T&&y?n:void 0);r.useEffect(()=>{($||Z)&&H(!0)},[$,Z]);let Q=()=>{g&&g(n)};if(T&&y){let e=q?N["--attachment-height"]:"54px";return K&&w?(0,l.jsx)("button",{onClick:Q,className:(0,x.cn)("group relative min-h-[54px] min-w-fit rounded-xl cursor-pointer","border border-black/10 dark:border-white/10","bg-black/5 dark:bg-black/20","p-0 overflow-hidden","flex items-center justify-center",q?"w-full":"inline-block",v),style:{maxWidth:"100%",height:q?e:"auto",...N},title:P,children:(0,l.jsx)(m.A,{className:"h-6 w-6 text-primary animate-spin"})}):(0,l.jsx)("button",{onClick:Q,className:(0,x.cn)("group relative min-h-[54px] rounded-xl cursor-pointer","border border-black/10 dark:border-white/10","bg-black/5 dark:bg-black/20","p-0 overflow-hidden","flex items-center justify-center",q?"w-full":"inline-block",v),style:{maxWidth:"100%",height:q?e:"auto",...N},title:P,children:(0,l.jsx)("img",{src:w&&(null==U?void 0:U.access_token)?J:B,alt:P,className:(0,x.cn)("max-h-full",q?"w-full h-full object-cover":"w-auto"),style:{height:e,objectPosition:"center",objectFit:q?"cover":"contain"},onLoad:()=>{},onError:e=>{console.error("Image load error:",e),H(!0),C&&"string"==typeof C&&C.startsWith("blob:")&&(e.target.src=C)}})})}if(G&&q){let e={html:j,htm:j,md:k,markdown:k,csv:L,tsv:L}[S];return(0,l.jsxs)("div",{className:(0,x.cn)("group relative rounded-xl w-full","border border-black/10 dark:border-white/10","bg-black/5 dark:bg-black/20","overflow-hidden","h-[300px]","pt-10",v),style:{gridColumn:"1 / -1",width:"100%",...N},onClick:R?Q:void 0,children:[(0,l.jsxs)("div",{className:"h-full w-full relative",children:[!R&&V&&(0,l.jsx)(l.Fragment,{children:e?(0,l.jsx)(e,{content:V,previewUrl:B,className:"h-full w-full",project:I}):(0,l.jsx)("div",{className:"p-4 text-muted-foreground",children:"No preview available for this file type"})}),R&&(0,l.jsxs)("div",{className:"h-full w-full flex flex-col items-center justify-center p-4",children:[(0,l.jsx)("div",{className:"text-red-500 mb-2",children:"Error loading content"}),(0,l.jsx)("div",{className:"text-muted-foreground text-sm text-center mb-2",children:B&&(0,l.jsx)("div",{className:"text-xs max-w-full overflow-hidden truncate opacity-70",children:"Path may need /workspace prefix"})}),(0,l.jsx)("button",{onClick:Q,className:"px-3 py-1.5 bg-primary/10 hover:bg-primary/20 rounded-md text-sm",children:"Open in viewer"})]}),X&&(0,l.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-background/50",children:(0,l.jsx)(m.A,{className:"h-6 w-6 text-primary animate-spin"})}),!V&&!X&&!R&&(0,l.jsxs)("div",{className:"h-full w-full flex flex-col items-center justify-center p-4 pointer-events-none",children:[(0,l.jsx)("div",{className:"text-muted-foreground text-sm mb-2",children:"Preview available"}),(0,l.jsx)("div",{className:"text-muted-foreground text-xs text-center",children:"Click header to open externally"})]})]}),(0,l.jsxs)("div",{className:"absolute top-0 left-0 right-0 bg-black/5 dark:bg-white/5 p-2 z-10 flex items-center justify-between",children:[(0,l.jsx)("div",{className:"text-sm font-medium truncate",children:P}),g&&(0,l.jsx)("button",{onClick:Q,className:"p-1 rounded-full hover:bg-black/10 dark:hover:bg-white/10",children:(0,l.jsx)(b.A,{size:14})})]})]})}let Y={...N};return delete Y.height,delete Y["--attachment-height"],(0,l.jsxs)("button",{onClick:Q,className:(0,x.cn)("group flex rounded-xl transition-all duration-200 min-h-[54px] h-[54px] w-full overflow-hidden cursor-pointer","border border-black/10 dark:border-white/10","bg-sidebar","text-left","pr-7",v),style:Y,title:P,children:[(0,l.jsx)("div",{className:"relative min-w-[54px] h-full aspect-square flex-shrink-0 bg-black/5 dark:bg-white/5",children:(0,l.jsx)("div",{className:"flex items-center justify-center h-full w-full",children:(0,l.jsx)(_,{className:"h-5 w-5 text-black/60 dark:text-white/60"})})}),(0,l.jsxs)("div",{className:"flex-1 min-w-0 flex flex-col justify-center p-2 pl-3",children:[(0,l.jsx)("div",{className:"text-sm font-medium text-foreground truncate",children:P}),(0,l.jsxs)("div",{className:"text-xs text-muted-foreground flex items-center gap-1",children:[(0,l.jsx)("span",{className:"text-black/60 dark:text-white/60",children:D}),(0,l.jsx)("span",{className:"text-black/40 dark:text-white/40",children:"\xb7"}),(0,l.jsx)("span",{className:"text-black/60 dark:text-white/60",children:M})]})]})]})}function I(e){let{attachments:t,onFileClick:n,className:r,sandboxId:a,showPreviews:o=!0,collapsed:c=!1,project:s}=e;return t&&0!==t.length?(0,l.jsx)(g.X,{files:t,onFileClick:n,className:r,sandboxId:a,showPreviews:o,layout:"grid",gridImageHeight:150,collapsed:c,project:s}):null}},31834:(e,t,n)=>{n.d(t,{o:()=>h});var l=n(95155),r=n(59434),a=n(8947),o=n(12115),c=n(25789),s=n(93836),i=n(66722);let d={code:function(e){var t,n,a,o,c,s;let{className:d,children:u,...h}=e;if(!(null==(n=h.node)||null==(t=n.position)?void 0:t.start.line)||(null==(o=h.node)||null==(a=o.position)?void 0:a.start.line)===(null==(s=h.node)||null==(c=s.position)?void 0:c.end.line))return(0,l.jsx)("span",{className:(0,r.cn)("bg-primary-foreground dark:bg-zinc-800 dark:border dark:border-zinc-700 rounded-sm px-1 font-mono text-sm",d),...h,children:u});let p=function(e){if(!e)return"plaintext";let t=e.match(/language-(\w+)/);return t?t[1]:"plaintext"}(d);return(0,l.jsx)(i.NG,{className:"rounded-md overflow-hidden my-4 border border-zinc-200 dark:border-zinc-800",children:(0,l.jsx)(i.sd,{code:u,language:p,className:"text-sm overflow-x-auto"})})},pre:function(e){let{children:t}=e;return(0,l.jsx)(l.Fragment,{children:t})},ul:function(e){let{children:t,...n}=e;return(0,l.jsx)("ul",{className:"list-disc pl-5 my-2",...n,children:t})},ol:function(e){let{children:t,...n}=e;return(0,l.jsx)("ol",{className:"list-decimal pl-5 my-2",...n,children:t})},li:function(e){let{children:t,...n}=e;return(0,l.jsx)("li",{className:"my-1",...n,children:t})},h1:function(e){let{children:t,...n}=e;return(0,l.jsx)("h1",{className:"text-2xl font-bold my-3",...n,children:t})},h2:function(e){let{children:t,...n}=e;return(0,l.jsx)("h2",{className:"text-xl font-bold my-2",...n,children:t})},h3:function(e){let{children:t,...n}=e;return(0,l.jsx)("h3",{className:"text-lg font-bold my-2",...n,children:t})},blockquote:function(e){let{children:t,...n}=e;return(0,l.jsx)("blockquote",{className:"border-l-4 border-muted pl-4 italic my-2 dark:text-zinc-400 dark:border-zinc-600",...n,children:t})},a:function(e){let{children:t,href:n,...r}=e;return(0,l.jsx)("a",{href:n,className:"text-primary hover:underline dark:text-blue-400",target:"_blank",rel:"noopener noreferrer",...r,children:t})},table:function(e){let{children:t,...n}=e;return(0,l.jsx)("table",{className:"w-full border-collapse my-3 text-sm",...n,children:t})},th:function(e){let{children:t,...n}=e;return(0,l.jsx)("th",{className:"border border-slate-300 dark:border-zinc-700 px-3 py-2 text-left font-semibold bg-slate-100 dark:bg-zinc-800",...n,children:t})},td:function(e){let{children:t,...n}=e;return(0,l.jsx)("td",{className:"border border-slate-300 dark:border-zinc-700 px-3 py-2",...n,children:t})}},u=(0,o.memo)(function(e){let{content:t,components:n=d}=e;return(0,l.jsx)(c.oz,{remarkPlugins:[s.A],components:n,children:t})},function(e,t){return e.content===t.content});u.displayName="MemoizedMarkdownBlock";let h=(0,o.memo)(function(e){let{children:t,id:n,className:c,components:s=d}=e,i=(0,o.useId)(),h=null!=n?n:i,p=(0,o.useMemo)(()=>a.xI.lexer(t).map(e=>e.raw),[t]);return(0,l.jsx)("div",{className:(0,r.cn)("prose-code:before:hidden prose-code:after:hidden",c),children:p.map((e,t)=>(0,l.jsx)(u,{content:e,components:s},"".concat(h,"-block-").concat(t)))})});h.displayName="Markdown"},43089:(e,t,n)=>{n.d(t,{iy:()=>s,j8:()=>d,pH:()=>i});var l=n(12115),r=n(64541);let a=new Map;function o(e){return e?(e.startsWith("/workspace")||(e="/workspace/".concat(e.startsWith("/")?e.substring(1):e)),e):"/workspace"}function c(e,t){let n=o(t);return"".concat(e,":").concat(n)}function s(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},[s,d]=(0,l.useState)(null),[u,h]=(0,l.useState)(!1),[p,f]=(0,l.useState)(null),{session:m}=(0,r.A)(),b=e&&t?c(e,t):null,x=async function(l){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],c=a.get(l),s=Date.now(),d=n.expiration||3e5;if(!r&&c&&s-c.timestamp<d){if(console.log("[FILE CACHE] Returning cached content for ".concat(l)),i.isImageFile(t||"")&&c.content instanceof Blob){console.log("[FILE CACHE] Creating fresh blob URL for cached image");let e=URL.createObjectURL(c.content);return console.log("[FILE CACHE] Updating cache with fresh blob URL: ".concat(e)),a.set(l,{content:e,timestamp:s,type:"url"}),e}if("url"===c.type&&"string"==typeof c.content&&c.content.startsWith("blob:"))try{let e=new XMLHttpRequest;return e.open("HEAD",c.content,!1),e.send(),c.content}catch(e){console.warn("[FILE CACHE] Cached blob URL is invalid, will refetch: ".concat(e)),r=!0}return c.content}console.log("[FILE CACHE] Fetching fresh content for ".concat(l)),h(!0);try{let r,c=o(t||""),d=new URL("".concat("https://api.suna.so/api","/sandboxes/").concat(e,"/files/content"));d.searchParams.append("path",c);let u=await fetch(d.toString(),{headers:{Authorization:"Bearer ".concat(null==m?void 0:m.access_token)}});if(!u.ok)throw Error("Failed to load file: ".concat(u.status," ").concat(u.statusText));let h="content",p=i.isImageFile(t||"")&&("blob"===n.contentType||!n.contentType);switch(n.contentType){case"json":r=await u.json();break;case"blob":let f=await u.blob();if(p){console.log("[FILE CACHE] Storing raw blob for image in cache (".concat(f.size," bytes)")),a.set(l,{content:f,timestamp:s,type:"content"});let e=URL.createObjectURL(f);return console.log("[FILE CACHE] Created fresh blob URL for immediate use: ".concat(e)),e}r=URL.createObjectURL(f),h="url";break;case"arrayBuffer":r=await u.arrayBuffer();break;case"base64":let b=await u.arrayBuffer();r=btoa(new Uint8Array(b).reduce((e,t)=>e+String.fromCharCode(t),""));break;default:r=await u.text()}return p&&"blob"===n.contentType||a.set(l,{content:r,timestamp:s,type:h}),r}catch(e){throw a.set(l,{content:null,timestamp:Date.now(),type:"error"}),e}finally{h(!1)}},g=async()=>{if(!b)return null;try{let e=await x(b,!0);return d(e),e}catch(e){return f(e),null}},v=async()=>{if(b)try{let e=a.get(b);if(e)d(e.content),Date.now()-e.timestamp>(n.expiration||3e5)&&x(b,!0).then(e=>d(e)).catch(e=>console.error("Background refresh failed:",e));else{h(!0);let e=await x(b);d(e)}}catch(e){f(e)}finally{h(!1)}};return(0,l.useEffect)(()=>(e&&t?v():(d(null),h(!1),f(null)),()=>{if(b){let e=a.get(b);if((null==e?void 0:e.type)==="url"){let t=e.content;"string"==typeof t&&t.startsWith("blob:")&&(console.log("[FILE CACHE][IMAGE DEBUG] Cleaning up blob URL on unmount: ".concat(t," for key ").concat(b)),URL.revokeObjectURL(t))}}}),[e,t,n.contentType]),{data:s,isLoading:u,error:p,refreshCache:g,getCachedFile:function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return e?x(e,t):b?x(b,t):Promise.resolve(null)},getFromCache:e=>{var t;return(null==(t=a.get(e))?void 0:t.content)||null},cache:a}}let i={get:e=>{var t;return(null==(t=a.get(e))?void 0:t.content)||null},set:function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"content";a.set(e,{content:t,timestamp:Date.now(),type:n})},has:e=>a.has(e),clear:()=>a.clear(),delete:e=>a.delete(e),getContentTypeFromPath:e=>{var t;let n=null==(t=e.split(".").pop())?void 0:t.toLowerCase();return["png","jpg","jpeg","gif","svg","webp","bmp","ico","pdf"].includes(n||"")||["zip","mp3","mp4","webm","ogg","wav"].includes(n||"")?"blob":"json"===n?"json":"text"},isImageFile:e=>{var t;return["png","jpg","jpeg","gif","svg","webp","bmp","ico"].includes((null==(t=e.split(".").pop())?void 0:t.toLowerCase())||"")},isPdfFile:e=>{var t;return"pdf"===(null==(t=e.split(".").pop())?void 0:t.toLowerCase())},isBlob:e=>e instanceof Blob,getContentType:(e,t)=>t||i.getContentTypeFromPath(e),preload:async(e,t,n)=>{if(!n)try{let e=localStorage.getItem("auth");e&&(n=JSON.parse(e).access_token)}catch(e){console.error("Failed to get auth token from localStorage:",e)}return n?(console.log("[FILE CACHE] Preloading ".concat(t.length," files for sandbox ").concat(e)),Promise.all(t.map(async t=>{var l,r;let s=o(t),d=c(e,t);if(a.has(d))return console.log("[FILE CACHE] Already cached: ".concat(s)),null==(l=a.get(d))?void 0:l.content;console.log("[FILE CACHE] Preloading file: ".concat(s));try{let l,o=new URL("".concat("https://api.suna.so/api","/sandboxes/").concat(e,"/files/content"));o.searchParams.append("path",s);let c=await fetch(o.toString(),{headers:{Authorization:"Bearer ".concat(n)}});if(!c.ok)throw Error("Failed to preload file: ".concat(c.status));let u=null==(r=t.split(".").pop())?void 0:r.toLowerCase(),h="content";if(["png","jpg","jpeg","gif","pdf","mp3","mp4"].includes(u||"")){let e=await c.blob();i.isImageFile(t)?(l=e,h="content",console.log("[FILE CACHE] Successfully preloaded image blob: ".concat(s," (").concat(e.size," bytes)"))):(l=URL.createObjectURL(e),h="url",console.log("[FILE CACHE] Successfully preloaded blob URL: ".concat(s," (").concat(e.size," bytes)")))}else"json"===u?(l=await c.json(),console.log("[FILE CACHE] Successfully preloaded JSON: ".concat(s))):(l=await c.text(),console.log("[FILE CACHE] Successfully preloaded text: ".concat(s," (").concat(l.length," bytes)")));return a.set(d,{content:l,timestamp:Date.now(),type:h}),l}catch(e){return console.error("[FILE CACHE] Failed to preload ".concat(s,":"),e),a.set(d,{content:null,timestamp:Date.now(),type:"error"}),null}}))):(console.warn("Cannot preload files: No authentication token available"),[])},getMimeType:e=>{var t;switch(null==(t=e.split(".").pop())?void 0:t.toLowerCase()){case"pdf":return"application/pdf";case"png":return"image/png";case"jpg":case"jpeg":return"image/jpeg";case"gif":return"image/gif";case"svg":return"image/svg+xml";case"webp":return"image/webp";case"bmp":return"image/bmp";case"ico":return"image/x-icon";default:return"application/octet-stream"}}};async function d(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=i.isImageFile(t)||i.isPdfFile(t)?"blob":n.contentType||"text",r=c(e,t);performance.now();let s=i.isImageFile(t),d=i.isPdfFile(t);if(s?console.log("[FILE CACHE][IMAGE DEBUG] getCachedFile called for image: ".concat(t,", force: ").concat(n.force)):d&&console.log("[FILE CACHE] getCachedFile called for PDF: ".concat(t,", force: ").concat(n.force,", key: ").concat(r)),!n.force&&a.has(r)){let e=a.get(r);if(e&&"error"!==e.type)if(!s&&!d)return console.log("[FILE CACHE] Cache hit for ".concat(t," (").concat(l,")")),e.content;else{if(console.log("[FILE CACHE] Cached content type for ".concat(d?"PDF":"image",": ").concat(typeof e.content)),console.log("[FILE CACHE] Cached content is Blob: ".concat(e.content instanceof Blob)),e.content instanceof Blob){console.log("[FILE CACHE] Creating new blob URL from cached ".concat(d?"PDF":"image"," blob (").concat(e.content.size," bytes)"));let t=URL.createObjectURL(e.content);return console.log("[FILE CACHE] Created fresh blob URL: ".concat(t)),t}console.log("[FILE CACHE] Invalid cache content type for ".concat(d?"PDF":"image",", forcing refresh"))}}console.log("[FILE CACHE] Fetching fresh content for ".concat(e,":").concat(t));try{let c,i=new URL("".concat("https://api.suna.so/api","/sandboxes/").concat(e,"/files/content"));i.searchParams.append("path",o(t));let u=await fetch(i.toString(),{headers:{Authorization:"Bearer ".concat(n.token)}});if(!u.ok)throw Error("Failed to load file: ".concat(u.status," ").concat(u.statusText));let h="content";switch(l){case"json":c=await u.json();break;case"blob":let p=await u.blob();if(s||d){if(console.log("[FILE CACHE] Storing raw blob for ".concat(d?"PDF":"image"," in cache (").concat(p.size," bytes, type: ").concat(p.type,")")),d&&!p.type.includes("pdf")&&p.size>0&&(console.warn("[FILE CACHE] PDF blob has generic MIME type: ".concat(p.type," - will correct it automatically")),(await p.slice(0,10).text()).startsWith("%PDF"))){console.log("[FILE CACHE] Content appears to be a PDF despite incorrect MIME type, proceeding");let n=new Blob([await p.arrayBuffer()],{type:"application/pdf"});console.log("[FILE CACHE] Created corrected PDF blob with proper MIME type (".concat(n.size," bytes)"));let l="".concat(e,":").concat(o(t),":blob");a.set(l,{content:n,timestamp:Date.now(),type:"content"}),a.set(r,{content:n,timestamp:Date.now(),type:"content"});let c=URL.createObjectURL(n);return console.log("[FILE CACHE] Created fresh blob URL for corrected PDF: ".concat(c)),c}let n="".concat(e,":").concat(o(t),":blob");a.set(n,{content:p,timestamp:Date.now(),type:"content"}),a.set(r,{content:p,timestamp:Date.now(),type:"content"});let l=URL.createObjectURL(p);return console.log("[FILE CACHE] Created fresh blob URL for immediate use: ".concat(l)),l}c=URL.createObjectURL(p),h="url";break;case"arrayBuffer":c=await u.arrayBuffer();break;case"base64":let f=await u.arrayBuffer();c=btoa(new Uint8Array(f).reduce((e,t)=>e+String.fromCharCode(t),""));break;default:c=await u.text()}return s||d||a.set(r,{content:c,timestamp:Date.now(),type:h}),c}catch(e){throw a.set(r,{content:null,timestamp:Date.now(),type:"error"}),e}}},63496:(e,t,n)=>{n.d(t,{i:()=>l});function l(e,t){if(!e||!t)return;let n=t.replace(/^\/workspace\//,"").split("/").map(e=>encodeURIComponent(e)).join("/");return"".concat(e,"/").concat(n)}},66424:(e,t,n)=>{n.d(t,{F:()=>o});var l=n(95155);n(12115);var r=n(47655),a=n(59434);function o(e){let{className:t,children:n,...o}=e;return(0,l.jsxs)(r.bL,{"data-slot":"scroll-area",className:(0,a.cn)("relative",t),...o,children:[(0,l.jsx)(r.LM,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:n}),(0,l.jsx)(c,{}),(0,l.jsx)(r.OK,{})]})}function c(e){let{className:t,orientation:n="vertical",...o}=e;return(0,l.jsx)(r.VM,{"data-slot":"scroll-area-scrollbar",orientation:n,className:(0,a.cn)("flex touch-none p-px transition-colors select-none","vertical"===n&&"h-full w-2.5 border-l border-l-transparent","horizontal"===n&&"h-2.5 flex-col border-t border-t-transparent",t),...o,children:(0,l.jsx)(r.lr,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}},66722:(e,t,n)=>{n.d(t,{NG:()=>s,sd:()=>i});var l=n(95155),r=n(59434),a=n(12115),o=n(475),c=n(51362);function s(e){let{children:t,className:n,...a}=e;return(0,l.jsx)("div",{className:(0,r.cn)(n),...a,children:t})}function i(e){let{code:t,language:n="tsx",theme:s,className:i,...d}=e,{resolvedTheme:u}=(0,c.D)(),[h,p]=(0,a.useState)(null),f=s||("dark"===u?"github-dark":"github-light");(0,a.useEffect)(()=>{!async function(){p(await (0,o.Yz)(t,{lang:n,theme:f}))}()},[t,n,f]);let m=(0,r.cn)("",i);return h?(0,l.jsx)("div",{className:m,dangerouslySetInnerHTML:{__html:h},...d}):(0,l.jsx)("div",{className:m,...d,children:(0,l.jsx)("pre",{children:(0,l.jsx)("code",{children:t})})})}},86618:(e,t,n)=>{n.d(t,{X:()=>d});var l=n(95155),r=n(60760),a=n(63527),o=n(54416),c=n(46102),s=n(30431),i=n(59434);function d(e){let{files:t,sandboxId:n,onRemove:d,layout:u="inline",className:h,onFileClick:p,showPreviews:f=!0,maxHeight:m="216px",gridImageHeight:b=180,collapsed:x=!0,project:g}=e;if(!t||0===t.length)return null;let v="string"==typeof t[0]?[...new Set(t)]:t,w=e=>"string"==typeof e?e:e.path,j=e=>{p&&p(e)},y=e=>{if("string"!=typeof e)return n?void 0:e.localUrl},k=e=>{var t;let n=(null==(t=w(e).split(".").pop())?void 0:t.toLowerCase())||"";return"html"===n||"htm"===n||"md"===n||"markdown"===n||"csv"===n||"tsv"===n};return(0,l.jsx)(r.N,{children:(0,l.jsx)(a.P.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"inline"===u?"mb-3 py-1 px-0.5":"mt-4",children:(()=>{if("grid"!==u)return(0,l.jsx)("div",{className:(0,i.cn)("flex flex-wrap gap-3",h),style:{maxHeight:m},children:v.map((e,t)=>(0,l.jsxs)("div",{className:"relative group",children:[(0,l.jsx)(s.m,{filepath:w(e),onClick:j,sandboxId:n,showPreview:f,localPreviewUrl:y(e),collapsed:!0}),d&&(0,l.jsx)("div",{className:"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-black dark:bg-white border-3 border-sidebar text-white dark:text-black flex items-center justify-center z-30 cursor-pointer",onClick:()=>d(t),children:(0,l.jsx)(c.Bc,{children:(0,l.jsxs)(c.m_,{children:[(0,l.jsx)(c.k$,{asChild:!0,children:(0,l.jsx)("div",{className:"flex items-center justify-center w-full h-full",children:(0,l.jsx)(o.A,{size:10,strokeWidth:3})})}),(0,l.jsx)(c.ZI,{side:"top",children:(0,l.jsx)("p",{children:"Remove file"})})]})})})]},t))});{let e=[...v].sort((e,t)=>{let n=!x&&k(e);return n===(!x&&k(t))?0:n?1:-1}),t=e.length%2==1&&e.length>1;return(0,l.jsx)("div",{className:(0,i.cn)("grid gap-3",1===v.length?"grid-cols-1":v.length>4?"grid-cols-1 sm:grid-cols-2 md:grid-cols-3":"grid-cols-1 sm:grid-cols-2",h),children:e.map((r,a)=>{let u=w(r),h=null!==(u.split("/").pop()||"").match(/\.(jpg|jpeg|png|gif|webp|svg|bmp)$/i),p=k(r),m=a===e.length-1,v=t&&m;return(0,l.jsxs)("div",{className:(0,i.cn)("relative group",h?"flex items-center justify-center h-full":""),style:{gridColumn:v||p&&!x?"1 / -1":"auto"},children:[(0,l.jsx)(s.m,{filepath:u,onClick:j,sandboxId:n,showPreview:f,localPreviewUrl:y(r),className:(0,i.cn)(h?"h-auto min-h-[54px] w-full":""),customStyle:h?{width:"100%",height:"auto","--attachment-height":"".concat(v?Math.floor(1.33*b):b,"px")}:p&&!x||v?{gridColumn:"1 / -1"}:void 0,collapsed:x,project:g}),d&&(0,l.jsx)("div",{className:"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-black dark:bg-white border-2 border-white/90 dark:border-black/10 text-white dark:text-black flex items-center justify-center z-30 cursor-pointer",onClick:()=>d(a),children:(0,l.jsx)(c.Bc,{children:(0,l.jsxs)(c.m_,{children:[(0,l.jsx)(c.k$,{asChild:!0,children:(0,l.jsx)("div",{className:"flex items-center justify-center w-full h-full",children:(0,l.jsx)(o.A,{size:10,strokeWidth:3})})}),(0,l.jsx)(c.ZI,{side:"top",children:(0,l.jsx)("p",{children:"Remove file"})})]})})})]},a)})})}})()})})}}}]);